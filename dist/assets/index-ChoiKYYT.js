import{j as e,r as d,a0 as D,a1 as ye,a2 as ke,a3 as Ce,a4 as Se,a5 as ze,a6 as Ae,a7 as Ie,a8 as Te,a9 as ce,aa as Re,ab as Pe,ac as ee,ad as Ee,ae as Le,af as Me,ag as A,ah as M,ai as De,aj as Fe}from"./vendor-wbDOIdi9.js";import{d as z,u as E,q as te,l as se,o as ae,w as ie,c as O,a as le,b as _e,e as de,g as re,f as y,s as Be,h as V,i as Ge,j as He,k as $e,m as Y,r as Oe,n as Ve,p as We,t as qe,v as Ke,x as Je,y as Qe}from"./vendor-firebase-ChCoiK1p.js";import{L as xe,m as N,a as Ye,U as me,H as pe,S as ue,b as Z,C as Ze,A as T,c as W,d as q,R as Xe,e as _,X as H,f as B,M as Ue,g as et,h as L,i as P,W as tt,j as R,k as st,T as at,B as X,l as K,Z as F,n as J,F as he,o as ge,p as be,q as it,r as lt,s as U,t as rt,u as nt,v as ot,w as ct,x as dt,y as xt,z as mt,D as fe,E as je,G as pt,I as Ne,J as ut,K as ht,N as gt,O as bt,P as ft,Q as jt,V as Nt,Y as vt,_ as wt,$ as yt,a0 as kt,a1 as Ct,a2 as St}from"./vendor-ui-DEgaWfEr.js";import{G as zt}from"./vendor-gemini-CZZ1HbHH.js";(function(){const a=document.createElement("link").relList;if(a&&a.supports&&a.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))r(i);new MutationObserver(i=>{for(const l of i)if(l.type==="childList")for(const o of l.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&r(o)}).observe(document,{childList:!0,subtree:!0});function s(i){const l={};return i.integrity&&(l.integrity=i.integrity),i.referrerPolicy&&(l.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?l.credentials="include":i.crossOrigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function r(i){if(i.ep)return;i.ep=!0;const l=s(i);fetch(i.href,l)}})();const At=({className:t=""})=>e.jsxs("div",{className:`flex items-center gap-3 ${t} select-none shrink-0 group`,children:[e.jsx("div",{className:"relative",children:e.jsxs("div",{className:"w-11 h-11 flex items-center justify-center bg-gradient-to-tr from-[#007AFF] to-[#47a1ff] rounded-[1.15rem] shadow-lg shadow-blue-200/50 transition-all duration-500 group-hover:scale-105 group-hover:rotate-6",children:[e.jsxs("svg",{viewBox:"0 0 100 100",className:"w-6 h-6 text-white",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[e.jsx("circle",{cx:"50",cy:"50",r:"10",fill:"currentColor"}),e.jsx("ellipse",{cx:"50",cy:"50",rx:"44",ry:"16",stroke:"currentColor",strokeWidth:"6",transform:"rotate(0 50 50)",className:"opacity-30"}),e.jsx("ellipse",{cx:"50",cy:"50",rx:"44",ry:"16",stroke:"currentColor",strokeWidth:"6",transform:"rotate(60 50 50)",className:"opacity-60"}),e.jsx("ellipse",{cx:"50",cy:"50",rx:"44",ry:"16",stroke:"currentColor",strokeWidth:"6",transform:"rotate(120 50 50)"})]}),e.jsxs("div",{className:"absolute -top-1 -right-1 flex h-3.5 w-3.5",children:[e.jsx("span",{className:"animate-ping absolute inline-flex h-full w-full rounded-full bg-emerald-400 opacity-75"}),e.jsx("span",{className:"relative inline-flex rounded-full h-3.5 w-3.5 bg-emerald-500 border-2 border-white"})]})]})}),e.jsxs("div",{className:"flex flex-col -space-y-1",children:[e.jsx("div",{className:"flex items-baseline",children:e.jsxs("span",{className:"text-xl font-[1000] tracking-tighter text-slate-900 leading-none italic uppercase",children:["VITA",e.jsx("span",{className:"text-[#007AFF]",children:"METRA"})]})}),e.jsxs("div",{className:"flex items-center gap-1.5 mt-1",children:[e.jsx("div",{className:"h-[2px] w-3 bg-emerald-500 rounded-full"}),e.jsx("span",{className:"text-[8px] font-black text-slate-400 uppercase tracking-[0.25em] leading-none",children:"Bio-Intelligence"})]})]})]}),It=({isLoggedIn:t,onLoginClick:a,onLogoutClick:s,currentUser:r})=>e.jsx("header",{className:"fixed top-0 left-0 right-0 z-[1000] bg-white/80 backdrop-blur-md border-b border-slate-100 shadow-sm",children:e.jsxs("div",{className:"w-full max-w-[1400px] mx-auto px-6 h-20 flex items-center justify-between",children:[e.jsx("div",{className:"flex-shrink-0 flex items-center cursor-pointer hover:opacity-80 transition-all active:scale-95",children:e.jsx(At,{})}),e.jsx("div",{className:"flex items-center gap-4",children:t?e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"hidden sm:flex flex-col items-end",children:[e.jsx("p",{className:"text-[9px] font-black text-blue-600 uppercase tracking-widest leading-none mb-1",children:"Bio-Perfil"}),e.jsx("p",{className:"text-sm font-black text-slate-900 leading-none italic uppercase",children:r?.firstName||r?.email?.split("@")[0]})]}),e.jsx("div",{className:"h-8 w-[1px] bg-slate-200 mx-1 hidden sm:block"}),e.jsx("button",{onClick:s,className:"p-2.5 rounded-xl bg-slate-50 text-slate-400 hover:bg-rose-50 hover:text-rose-600 transition-all",children:e.jsx(xe,{size:18,strokeWidth:2.5})})]}):e.jsx("button",{onClick:a,className:"bg-slate-900 text-white px-6 py-2.5 rounded-xl font-[1000] text-[10px] uppercase tracking-[0.2em] hover:bg-blue-600 transition-all active:scale-95 whitespace-nowrap shadow-xl shadow-slate-100",children:"Iniciar Sesión"})})]})}),Tt=({activeTab:t,onTabChange:a})=>{const s=[{id:"dashboard",label:"Hoy",icon:e.jsx(Ye,{size:22}),path:"dashboard"},{id:"analyzer",label:"Analizar",icon:e.jsx(me,{size:22}),path:"analyzer",badge:!0},{id:"history",label:"Tendencias",icon:e.jsx(pe,{size:22}),path:"history"},{id:"settings",label:"Reportes",icon:e.jsx(ue,{size:22}),path:"settings"},{id:"profile",label:"Perfil",icon:e.jsx(Z,{size:22}),path:"profile"}],r=t==="clinical-settings"?"settings":t||"dashboard";return e.jsx("div",{className:"fixed bottom-0 left-0 right-0 px-6 pb-8 pt-4 z-[900] pointer-events-none",children:e.jsx("nav",{className:"max-w-md mx-auto bg-white/80 backdrop-blur-2xl border border-white/40 shadow-[0_20px_50px_rgba(0,0,0,0.1)] rounded-[2.5rem] px-2 py-3 flex items-center justify-between pointer-events-auto relative overflow-hidden",children:s.map(i=>{const l=r===i.id;return e.jsxs("button",{onClick:()=>a(i.path),className:"relative flex flex-col items-center justify-center py-2 px-3 transition-all duration-500 group flex-1",children:[l&&e.jsx(N.div,{layoutId:"nav-indicator",className:"absolute -top-3 w-1.5 h-1.5 bg-indigo-600 rounded-full shadow-[0_0_10px_#4F46E5]",transition:{type:"spring",stiffness:380,damping:30}}),e.jsxs("div",{className:`relative transition-all duration-300 transform ${l?"scale-110 text-indigo-600":"text-slate-400 group-hover:text-slate-600"}`,children:[i.icon,i.badge&&e.jsxs("span",{className:"absolute -top-1 -right-1 flex h-2 w-2",children:[e.jsx("span",{className:"animate-ping absolute inline-flex h-full w-full rounded-full bg-indigo-400 opacity-75"}),e.jsx("span",{className:"relative inline-flex rounded-full h-2 w-2 bg-indigo-600"})]})]}),e.jsx("span",{className:`text-[8px] font-[900] uppercase tracking-[0.05em] mt-1.5 transition-colors duration-300 italic ${l?"text-indigo-600":"text-slate-400"}`,children:i.label}),l&&e.jsx(N.div,{layoutId:"nav-pill",className:"absolute inset-0 bg-indigo-50/50 rounded-2xl -z-10",transition:{type:"spring",stiffness:300,damping:30}})]},i.id)})})})},Rt=({message:t,type:a="info",actionText:s,onAction:r,duration:i=4e3,snackbarKey:l})=>{const[o,c]=d.useState(!1);if(d.useEffect(()=>{if(l>0){c(!0);const p=setTimeout(()=>c(!1),i);return()=>clearTimeout(p)}},[l,i]),!o)return null;const n={success:"bg-metra-green shadow-metra-green/20",error:"bg-red-500 shadow-red-500/20",info:"bg-metra-dark shadow-metra-dark/20"};return e.jsx("div",{className:"fixed top-10 left-1/2 -translate-x-1/2 z-[2000] w-[90%] max-w-sm p-1 rounded-[2rem] animate-in slide-in-from-top-10 duration-500",children:e.jsxs("div",{className:`flex items-center justify-between px-6 py-4 rounded-[1.8rem] text-white shadow-2xl ${n[a]} backdrop-blur-md border border-white/10`,children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-2 h-2 bg-white rounded-full animate-pulse"}),e.jsx("span",{className:"text-[10px] font-black uppercase tracking-[0.2em]",children:t})]}),s&&e.jsx("button",{onClick:()=>{r?.(),c(!1)},className:"bg-white/20 px-3 py-1.5 rounded-xl text-[9px] font-black uppercase tracking-widest hover:bg-white/30 transition-colors",children:s})]})})},Pt=({result:t,currentUser:a,onLogEntry:s,onAdjust:r})=>{const[i,l]=d.useState(0),[o,c]=d.useState(0),n=()=>{if(!a?.insulinRatioSchedule||a.insulinRatioSchedule.length===0)return 12;const u=new Date,j=`${u.getHours().toString().padStart(2,"0")}:${u.getMinutes().toString().padStart(2,"0")}`,b=[...a.insulinRatioSchedule].sort((x,f)=>x.startTime.localeCompare(f.startTime));return(b.reverse().find(x=>j>=x.startTime)||b[0]).ratio};d.useEffect(()=>{const u=n(),j=a?.clinicalConfig?.insulinSensitivityFactor||50,b=a?.clinicalConfig?.targetGlucose||100,v=t.totalCarbs/u,x=i>b?(i-b)/j:0;c(Math.round((v+x)*10)/10)},[i,t.totalCarbs,a]);const p=u=>{switch(u?.toLowerCase()){case"alto":return"text-rose-500 bg-rose-50 border-rose-100";case"medio":return"text-amber-500 bg-amber-50 border-amber-100";default:return"text-emerald-500 bg-emerald-50 border-emerald-100"}};return e.jsxs("div",{className:"mt-8 space-y-6 animate-in fade-in slide-in-from-bottom-6 duration-700 max-w-2xl mx-auto pb-32 px-4 antialiased",children:[e.jsxs("div",{className:"bg-white rounded-[3.5rem] border border-slate-50 p-10 shadow-[0_20px_60px_rgba(0,0,0,0.03)] relative overflow-hidden group",children:[e.jsx("div",{className:"absolute top-0 right-0",children:e.jsxs("div",{className:`px-8 py-3 rounded-bl-[2rem] border-l border-b font-[1000] text-[10px] uppercase tracking-[0.2em] shadow-sm ${p(t.glycemicIndex)}`,children:["Índice Glicémico: ",t.glycemicIndex]})}),e.jsxs("div",{className:"mt-6",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx("div",{className:"w-1.5 h-1.5 bg-indigo-600 rounded-full animate-pulse"}),e.jsx("span",{className:"text-[10px] font-black text-slate-400 uppercase tracking-[0.3em]",children:"Carga de Carbohidratos"})]}),e.jsxs("div",{className:"flex items-end gap-3",children:[e.jsx("h3",{className:"text-8xl font-[1000] text-slate-900 tracking-tighter italic leading-none",children:t.totalCarbs}),e.jsx("span",{className:"text-3xl text-indigo-600 font-[1000] mb-2 italic",children:"g"})]}),e.jsx("p",{className:"mt-4 text-[11px] font-bold text-slate-400 uppercase tracking-widest max-w-[200px]",children:"Análisis Bio-Digital verificado por Vitametra IA"})]})]}),e.jsxs("div",{className:"bg-slate-900 rounded-[3.5rem] p-10 text-white shadow-2xl shadow-indigo-200/50 relative overflow-hidden",children:[e.jsx("div",{className:"absolute top-0 right-0 w-64 h-64 bg-indigo-500/10 blur-[80px] rounded-full -mr-20 -mt-20"}),e.jsx("div",{className:"relative flex items-center justify-between mb-10",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-12 h-12 bg-white/10 rounded-2xl flex items-center justify-center backdrop-blur-md",children:e.jsx(Ze,{size:22,className:"text-indigo-400"})}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-[10px] font-black uppercase tracking-[0.3em] text-indigo-400 mb-1",children:"Cálculo de Dosis"}),e.jsxs("p",{className:"text-sm font-bold text-white/60",children:["Bio-Protocolo 1u : ",n(),"g"]})]})]})}),e.jsxs("div",{className:"relative grid grid-cols-1 md:grid-cols-2 gap-10 items-center",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx("label",{className:"text-[10px] font-black uppercase tracking-[0.2em] text-indigo-300 ml-2",children:"Glucosa Actual (mg/dL)"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"number",inputMode:"numeric",placeholder:"000",value:i||"",onChange:u=>l(Number(u.target.value)),className:"bg-white/5 border border-white/10 rounded-[2rem] px-8 py-6 text-4xl font-[1000] text-white w-full outline-none focus:ring-4 ring-indigo-500/20 transition-all placeholder:text-white/10 italic tracking-tighter"}),e.jsx("div",{className:"absolute right-6 top-1/2 -translate-y-1/2",children:e.jsx(T,{size:24,className:"text-white/20"})})]})]}),e.jsxs("div",{className:"relative group",children:[e.jsx("div",{className:"absolute inset-0 bg-indigo-600 blur-2xl opacity-20 group-hover:opacity-40 transition-opacity"}),e.jsxs("div",{className:"relative bg-white/10 backdrop-blur-xl rounded-[3rem] p-8 text-center border border-white/10 shadow-inner",children:[e.jsx("p",{className:"text-[10px] font-black uppercase tracking-[0.3em] text-indigo-300 mb-2 leading-none",children:"Bolo Recomendado"}),e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx("span",{className:"text-7xl font-[1000] text-white italic tracking-tighter",children:o}),e.jsx("span",{className:"text-2xl font-black text-indigo-400 mt-4 italic uppercase",children:"u"})]})]})]})]}),e.jsxs("div",{className:"relative mt-8 flex items-start gap-3 p-5 bg-white/5 rounded-2xl border border-white/5",children:[e.jsx(W,{size:16,className:"text-indigo-400 shrink-0 mt-0.5"}),e.jsx("p",{className:"text-[9px] text-white/50 uppercase font-black leading-relaxed tracking-widest",children:"Esta es una sugerencia algorítmica. Valida siempre con tus síntomas y el protocolo de tu especialista médico."})]})]}),e.jsxs("div",{className:"bg-indigo-50 rounded-[2.5rem] p-8 border border-indigo-100",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"p-2 bg-indigo-600 rounded-lg text-white",children:e.jsx(Sparkles,{size:16})}),e.jsx("h4",{className:"text-[10px] font-black uppercase tracking-[0.3em] text-indigo-600",children:"Bio-Insight IA"})]}),e.jsxs("p",{className:"text-xl font-bold italic text-slate-800 leading-tight",children:['"',t.optimizationTip||"Carga metabólica equilibrada para tu perfil.",'"']})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 pt-4",children:[e.jsxs("button",{onClick:s,className:"flex-[2] bg-slate-900 text-white py-7 rounded-[2.5rem] font-black uppercase text-[12px] tracking-[0.3em] shadow-2xl shadow-slate-200 flex items-center justify-center gap-3 hover:bg-indigo-600 transition-all active:scale-95 group",children:[e.jsx(q,{size:20,className:"text-indigo-400 group-hover:text-white transition-colors"}),"Sincronizar Log"]}),e.jsxs("button",{onClick:r,className:"flex-1 bg-white text-slate-400 border border-slate-100 py-7 rounded-[2.5rem] font-black uppercase text-[12px] tracking-[0.3em] flex items-center justify-center gap-3 hover:bg-slate-50 transition-all active:scale-95",children:[e.jsx(Xe,{size:20}),"Ajustar"]})]})]})},k={async login(t,a){return await $e(V,t.toLowerCase().trim(),a)},async register(t,a,s="Usuario"){const r=await Ge(V,t.toLowerCase().trim(),a),i=r.user.uid,l={id:i,firstName:s,lastName:"",email:t.toLowerCase().trim(),role:"USER",subscription_tier:"BASE",ia_credits:3,daily_ia_usage:0,streak:0,createdAt:new Date().toISOString(),insulinRatioSchedule:[{startTime:"08:00",ratio:15},{startTime:"14:00",ratio:15},{startTime:"21:00",ratio:15}],clinicalConfig:{diabetesType:"Type 1",insulinSensitivityFactor:50,targetGlucose:100},aiMemory:"Iniciando fase de observación metabólica.",memory:{patterns:{highGlucoseTriggers:[],effectiveCorrections:[],notableEvents:[]},preferences:{dietaryRestrictions:[],favoriteSafeFoods:[]},aiNotes:"Sincronizado con el Bio-Core."},glucoseUnitPreference:"mg/dL"};return await He(z(y,"users",i),l,{merge:!0}),r},async logout(){try{await Be(V),window.location.href="/"}catch(t){console.error("Error al cerrar sesión:",t)}},async createStripeCheckoutSession(t){return console.log("Iniciando pasarela para:",t),{success:!0,url:"#"}},async getUserProfile(t){const a=z(y,"users",t);try{const s=await re(a);return s.exists()?{id:s.id,...s.data()}:null}catch{return null}},async updateUser(t){const a=z(y,"users",t.id),{id:s,...r}=t;await E(a,{...r,updatedAt:new Date().toISOString()})},async checkAnalysisLimit(t){const a=z(y,"users",t),r=(await re(a)).data();if(r?.subscription_tier!=="PRO"&&(r?.daily_ia_usage||0)>=3)throw new Error("Has agotado tus análisis diarios gratuitos.")},async addHistoryEntry(t,a){const s=O(y,"ingestas");return await de(s,{...a,userId:t,createdAt:Y(),date:a.date||new Date().toISOString()})},async closeLearningLoop(t,a,s,r){const i=z(y,"ingestas",t);return await E(i,{postPrandialGlucose:a,successScore:s,closureNotes:r||"",updatedAt:Y()})},async deleteHistoryEntry(t){await _e(z(y,"ingestas",t))},subscribeToHistory(t,a){const s=te(O(y,"ingestas"),ie("userId","==",t),ae("createdAt","desc"),se(50));return le(s,r=>{a(r.docs.map(i=>({id:i.id,...i.data()})))},r=>console.error(r))},subscribeToHba1cHistory(t,a){const s=te(O(y,"hba1c_logs"),ie("userId","==",t),ae("date","desc"),se(20));return le(s,r=>{a(r.docs.map(i=>({id:i.id,...i.data()})))},r=>console.error(r))},async trackIAUsage(t,a,s){const r=z(y,"users",t);await E(r,{daily_ia_usage:a+1,last_ia_usage_date:s})}},Et=({isOpen:t,onClose:a,onLoginSuccess:s})=>{const[r,i]=d.useState(!0),[l,o]=d.useState(""),[c,n]=d.useState(""),[p,u]=d.useState(!1),[j,b]=d.useState(null),v=async x=>{x.preventDefault(),u(!0),b(null);try{if(r){const f=await k.login(l,c);s(f),a()}else{const f=await k.register(l,c);s(f),a()}}catch(f){b(f.message||"Error en la autenticación")}finally{u(!1)}};return e.jsx(_,{children:t&&e.jsx("div",{className:"fixed inset-0 z-[100] flex items-center justify-center p-4 bg-slate-900/60 backdrop-blur-sm",children:e.jsxs(N.div,{initial:{opacity:0,scale:.95,y:20},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.95,y:20},className:"relative w-full max-w-md bg-white rounded-[3rem] shadow-2xl overflow-hidden",children:[e.jsxs("div",{className:"bg-slate-900 p-8 text-white relative",children:[e.jsx("button",{onClick:a,className:"absolute top-6 right-6 p-2 hover:bg-white/10 rounded-full transition-colors",children:e.jsx(H,{size:20})}),e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(B,{className:"text-blue-400",size:24}),e.jsx("span",{className:"text-[10px] font-black uppercase tracking-[0.3em] text-slate-400",children:"Acceso Seguro Vitametra"})]}),e.jsxs("h2",{className:"text-3xl font-[1000] uppercase italic tracking-tighter",children:[r?"Bienvenido":"Crear Cuenta"," ",e.jsx("br",{}),e.jsx("span",{className:"text-blue-500",children:r?"De Vuelta":"Médica IA"})]})]}),e.jsxs("form",{onSubmit:v,className:"p-8 space-y-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx(Ue,{className:"absolute left-4 top-1/2 -translate-y-1/2 text-slate-400",size:18}),e.jsx("input",{type:"email",placeholder:"Tu email",value:l,onChange:x=>o(x.target.value),className:"w-full pl-12 pr-6 py-4 bg-slate-50 border-2 border-transparent focus:border-blue-600 rounded-2xl outline-none transition-all font-bold",required:!0})]}),e.jsxs("div",{className:"relative",children:[e.jsx(et,{className:"absolute left-4 top-1/2 -translate-y-1/2 text-slate-400",size:18}),e.jsx("input",{type:"password",placeholder:"Tu contraseña",value:c,onChange:x=>n(x.target.value),className:"w-full pl-12 pr-6 py-4 bg-slate-50 border-2 border-transparent focus:border-blue-600 rounded-2xl outline-none transition-all font-bold",required:!0})]})]}),j&&e.jsx("p",{className:"text-red-500 text-[10px] font-black uppercase tracking-widest text-center",children:j}),e.jsxs("button",{type:"submit",disabled:p,className:"w-full py-5 bg-blue-600 hover:bg-slate-900 text-white rounded-2xl font-black uppercase text-xs tracking-[0.2em] transition-all flex items-center justify-center gap-3 shadow-xl shadow-blue-100",children:[p?e.jsx(L,{className:"animate-spin"}):r?"Entrar Ahora":"Empezar Registro",!p&&e.jsx(P,{size:16})]}),e.jsx("button",{type:"button",onClick:()=>i(!r),className:"w-full text-center text-[10px] font-black uppercase tracking-widest text-slate-400 hover:text-blue-600 transition-colors",children:r?"¿No tienes cuenta? Regístrate":"¿Ya eres usuario? Inicia sesión"})]})]})})})},Lt=({currentUser:t})=>{const[a,s]=d.useState(!1);d.useEffect(()=>{if(!localStorage.getItem("vitaflow_welcome_seen")&&t){const l=setTimeout(()=>s(!0),1e3);return()=>clearTimeout(l)}},[t]);const r=()=>{localStorage.setItem("vitaflow_welcome_seen","true"),s(!1)};return!a||!t?null:e.jsx("div",{className:"fixed inset-0 z-[100] flex items-center justify-center p-6 bg-slate-900/40 backdrop-blur-md",children:e.jsx("div",{className:"bg-white w-full max-w-lg rounded-[3.5rem] p-10 shadow-2xl border border-white relative overflow-hidden",children:e.jsxs("div",{className:"relative z-10 text-center",children:[e.jsx("div",{className:"w-20 h-20 bg-blue-600 rounded-[2rem] flex items-center justify-center mx-auto mb-8 shadow-xl shadow-blue-200",children:e.jsx(tt,{className:"text-white",size:40})}),e.jsxs("h2",{className:"text-4xl font-black tracking-tighter text-slate-900 italic uppercase mb-4",children:["Hola, ",e.jsx("span",{className:"text-blue-600",children:t.firstName||"Usuario"})]}),e.jsxs("p",{className:"text-slate-500 font-medium leading-relaxed mb-10",children:["Has activado tu ecosistema ",e.jsx("span",{className:"font-bold text-slate-800",children:"VitaFlow"}),"."]}),e.jsx("button",{onClick:r,className:"w-full bg-black text-white p-6 rounded-[2rem] font-black uppercase text-[12px] tracking-[0.2em] shadow-xl",children:"Entrar a mi Ecosistema"})]})})})},Mt=({mealEntry:t,onClose:a,onSaveClosure:s})=>{const[r,i]=d.useState(""),[l,o]=d.useState("input"),n=(()=>{const p=Number(r);return t.bloodGlucoseValue,p>180?{score:.4,label:"Bolo Insuficiente",color:"text-rose-500",bg:"bg-rose-50",insight:`La carga de "${t.foodName}" superó la capacidad del ratio actual. Sugerencia: Incrementar dosis en un 10-15% para platos similares.`}:p<70?{score:.3,label:"Exceso de Corrección",color:"text-amber-500",bg:"bg-amber-50",insight:"Hipoglicemia detectada. Este alimento tiene una absorción más lenta de lo previsto o el ratio aplicado fue demasiado agresivo."}:{score:1,label:"Éxito Metabólico",color:"text-emerald-500",bg:"bg-emerald-50",insight:'Perfecto. Has logrado mantener la estabilidad. Este registro se guardará como "Patrón de Referencia".'}})();return e.jsxs("div",{className:"fixed inset-0 z-[5000] flex items-end justify-center px-4 pb-10 sm:items-center",children:[e.jsx(N.div,{initial:{opacity:0},animate:{opacity:1},className:"absolute inset-0 bg-slate-900/90 backdrop-blur-md",onClick:a}),e.jsx(N.div,{initial:{y:100,opacity:0},animate:{y:0,opacity:1},className:"relative w-full max-w-lg bg-white rounded-[4rem] overflow-hidden shadow-2xl",children:e.jsxs("div",{className:"p-10",children:[e.jsxs("header",{className:"flex justify-between items-center mb-12",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"p-3 bg-slate-900 rounded-2xl text-indigo-400",children:e.jsx(T,{size:24})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-[1000] uppercase italic tracking-tighter leading-none",children:"Feedback Vital"}),e.jsx("span",{className:"text-[9px] font-black text-slate-400 uppercase tracking-widest",children:t.foodName})]})]}),e.jsx("button",{onClick:a,className:"p-3 bg-slate-50 rounded-full text-slate-400 hover:bg-slate-100 transition-colors",children:e.jsx(H,{size:24})})]}),l==="input"?e.jsxs("div",{className:"space-y-10",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("span",{className:"text-[10px] font-black text-indigo-600 uppercase tracking-[0.4em] mb-6 block",children:"Glucosa Actual"}),e.jsx("div",{className:"relative inline-block",children:e.jsx("input",{type:"number",autoFocus:!0,value:r,onChange:p=>i(Number(p.target.value)),placeholder:"000",className:"w-full text-center text-9xl font-[1000] italic tracking-tighter text-slate-900 outline-none placeholder:text-slate-50 border-none focus:ring-0"})}),e.jsx("p",{className:"text-xl font-black text-slate-300 uppercase italic tracking-widest mt-2",children:"mg/dL"})]}),e.jsx("button",{disabled:!r,onClick:()=>o("verdict"),className:"w-full py-8 bg-slate-900 text-white rounded-[2.5rem] font-black uppercase text-[12px] tracking-[0.4em] shadow-2xl disabled:opacity-10 transition-all active:scale-95",children:"GENERAR VEREDICTO"})]}):e.jsxs(N.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},className:"space-y-8",children:[e.jsxs("div",{className:`p-8 rounded-[3rem] ${n.bg} border border-black/5 relative overflow-hidden`,children:[e.jsx(R,{className:"absolute right-6 top-6 text-black/5",size:40}),e.jsx("p",{className:"text-[10px] font-black text-slate-400 uppercase tracking-widest mb-3",children:"Conclusión IA"}),e.jsx("h4",{className:`text-4xl font-[1000] italic uppercase tracking-tighter ${n.color} mb-4 leading-none`,children:n.label}),e.jsxs("p",{className:"text-slate-700 font-bold leading-tight italic text-lg",children:['"',n.insight,'"']})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"bg-slate-50 p-8 rounded-[2.5rem] text-center border border-slate-100",children:[e.jsx("span",{className:"text-[9px] font-black text-slate-400 uppercase block mb-2 tracking-widest",children:"Delta Glucosa"}),e.jsxs("span",{className:"text-4xl font-[1000] text-slate-900 italic tracking-tighter",children:[Number(r)-(t.bloodGlucoseValue||100)>0?"+":"",Number(r)-(t.bloodGlucoseValue||100)]})]}),e.jsxs("div",{className:"bg-slate-50 p-8 rounded-[2.5rem] text-center border border-slate-100",children:[e.jsx("span",{className:"text-[9px] font-black text-slate-400 uppercase block mb-2 tracking-widest",children:"Confianza IA"}),e.jsxs("span",{className:"text-4xl font-[1000] text-indigo-600 italic tracking-tighter",children:[Math.round(n.score*100),"%"]})]})]}),e.jsxs("button",{onClick:()=>s(t.id,Number(r),n.score,n.insight),className:"w-full py-8 bg-indigo-600 text-white rounded-[2.5rem] font-black uppercase text-[12px] tracking-[0.4em] shadow-2xl flex items-center justify-center gap-4 hover:bg-slate-900 transition-all active:scale-95",children:[e.jsx(B,{size:24})," FINALIZAR APRENDIZAJE"]})]})]})})]})},Dt=new zt(""),ve=async t=>{try{return null}catch(a){return console.error("Gemini Error:",a),JSON.stringify({totalCarbs:20,calories:150,protein:5,fat:5,glycemicIndex:"Medio",optimizationTip:"No pudimos conectar con la IA, mostrando valores estimados."})}},Ft="v4.7-2026-INSIGHTS",_t={analyzeMetabolicTrends(t,a){const s=[];if(!t||t.length<5)return s;const r=t.filter(l=>{const o=new Date(l.timestamp).getHours();return o>=12&&o<=15});r.length>=3&&r.filter(o=>o.value>180).length/r.length>.6&&s.push({type:"WARNING",message:"Detectamos picos de glucosa recurrentes después de tus almuerzos.",suggestion:`Tu ratio actual es 1U:${a.clinicalConfig?.insulinRatioSchedule?.[0]?.ratio||"10"}g. ¿Has considerado ajustar el tiempo de espera pre-comida?`});const i=t.filter(l=>{const o=new Date(l.timestamp).getDay();return o===0||o===6});return i.length>0&&i.reduce((o,c)=>o+c.value,0)/i.length>160&&s.push({type:"TIP",message:"Tus niveles tienden a subir los fines de semana.",suggestion:"Pequeños ajustes en la actividad física durante el sábado podrían ayudarte a mantener tu meta."}),s},async findHistoricalImpact(t,a){const s=(t||"").toLowerCase().trim();if(!s||!Array.isArray(a)||a.length===0)return{trendMsg:"",adjustment:0};const r=s.split(/\s+/).filter(l=>l.length>3);return a.filter(l=>{if(!l||!l.userInput)return!1;const o=l.userInput.toLowerCase();return r.some(c=>o.includes(c))}).slice(0,5).length===0?{trendMsg:"Nuevo patrón detectado.",adjustment:0}:{trendMsg:"Patrón reconocido basado en tu historial previo.",adjustment:0}},async processMetabolicInference(t,a,s,r=100){const i=performance.now();try{const l=await ve(t);if(!l)throw new Error("La IA no pudo procesar el texto.");let o;try{o=typeof l=="string"?JSON.parse(l):l}catch{throw new Error("Formato de respuesta de IA inválido.")}const{trendMsg:c}=await this.findHistoricalImpact(t,a),n={totalCarbs:o.totalCarbs||0,calories:o.calories||0,protein:o.protein||0,fat:o.fat||0,glycemicIndex:o.glycemicIndex||"Bajo",aiContextualNote:c,optimizationTip:o.optimizationTip||"Procesa con normalidad."};return this.logInferencePerformance(t,n,i),n}catch(l){throw console.error("MetraCore Error:",l.message),new Error(l.message||"Fallo en la inferencia metabólica.")}},async logInferencePerformance(t,a,s){try{if(!a)return;await de(O(y,"anonymous_training_logs"),{algo:Ft,input_len:t?.length||0,carbs:a.totalCarbs||0,ms:Math.round(performance.now()-s),timestamp:Y()})}catch(r){console.warn("Log performance fallido:",r)}}},Bt=({insight:t,onAction:a})=>{const s={WARNING:{bg:"bg-red-50",border:"border-red-200",icon:e.jsx(at,{className:"text-red-500",size:20}),accent:"text-red-600",label:"Alerta de Patrón"},TIP:{bg:"bg-blue-50",border:"border-blue-200",icon:e.jsx(st,{className:"text-blue-500",size:20}),accent:"text-blue-600",label:"Sugerencia Bio"},SUCCESS:{bg:"bg-emerald-50",border:"border-emerald-200",icon:e.jsx(R,{className:"text-emerald-500",size:20}),accent:"text-emerald-600",label:"Logro Detectado"}}[t.type];return e.jsxs(N.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},whileHover:{scale:1.01},className:`${s.bg} ${s.border} border-2 p-6 rounded-[2.5rem] relative overflow-hidden shadow-sm`,children:[e.jsx("div",{className:"absolute -right-4 -top-4 opacity-5 text-slate-900",children:e.jsx(X,{size:120})}),e.jsxs("div",{className:"relative z-10",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"p-2 bg-white rounded-xl shadow-sm",children:s.icon}),e.jsx("span",{className:`text-[10px] font-black uppercase tracking-[0.2em] ${s.accent}`,children:s.label})]}),e.jsx("h4",{className:"text-lg font-[1000] text-slate-900 leading-tight tracking-tighter mb-2 italic uppercase",children:t.message}),e.jsx("p",{className:"text-sm text-slate-600 font-medium leading-relaxed mb-6",children:t.suggestion}),a&&e.jsxs("button",{onClick:a,className:"flex items-center gap-2 text-[10px] font-black uppercase tracking-widest text-slate-400 hover:text-slate-900 transition-colors",children:["Explorar en detalle ",e.jsx(P,{size:14})]})]})]})},Gt=({pendingMeal:t,onOpenClosure:a})=>e.jsxs(N.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,scale:.95},className:"group relative overflow-hidden bg-slate-900 rounded-[3rem] p-8 text-white shadow-2xl shadow-indigo-200/20 mb-8",children:[e.jsx("div",{className:"absolute -right-20 -top-20 w-64 h-64 bg-indigo-600/20 blur-[80px] rounded-full group-hover:bg-indigo-600/30 transition-all duration-700"}),e.jsxs("div",{className:"relative z-10",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-indigo-600 rounded-2xl flex items-center justify-center shadow-lg shadow-indigo-500/40",children:e.jsx(X,{size:20,className:"text-white"})}),e.jsxs("div",{children:[e.jsx("span",{className:"text-[10px] font-black uppercase tracking-[0.3em] text-indigo-400 block leading-none mb-1",children:"Cierre de Bucle"}),e.jsx("span",{className:"text-[9px] font-bold text-white/40 uppercase tracking-widest",children:"Protocolo de Aprendizaje"})]})]}),e.jsxs("div",{className:"px-3 py-1 bg-white/5 border border-white/10 rounded-full flex items-center gap-2",children:[e.jsx(K,{size:12,className:"text-indigo-400"}),e.jsx("span",{className:"text-[10px] font-black",children:"+2h Transcurridas"})]})]}),e.jsxs("h3",{className:"text-3xl font-[1000] italic uppercase tracking-tighter leading-none mb-4",children:["¿Cómo reaccionó tu cuerpo al ",e.jsx("br",{})," ",e.jsx("span",{className:"text-indigo-500",children:t.foodName}),"?"]}),e.jsx("p",{className:"text-[11px] font-bold text-white/40 uppercase tracking-[0.15em] mb-8 max-w-[280px] leading-relaxed",children:"Tu Bio-Core necesita el dato post-prandial para optimizar futuros bolos."}),e.jsxs("button",{onClick:a,className:"w-full py-6 bg-white text-slate-900 rounded-[2rem] font-[1000] uppercase text-[11px] tracking-[0.25em] flex items-center justify-center gap-3 hover:bg-indigo-500 hover:text-white transition-all active:scale-95 shadow-xl",children:["VALIDAR MÉTRICA ",e.jsx(P,{size:18})]})]})]}),ne=({currentUser:t,onStartClick:a,history:s=[]})=>{const r=D(),[i,l]=d.useState(""),[o,c]=d.useState(!1),[n,p]=d.useState(null),[u,j]=d.useState(null),b=d.useMemo(()=>!t||!s.length?[]:_t.analyzeMetabolicTrends(s,t),[s,t]),v=d.useMemo(()=>{if(!s.length)return null;const m=new Date().getTime(),g=m-14400*1e3,w=m-1.5*60*60*1e3;return s.find(S=>{const $=new Date(S.timestamp||S.date).getTime();return S.type==="MEAL"&&!S.postPrandialGlucose&&$>g&&$<w})},[s]),x=d.useMemo(()=>{const m=new Date;return m.setDate(m.getDate()-7),s.filter(g=>g.timestamp&&new Date(g.timestamp)>=m).map(g=>({time:new Date(g.timestamp).toLocaleDateString("es-CL",{weekday:"short"}),value:g.bloodGlucoseValue||g.value,fullDate:new Date(g.timestamp).getTime()})).sort((g,w)=>g.fullDate-w.fullDate)},[s]),f=async()=>{const m=parseFloat(i);if(!m||m<=0){p({type:"error",msg:"Valor inválido"});return}c(!0);try{if(!t?.id){p({type:"error",msg:"Bio-Identidad requerida"});return}await k.addHistoryEntry(t.id,{value:m,timestamp:new Date().toISOString(),type:"GLUCOSE",notes:"Quick Log Automático"}),p({type:"success",msg:"Sincronización completa"}),l(""),setTimeout(()=>p(null),3e3)}catch{p({type:"error",msg:"Fallo de enlace"})}finally{c(!1)}};return e.jsxs("div",{className:"max-w-6xl mx-auto space-y-10 pb-28 px-6 pt-6 antialiased",children:[e.jsxs("section",{className:"relative overflow-hidden bg-white rounded-[4rem] border border-slate-50 p-10 md:p-16 shadow-[0_20px_50px_rgba(0,0,0,0.02)]",children:[e.jsx("div",{className:"absolute top-0 right-0 p-12 text-indigo-600/5 pointer-events-none rotate-12",children:e.jsx(T,{size:400})}),e.jsxs(N.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},className:"inline-flex items-center gap-2 px-5 py-2 rounded-full bg-indigo-50 text-indigo-600 text-[10px] font-black uppercase tracking-[0.2em] mb-10",children:[e.jsx(F,{size:14,className:"fill-current"})," Vitametra Core v4.2"]}),e.jsxs("div",{className:"relative",children:[e.jsx("h1",{className:"text-5xl md:text-8xl font-[1000] text-slate-900 tracking-tighter leading-[0.9] mb-6 italic uppercase",children:t?.name?e.jsxs(e.Fragment,{children:["Hola, ",e.jsx("span",{className:"text-indigo-600",children:t.name.split(" ")[0]})]}):e.jsxs(e.Fragment,{children:["Control ",e.jsx("span",{className:"text-indigo-600",children:"Total"})]})}),e.jsx("p",{className:"max-w-xl text-slate-400 font-bold text-lg mb-12 leading-tight uppercase tracking-tight",children:"Análisis biométrico en tiempo real impulsado por inteligencia artificial."})]}),e.jsxs("div",{className:"max-w-md mb-12",children:[e.jsxs("div",{className:"relative group",children:[e.jsx("div",{className:"absolute -inset-1 bg-indigo-600/20 rounded-[3rem] blur opacity-0 group-focus-within:opacity-100 transition duration-500"}),e.jsx("input",{type:"number",inputMode:"numeric",placeholder:"000 mg/dL",value:i,onChange:m=>l(m.target.value),className:"relative w-full px-10 py-7 bg-slate-50 border-none rounded-[2.5rem] text-3xl font-[1000] outline-none transition-all placeholder:text-slate-200 italic tracking-tighter"}),e.jsx("button",{onClick:f,disabled:o,className:"absolute right-3 top-3 bottom-3 px-8 bg-slate-900 text-white rounded-[2rem] font-black uppercase text-[10px] tracking-widest hover:bg-indigo-600 transition-all flex items-center gap-2",children:o?e.jsx(T,{className:"animate-spin",size:16}):"REGISTRAR"})]}),e.jsx(_,{children:n&&e.jsxs(N.div,{initial:{opacity:0,y:5},animate:{opacity:1,y:0},exit:{opacity:0},className:`mt-4 text-[9px] font-black uppercase tracking-[0.2em] flex items-center gap-2 ${n.type==="error"?"text-rose-500":"text-emerald-500"}`,children:[n.type==="error"?e.jsx(W,{size:14}):e.jsx(J,{size:14}),n.msg]})})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[e.jsxs("button",{onClick:a,className:"px-12 py-6 bg-indigo-600 text-white rounded-[2.5rem] font-[1000] uppercase text-[12px] tracking-[0.2em] flex items-center justify-center gap-4 hover:bg-slate-900 transition-all shadow-2xl shadow-indigo-100 active:scale-95",children:["PANEL DE ANÁLISIS ",e.jsx(P,{size:20})]}),e.jsx("button",{onClick:()=>r("/planes"),className:"px-12 py-6 bg-white border border-slate-100 text-slate-400 rounded-[2.5rem] font-black uppercase text-[11px] tracking-[0.2em] hover:bg-slate-50 transition-all active:scale-95",children:"Ver Planes (Aviones)"})]})]}),e.jsx(_,{children:v&&e.jsx("section",{className:"px-2",children:e.jsx(Gt,{pendingMeal:{id:v.id,foodName:v.foodName||"Análisis Previo",timestamp:v.timestamp||v.date},onOpenClosure:()=>j(v)})})}),e.jsxs("section",{className:"space-y-8",children:[e.jsxs("div",{className:"flex items-end justify-between px-4",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"p-4 bg-slate-900 text-indigo-400 rounded-3xl",children:e.jsx(X,{size:28})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-[10px] font-black text-slate-400 uppercase tracking-[0.3em] mb-1",children:"Motor de Inferencia IA"}),e.jsx("h4",{className:"text-3xl font-[1000] text-slate-900 tracking-tighter italic uppercase leading-none",children:"Bio-Insights"})]})]}),e.jsx(he,{size:32,className:"text-slate-100"})]}),b.length>0?e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:b.map((m,g)=>e.jsx(Bt,{insight:m},g))}):e.jsxs("div",{className:"bg-white rounded-[3.5rem] p-16 border border-slate-50 text-center shadow-sm",children:[e.jsx("div",{className:"w-20 h-20 bg-indigo-50 rounded-[2.5rem] flex items-center justify-center mx-auto mb-6 text-indigo-200",children:e.jsx(R,{size:32})}),e.jsx("p",{className:"text-slate-900 text-lg font-[1000] uppercase italic tracking-tighter",children:"Esperando Bio-Data"}),e.jsxs("p",{className:"text-slate-400 text-[10px] font-bold uppercase tracking-widest mt-2 leading-relaxed",children:["Analiza una comida o registra tu glucosa ",e.jsx("br",{})," para activar patrones."]})]})]}),e.jsxs("section",{className:"bg-white rounded-[4rem] border border-slate-50 p-10 md:p-14 shadow-sm relative overflow-hidden",children:[e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center mb-16 gap-6",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(ge,{size:16,className:"text-indigo-600"}),e.jsx("h3",{className:"text-[10px] font-black text-slate-400 uppercase tracking-[0.3em]",children:"Fluctuación Glicémica"})]}),e.jsxs("h4",{className:"text-4xl font-[1000] text-slate-900 tracking-tighter italic uppercase leading-none",children:["Tendencia ",e.jsx("span",{className:"text-indigo-600",children:"Vital"})]})]}),e.jsxs("div",{className:"flex items-center gap-3 px-6 py-3 bg-slate-50 rounded-2xl border border-slate-100",children:[e.jsx(be,{size:18,className:"text-indigo-400"}),e.jsx("span",{className:"text-[10px] font-black text-slate-900 uppercase tracking-widest",children:"Últimos 7 Días"})]})]}),e.jsx("div",{className:"h-[350px] w-full",children:x.length>0?e.jsx(ye,{width:"100%",height:"100%",children:e.jsxs(ke,{data:x,children:[e.jsx(Ce,{strokeDasharray:"10 10",vertical:!1,stroke:"#f1f5f9"}),e.jsx(Se,{dataKey:"time",axisLine:!1,tickLine:!1,tick:{fontSize:9,fontWeight:900,fill:"#cbd5e1"},dy:20}),e.jsx(ze,{hide:!0,domain:["dataMin - 20","dataMax + 20"]}),e.jsx(Ae,{contentStyle:{borderRadius:"2rem",border:"none",boxShadow:"0 25px 50px -12px rgba(0,0,0,0.1)",fontSize:"11px",fontWeight:"900",padding:"15px"},cursor:{stroke:"#4f46e5",strokeWidth:2,strokeDasharray:"5 5"}}),e.jsx(Ie,{y:100,stroke:"#e2e8f0",strokeWidth:1}),e.jsx(Te,{type:"monotone",dataKey:"value",stroke:"#4f46e5",strokeWidth:6,dot:{r:6,fill:"#4f46e5",strokeWidth:4,stroke:"#fff"},activeDot:{r:10,strokeWidth:0},animationDuration:2e3})]})}):e.jsxs("div",{className:"flex flex-col items-center justify-center h-full space-y-4 opacity-30",children:[e.jsx(it,{size:60,strokeWidth:1,className:"text-slate-300"}),e.jsx("p",{className:"text-[10px] font-black uppercase tracking-[0.4em]",children:"Visualización Desactivada"})]})})]}),e.jsxs("footer",{className:"flex flex-wrap justify-center items-center gap-10 opacity-30 pt-10 border-t border-slate-100",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(lt,{size:16}),e.jsx("span",{className:"text-[9px] font-black uppercase tracking-[0.4em]",children:"AES-256 Health Guard"})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(T,{size:16}),e.jsx("span",{className:"text-[9px] font-black uppercase tracking-[0.4em]",children:"Predictive Engine v4"})]})]})]})},Ht=({history:t,onEntryClick:a})=>{const s=l=>({desayuno:{bg:"bg-orange-50",text:"text-orange-600"},almuerzo:{bg:"bg-indigo-50",text:"text-indigo-600"},cena:{bg:"bg-blue-50",text:"text-blue-600"},snack:{bg:"bg-emerald-50",text:"text-emerald-600"}})[l.toLowerCase()]||{bg:"bg-slate-50",text:"text-slate-500"},r=l=>l?l>180?{color:"text-rose-500",icon:e.jsx(ge,{size:14}),label:"Alto"}:l<70?{color:"text-amber-500",icon:e.jsx(rt,{size:14}),label:"Bajo"}:{color:"text-emerald-500",icon:e.jsx(J,{size:14}),label:"En Rango"}:null;if(t.length===0)return e.jsxs("div",{className:"flex flex-col items-center justify-center py-40 text-center px-6",children:[e.jsx("div",{className:"w-24 h-24 bg-white rounded-[2.5rem] shadow-xl shadow-slate-100 flex items-center justify-center mb-8",children:e.jsx(me,{size:40,className:"text-slate-200"})}),e.jsx("h3",{className:"text-xl font-[1000] text-slate-900 uppercase italic tracking-tighter",children:"Memoria Vacía"}),e.jsx("p",{className:"text-slate-400 text-[10px] font-bold uppercase tracking-widest mt-2 max-w-[200px]",children:"Comienza a analizar tus comidas para generar tendencias."})]});const i=t.reduce((l,o)=>l+(o.totalCarbs||0),0);return e.jsxs("div",{className:"max-w-md mx-auto space-y-8 pb-40 px-6 pt-10 antialiased",children:[e.jsxs("header",{className:"flex flex-col gap-6 mb-12",children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-[10px] font-black text-indigo-600 uppercase tracking-[0.3em] mb-1",children:"Ecosistema Bio-Data"}),e.jsxs("h2",{className:"text-5xl font-[1000] text-slate-900 tracking-tighter uppercase italic leading-[0.85]",children:["Mis ",e.jsx("br",{}),e.jsx("span",{className:"text-indigo-600/20",children:"Tendencias"})]})]}),e.jsxs("div",{className:"bg-slate-900 text-white p-4 rounded-[2rem] shadow-xl flex flex-col items-center min-w-[70px]",children:[e.jsx("span",{className:"text-2xl font-[1000] leading-none",children:t.length}),e.jsx("span",{className:"text-[7px] font-black uppercase tracking-widest mt-1 opacity-60",children:"Logs"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{className:"bg-indigo-600 p-4 rounded-[2rem] text-white shadow-lg shadow-indigo-100",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2 opacity-80",children:[e.jsx(F,{size:12}),e.jsx("span",{className:"text-[8px] font-black uppercase tracking-widest",children:"Carga Semanal"})]}),e.jsxs("p",{className:"text-2xl font-[1000] italic",children:[i,"g"]}),e.jsx("p",{className:"text-[7px] font-bold uppercase opacity-60",children:"Carbohidratos Netos"})]}),e.jsxs("div",{className:"bg-white p-4 rounded-[2rem] border border-slate-100 shadow-sm",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2 text-indigo-600",children:[e.jsx(R,{size:12}),e.jsx("span",{className:"text-[8px] font-black uppercase tracking-widest",children:"Estado IA"})]}),e.jsx("p",{className:"text-2xl font-[1000] italic text-slate-900",children:"Activo"}),e.jsx("p",{className:"text-[7px] font-bold uppercase text-slate-400",children:"Patrones detectados"})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-[10px] font-black text-slate-400 uppercase tracking-[0.3em] ml-2",children:"Cronología Metabólica"}),t.map((l,o)=>{const c=s(l.mealType||""),n=r(l.bloodGlucoseValue);return e.jsxs(N.div,{initial:{opacity:0,x:-10},animate:{opacity:1,x:0},transition:{delay:o*.05},onClick:()=>a?.(l),className:"group bg-white rounded-[2.5rem] p-5 border border-slate-50 shadow-[0_10px_30px_rgba(0,0,0,0.02)] hover:shadow-xl hover:shadow-indigo-100/30 transition-all cursor-pointer active:scale-[0.97]",children:[e.jsxs("div",{className:"flex items-center justify-between mb-5",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:`px-4 py-1.5 rounded-full ${c.bg}`,children:e.jsx("span",{className:`text-[8px] font-black uppercase tracking-widest ${c.text}`,children:l.mealType||"Análisis"})}),e.jsxs("div",{className:"flex items-center gap-1.5 px-3 py-1.5 bg-slate-50 rounded-full text-slate-400",children:[e.jsx(K,{size:10}),e.jsx("span",{className:"text-[9px] font-bold",children:new Date(l.createdAt?.seconds*1e3||l.date).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})})]})]}),n&&e.jsxs("div",{className:`flex items-center gap-1.5 ${n.color}`,children:[n.icon,e.jsx("span",{className:"text-[9px] font-black uppercase tracking-widest",children:n.label})]})]}),e.jsxs("div",{className:"flex items-center gap-5",children:[e.jsxs("div",{className:"relative h-20 w-20 shrink-0",children:[e.jsx("div",{className:"absolute inset-0 bg-indigo-600/10 rounded-[1.8rem] -rotate-6 group-hover:rotate-0 transition-transform"}),e.jsx("img",{src:l.imageUrl||"https://images.unsplash.com/photo-1490645935967-10de6ba17061?q=80&w=200&auto=format&fit=crop",className:"relative h-full w-full object-cover rounded-[1.8rem] shadow-md group-hover:scale-105 transition-transform",alt:""})]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h4",{className:"text-slate-900 font-[1000] text-xl truncate uppercase italic tracking-tighter mb-3 leading-none",children:l.foodName||"Carga de Datos"}),e.jsxs("div",{className:"flex items-center gap-6",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-[8px] font-black text-slate-400 uppercase tracking-widest mb-1",children:"Carbos"}),e.jsxs("span",{className:"text-xl font-[1000] text-indigo-600 leading-none",children:[l.totalCarbs,"g"]})]}),e.jsx("div",{className:"h-6 w-[1px] bg-slate-100 self-end mb-1"}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-[8px] font-black text-slate-400 uppercase tracking-widest mb-1",children:"Insulina"}),e.jsxs("span",{className:"text-xl font-[1000] text-slate-900 leading-none",children:[l.finalInsulinUnits||l.recommendedInsulinUnits||"0",e.jsx("span",{className:"text-[10px] ml-0.5",children:"U"})]})]})]})]}),e.jsx("div",{className:"w-10 h-10 bg-slate-50 rounded-full flex items-center justify-center text-slate-300 group-hover:bg-indigo-600 group-hover:text-white transition-all",children:e.jsx(U,{size:20})})]})]},l.id||o)})]}),e.jsx("footer",{className:"pt-10 pb-20 text-center",children:e.jsxs("div",{className:"inline-flex items-center gap-2 px-6 py-3 bg-slate-50 rounded-full border border-slate-100",children:[e.jsx(be,{size:14,className:"text-indigo-600"}),e.jsx("span",{className:"text-[9px] font-black text-slate-400 uppercase tracking-widest",children:"Sincronización Completa"})]})})]})},$t=({currentUser:t})=>{const[a,s]=d.useState(t.aiMemory||""),[r,i]=d.useState(!1),[l,o]=d.useState(!1);d.useEffect(()=>{t.aiMemory&&s(t.aiMemory)},[t.aiMemory]);const c=async()=>{i(!0);try{await k.updateUser({id:t.id,aiMemory:a}),o(!1)}catch(n){console.error("Error al guardar la memoria IA:",n),alert("No se pudo sincronizar la memoria con el núcleo.")}finally{i(!1)}};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-indigo-600 to-blue-500 rounded-2xl flex items-center justify-center text-white shadow-lg shadow-indigo-100",children:e.jsx(nt,{size:20})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-black tracking-tighter text-slate-900 uppercase leading-none",children:"Memoria Bio-Digital"}),e.jsx("p",{className:"text-[10px] font-black text-indigo-600 uppercase tracking-widest mt-1",children:"LTM (Long Term Memory)"})]})]}),!l&&e.jsx("button",{onClick:()=>o(!0),className:"p-2 bg-slate-50 hover:bg-slate-100 rounded-xl transition-colors",children:e.jsx(pe,{size:18,className:"text-slate-400"})})]}),e.jsx("div",{className:"relative",children:l?e.jsxs("div",{className:"space-y-4 animate-in fade-in zoom-in-95 duration-200",children:[e.jsx("textarea",{value:a,onChange:n=>s(n.target.value),placeholder:"Ej: 'Suelo tener picos después de la pasta', 'Hago ejercicio a las 19:00', 'Mi cuerpo reacciona lento a la insulina rápida'...",className:"w-full h-40 bg-slate-50 border-2 border-indigo-50 rounded-[2rem] p-6 text-sm font-medium text-slate-700 outline-none focus:border-indigo-200 focus:bg-white transition-all resize-none"}),e.jsx("button",{onClick:c,disabled:r,className:"w-full bg-indigo-600 text-white p-5 rounded-2xl font-black uppercase text-[10px] tracking-[0.2em] flex items-center justify-center gap-3 shadow-lg shadow-indigo-100 active:scale-95 disabled:opacity-50 transition-all",children:r?e.jsx(L,{className:"animate-spin",size:16}):e.jsxs(e.Fragment,{children:[e.jsx(q,{size:16})," Consolidar Aprendizaje"]})})]}):e.jsxs("div",{onClick:()=>o(!0),className:"group cursor-pointer bg-gradient-to-br from-slate-50 to-white border border-slate-100 rounded-[2.5rem] p-7 relative overflow-hidden transition-all hover:shadow-md",children:[e.jsx("div",{className:"absolute -top-4 -right-4 text-slate-50 group-hover:text-indigo-50 transition-colors",children:e.jsx(R,{size:80})}),a?e.jsxs("div",{className:"relative z-10",children:[e.jsxs("p",{className:"text-sm font-bold text-slate-600 leading-relaxed italic",children:['"',a,'"']}),e.jsxs("div",{className:"mt-4 flex items-center gap-2 text-[9px] font-black text-indigo-400 uppercase tracking-widest",children:[e.jsx(ot,{size:12})," Datos cargados en el Agente AI"]})]}):e.jsx("div",{className:"relative z-10 py-4 text-center",children:e.jsx("p",{className:"text-xs font-bold text-slate-400 uppercase tracking-wider",children:"Sin memoria activa. Haz clic para entrenar a tu IA."})})]})}),e.jsxs("div",{className:"flex items-center gap-2 px-2",children:[e.jsx("div",{className:"w-1.5 h-1.5 bg-emerald-500 rounded-full animate-pulse"}),e.jsx("p",{className:"text-[9px] font-black text-slate-400 uppercase tracking-[0.15em]",children:"Optimización metabólica en tiempo real activa"})]})]})},Ot=({currentUser:t,onUpdate:a})=>{const[s,r]=d.useState(!1),[i,l]=d.useState({diabetesType:t.clinicalConfig?.diabetesType||"Type 1",isf:t.clinicalConfig?.insulinSensitivityFactor||50,target:t.clinicalConfig?.targetGlucose||100,ratio:t.insulinRatioSchedule?.[0]?.ratio||15}),o=async()=>{r(!0);try{const c={id:t.id,clinicalConfig:{...t.clinicalConfig,diabetesType:i.diabetesType,insulinSensitivityFactor:i.isf,targetGlucose:i.target},insulinRatioSchedule:[{startTime:"08:00",ratio:i.ratio}]};await k.updateUser(c),a(c);const n=document.createElement("div");n.className="fixed bottom-10 left-1/2 -translate-x-1/2 bg-slate-900 text-white px-8 py-4 rounded-2xl font-black uppercase text-[10px] tracking-widest shadow-2xl z-[3000] animate-in slide-in-from-bottom-4",n.innerText="✅ PARÁMETROS RECALIBRADOS",document.body.appendChild(n),setTimeout(()=>n.remove(),3e3)}catch(c){console.error(c),alert("❌ Error al sincronizar con el Bio-Core")}finally{r(!1)}};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"w-10 h-10 bg-emerald-600 rounded-2xl flex items-center justify-center text-white shadow-lg shadow-emerald-100",children:e.jsx(T,{size:20})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-black tracking-tighter text-slate-900 uppercase leading-none",children:"Calibración"}),e.jsx("p",{className:"text-[10px] font-black text-emerald-600 uppercase tracking-widest mt-1",children:"Motor Clínico"})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-slate-50 p-4 rounded-2xl border border-slate-100",children:[e.jsx("label",{className:"text-[9px] font-black uppercase text-slate-400 block mb-2 tracking-widest",children:"Condición"}),e.jsxs("select",{value:i.diabetesType,onChange:c=>l({...i,diabetesType:c.target.value}),className:"w-full bg-white p-3 rounded-xl font-bold text-slate-700 outline-none border border-slate-200",children:[e.jsx("option",{value:"Type 1",children:"Tipo 1"}),e.jsx("option",{value:"Type 2",children:"Tipo 2"}),e.jsx("option",{value:"LADA",children:"LADA"})]})]}),e.jsxs("div",{className:"bg-slate-50 p-4 rounded-2xl border border-slate-100",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsxs("label",{className:"text-[9px] font-black uppercase text-slate-400 tracking-widest",children:["Ratio (1U:",i.ratio,"g)"]}),e.jsx("span",{className:"text-lg font-black text-blue-600",children:i.ratio})]}),e.jsx("input",{type:"range",min:"1",max:"40",value:i.ratio,onChange:c=>l({...i,ratio:parseInt(c.target.value)}),className:"w-full h-1.5 bg-slate-200 rounded-lg appearance-none cursor-pointer accent-blue-600"})]}),e.jsxs("div",{className:"bg-slate-50 p-4 rounded-2xl border border-slate-100",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsxs("label",{className:"text-[9px] font-black uppercase text-slate-400 tracking-widest",children:["Sensibilidad (",i.isf,")"]}),e.jsx("span",{className:"text-lg font-black text-emerald-600",children:i.isf})]}),e.jsx("input",{type:"range",min:"10",max:"200",step:"5",value:i.isf,onChange:c=>l({...i,isf:parseInt(c.target.value)}),className:"w-full h-1.5 bg-slate-200 rounded-lg appearance-none cursor-pointer accent-emerald-500"})]}),e.jsx("button",{onClick:o,disabled:s,className:"w-full bg-slate-900 text-white p-5 rounded-2xl font-black uppercase text-[10px] tracking-[0.2em] flex items-center justify-center gap-3 transition-all active:scale-95 disabled:opacity-50 shadow-xl shadow-slate-200 hover:bg-blue-600",children:s?e.jsx("div",{className:"w-5 h-5 border-2 border-white border-t-transparent rounded-full animate-spin"}):e.jsxs(e.Fragment,{children:[e.jsx(q,{size:16})," Aplicar Cambios"]})})]})]})},Vt=[{id:"sedentary",label:"Sedentario",description:"Poco o nada de ejercicio.",multiplier:"1.2x",icon:e.jsx(ct,{size:20})},{id:"light",label:"Ligero",description:"Ejercicio 1-3 días/semana.",multiplier:"1.375x",icon:e.jsx(dt,{size:20})},{id:"moderate",label:"Moderado",description:"Intenso 3-5 días/semana.",multiplier:"1.55x",icon:e.jsx(F,{size:20})},{id:"active",label:"Muy Activo",description:"Entrenamiento diario.",multiplier:"1.725x",icon:e.jsx(xt,{size:20})},{id:"athlete",label:"Atleta Pro",description:"Esfuerzo físico extremo.",multiplier:"1.9x",icon:e.jsx(mt,{size:20})}],Wt=({selectedId:t,onSelect:a})=>e.jsx("div",{className:"grid gap-3 w-full max-w-md mx-auto",children:Vt.map(s=>e.jsxs("button",{onClick:()=>a(s.id),className:`flex items-center gap-4 p-5 rounded-[2rem] border-2 transition-all active:scale-[0.98] ${t===s.id?"bg-metra-blue border-metra-blue text-white shadow-lg":"bg-slate-50 border-transparent text-metra-dark"}`,children:[e.jsx("div",{className:`p-3 rounded-2xl ${t===s.id?"bg-white/20":"bg-white text-metra-blue"}`,children:s.icon}),e.jsxs("div",{className:"flex-1 text-left",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"font-black uppercase text-[10px] tracking-widest",children:s.label}),e.jsx("span",{className:"text-[9px] font-black opacity-60",children:s.multiplier})]}),e.jsx("p",{className:"text-[10px] font-bold opacity-70",children:s.description})]})]},s.id))}),qt=({targetWeight:t,targetHba1c:a,onUpdate:s,unit:r})=>e.jsxs("div",{className:"w-full space-y-8 animate-in fade-in slide-in-from-bottom-4",children:[e.jsxs("div",{className:"bg-slate-50 p-6 rounded-[2.5rem] border border-slate-100",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[e.jsx("div",{className:"p-3 bg-white rounded-2xl shadow-sm text-metra-blue",children:e.jsx(fe,{size:20})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-[10px] font-black text-slate-400 uppercase tracking-widest",children:"Peso Objetivo"}),e.jsxs("p",{className:"text-xl font-[1000] text-metra-dark italic uppercase tracking-tighter",children:[t," kg"]})]})]}),e.jsx("input",{type:"range",min:"40",max:"150",value:t,onChange:i=>s({targetWeight:Number(i.target.value)}),className:"w-full h-2 bg-slate-200 rounded-lg appearance-none cursor-pointer accent-metra-blue"}),e.jsxs("div",{className:"flex justify-between mt-2 px-1",children:[e.jsx("span",{className:"text-[9px] font-black text-slate-300 uppercase",children:"40kg"}),e.jsx("span",{className:"text-[9px] font-black text-slate-300 uppercase",children:"150kg"})]})]}),e.jsxs("div",{className:"bg-metra-dark p-6 rounded-[2.5rem] shadow-xl relative overflow-hidden",children:[e.jsx("div",{className:"absolute -top-10 -right-10 w-32 h-32 bg-metra-blue/10 blur-3xl rounded-full"}),e.jsxs("div",{className:"flex items-center gap-3 mb-6 relative z-10",children:[e.jsx("div",{className:"p-3 bg-white/10 rounded-2xl text-metra-blue backdrop-blur-md",children:e.jsx(je,{size:20})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-[10px] font-black text-white/40 uppercase tracking-widest",children:"HbA1c Objetivo"}),e.jsxs("p",{className:"text-xl font-[1000] text-white italic uppercase tracking-tighter",children:[a,"%"]})]})]}),e.jsx("input",{type:"range",min:"4.0",max:"9.0",step:"0.1",value:a,onChange:i=>s({targetHba1c:Number(i.target.value)}),className:"w-full h-2 bg-white/10 rounded-lg appearance-none cursor-pointer accent-metra-blue relative z-10"}),e.jsxs("div",{className:"flex justify-between mt-2 px-1 relative z-10",children:[e.jsx("span",{className:"text-[9px] font-black text-white/20 uppercase",children:"4.0%"}),e.jsx("span",{className:"text-[9px] font-black text-white/20 uppercase",children:"9.0%"})]})]})]}),Kt=({currentUser:t,onUpdateUser:a})=>{const[s,r]=d.useState(!1),[i,l]=d.useState(!1),[o,c]=d.useState(null),[n,p]=d.useState(t.insulinRatioSchedule||[{startTime:"08:00",ratio:12}]),u=async m=>{const g=m.target.files?.[0];if(!(!g||!t?.id)){r(!0);try{const w=Oe(Ve,`avatars/${t.id}`);await We(w,g);const S=await qe(w);await E(z(y,"users",t.id),{photoURL:S}),a({photoURL:S})}catch(w){console.error("Error subiendo Bio-Avatar:",w)}finally{r(!1)}}},j=async()=>{l(!0);try{const m=z(y,"users",t.id);await E(m,{insulinRatioSchedule:n,updatedAt:new Date().toISOString()}),a({insulinRatioSchedule:n})}catch(m){console.error("Error guardando parámetros:",m)}finally{l(!1)}},b=(m,g)=>{const w=[...n];w[m].ratio=Number(g),p(w)},v=async m=>{a({activityLevel:m});const g=z(y,"users",t.id);await E(g,{activityLevel:m}),setTimeout(()=>c(null),300)},x=async m=>{a({glucoseUnitPreference:m});const g=z(y,"users",t.id);await E(g,{glucoseUnitPreference:m}),c(null)},f=async m=>{a(m);const g=z(y,"users",t.id);await E(g,m)};return e.jsxs("div",{className:"min-h-screen bg-[#FBFBFE] pb-40",children:[e.jsxs("header",{className:"relative pt-20 pb-12 px-6 bg-white rounded-b-[4rem] shadow-[0_20px_50px_rgba(0,0,0,0.02)] overflow-hidden",children:[e.jsx("div",{className:"absolute top-0 right-0 w-64 h-64 bg-indigo-50 blur-[100px] rounded-full -mr-32 -mt-32 opacity-60"}),e.jsxs("div",{className:"relative flex flex-col items-center",children:[e.jsxs(N.div,{initial:{scale:.9,opacity:0},animate:{scale:1,opacity:1},className:"relative",children:[e.jsx("div",{className:"w-32 h-32 rounded-[3rem] p-1 bg-gradient-to-tr from-indigo-600 to-blue-400 shadow-2xl shadow-indigo-100",children:e.jsx("div",{className:"w-full h-full rounded-[2.8rem] bg-white overflow-hidden flex items-center justify-center border-4 border-white",children:s?e.jsx(L,{className:"animate-spin text-indigo-500",size:32}):t?.photoURL?e.jsx("img",{src:t.photoURL,alt:"Bio-Profile",className:"w-full h-full object-cover"}):e.jsx(Z,{size:48,className:"text-slate-200"})})}),e.jsxs("label",{className:"absolute -bottom-2 -right-2 bg-slate-900 text-white p-3 rounded-2xl shadow-xl border-4 border-white cursor-pointer hover:scale-110 active:scale-90 transition-all",children:[e.jsx(pt,{size:18,strokeWidth:2.5}),e.jsx("input",{type:"file",className:"hidden",onChange:u})]})]}),e.jsxs("h2",{className:"mt-8 text-4xl font-[1000] tracking-tighter text-slate-900 italic uppercase leading-none",children:[t?.firstName||"Usuario"," ",e.jsx("span",{className:"text-indigo-600 italic",children:"PRO"})]}),e.jsxs("div",{className:"mt-4 inline-flex items-center gap-2 px-4 py-1.5 bg-slate-900 rounded-full",children:[e.jsx(he,{size:12,className:"text-indigo-400"}),e.jsx("span",{className:"text-[9px] font-black text-white uppercase tracking-[0.2em]",children:"Bio-Core Identity Active"})]})]})]}),e.jsxs("main",{className:"px-6 mt-10 space-y-10",children:[e.jsxs("section",{className:"bg-white p-8 rounded-[3rem] border border-slate-50 shadow-sm",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[e.jsx("div",{className:"p-2 bg-indigo-50 text-indigo-600 rounded-xl",children:e.jsx(R,{size:20})}),e.jsx("h3",{className:"text-[10px] font-black text-slate-400 uppercase tracking-[0.3em]",children:"Memoria Cognitiva IA"})]}),e.jsx($t,{currentUser:t})]}),e.jsxs("section",{className:"space-y-6",children:[e.jsx("h3",{className:"text-[10px] font-black text-slate-400 uppercase tracking-[0.3em] ml-4",children:"Calibración de Perfil"}),e.jsxs("div",{className:"bg-white rounded-[3rem] border border-slate-50 shadow-sm overflow-hidden",children:[e.jsx(Q,{icon:e.jsx(T,{className:"text-indigo-600"}),label:"Nivel de Actividad",value:t.activityLevel||"Sin definir",onClick:()=>c("activity")}),e.jsx(Q,{icon:e.jsx(Ne,{className:"text-emerald-500"}),label:"Objetivos Clínicos",value:`${t.targetWeight||"--"}kg • ${t.targetHba1c||"--"}%`,onClick:()=>c("goals")}),e.jsx(Q,{icon:e.jsx(je,{className:"text-rose-500"}),label:"Unidades de Medida",value:t.glucoseUnitPreference||"mg/dL",onClick:()=>c("units"),isLast:!0})]})]}),e.jsx("section",{className:"bg-white p-8 rounded-[3rem] border border-slate-50 shadow-sm",children:e.jsx(Ot,{currentUser:t,onUpdate:m=>a(m)})}),e.jsxs("section",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between px-4",children:[e.jsx("h3",{className:"text-[10px] font-black text-slate-400 uppercase tracking-[0.3em]",children:"Protocolo de Ratios"}),e.jsx(fe,{size:16,className:"text-slate-300"})]}),e.jsx("div",{className:"bg-white rounded-[3.5rem] p-4 border border-slate-50 shadow-sm",children:n.map((m,g)=>e.jsxs("div",{className:`flex items-center justify-between p-6 ${g!==n.length-1?"border-b border-slate-50":""}`,children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-12 h-12 bg-slate-50 rounded-2xl flex items-center justify-center text-indigo-600 border border-slate-100",children:e.jsx(K,{size:20})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-[9px] font-black text-slate-400 uppercase tracking-widest mb-1",children:"Hora Inicio"}),e.jsx("span",{className:"text-lg font-black text-slate-900 italic tracking-tighter",children:m.startTime})]})]}),e.jsxs("div",{className:"flex items-center gap-3 bg-slate-50 p-2 rounded-2xl border border-slate-100",children:[e.jsx("input",{type:"number",value:m.ratio,onChange:w=>b(g,w.target.value),className:"w-16 bg-white border-none rounded-xl py-3 text-center font-black text-indigo-600 shadow-sm outline-none text-xl"}),e.jsx("span",{className:"text-[10px] font-black text-slate-400 uppercase mr-3 italic",children:"g/ui"})]})]},g))})]}),e.jsxs("div",{className:"space-y-4 pt-6",children:[e.jsxs("button",{onClick:j,disabled:i,className:"group relative w-full bg-slate-900 text-white p-7 rounded-[2.5rem] font-black uppercase text-[11px] tracking-[0.3em] overflow-hidden transition-all hover:scale-[1.02] active:scale-95 shadow-xl shadow-indigo-100",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-indigo-600 to-blue-500 opacity-0 group-hover:opacity-100 transition-opacity"}),e.jsx("span",{className:"relative flex items-center justify-center gap-3",children:i?e.jsx(L,{className:"animate-spin"}):e.jsxs(e.Fragment,{children:[e.jsx(B,{size:20,className:"text-indigo-400"})," Sincronizar Bio-Core"]})})]}),e.jsxs("button",{onClick:()=>k.logout(),className:"w-full flex items-center justify-center gap-3 p-6 text-rose-500 font-black text-[11px] uppercase tracking-[0.3em] rounded-[2.5rem] hover:bg-rose-50 transition-all",children:[e.jsx(xe,{size:18})," Finalizar Sesión Segura"]})]})]}),e.jsxs("footer",{className:"py-20 text-center opacity-30",children:[e.jsx(F,{size:20,fill:"currentColor",className:"mx-auto mb-4 text-slate-400"}),e.jsx("p",{className:"text-[9px] font-black text-slate-500 uppercase tracking-[0.6em]",children:"Vitametra Engine v4.2.0 • 2026"})]}),e.jsx(_,{children:o&&e.jsxs("div",{className:"fixed inset-0 z-[2000] flex items-end justify-center",children:[e.jsx(N.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"absolute inset-0 bg-slate-900/40 backdrop-blur-xl",onClick:()=>c(null)}),e.jsxs(N.div,{initial:{y:"100%"},animate:{y:0},exit:{y:"100%"},transition:{type:"spring",damping:25,stiffness:200},className:"relative w-full max-w-lg bg-white rounded-t-[4rem] p-10 shadow-2xl pb-16",children:[e.jsx("div",{className:"w-16 h-1.5 bg-slate-100 rounded-full mx-auto mb-10"}),e.jsxs("div",{className:"flex justify-between items-center mb-10",children:[e.jsxs("h3",{className:"text-2xl font-[1000] text-slate-900 uppercase italic tracking-tighter",children:[o==="activity"&&"Bio-Actividad",o==="units"&&"Sistema Médico",o==="goals"&&"Metas Clínicas"]}),e.jsx("button",{onClick:()=>c(null),className:"p-3 bg-slate-50 rounded-full text-slate-400 hover:text-slate-900 transition-colors",children:e.jsx(H,{size:24,strokeWidth:3})})]}),e.jsxs("div",{className:"max-h-[60vh] overflow-y-auto",children:[o==="activity"&&e.jsx(Wt,{selectedId:t.activityLevel,onSelect:v}),o==="units"&&e.jsx("div",{className:"grid gap-4",children:["mg/dL","mmol/L"].map(m=>e.jsxs("button",{onClick:()=>x(m),className:`p-8 rounded-[2.5rem] border-2 flex justify-between items-center transition-all ${t.glucoseUnitPreference===m?"bg-indigo-600 border-indigo-600 text-white shadow-xl":"bg-slate-50 border-transparent text-slate-800 hover:bg-slate-100"}`,children:[e.jsx("span",{className:"font-black text-lg uppercase tracking-widest",children:m}),t.glucoseUnitPreference===m&&e.jsx(B,{size:24})]},m))}),o==="goals"&&e.jsx(qt,{targetWeight:t.targetWeight||70,targetHba1c:t.targetHba1c||5.5,onUpdate:f,unit:t.glucoseUnitPreference})]})]})]})})]})},Q=({icon:t,label:a,value:s,onClick:r,isLast:i})=>e.jsxs("button",{onClick:r,className:`w-full flex items-center justify-between p-7 hover:bg-slate-50 transition-all ${i?"":"border-b border-slate-50"}`,children:[e.jsxs("div",{className:"flex items-center gap-5",children:[e.jsx("div",{className:"w-12 h-12 bg-white rounded-2xl flex items-center justify-center shadow-sm border border-slate-50",children:ce.cloneElement(t,{size:20})}),e.jsxs("div",{className:"text-left",children:[e.jsx("p",{className:"text-[10px] font-black text-slate-400 uppercase tracking-widest mb-1",children:a}),e.jsx("p",{className:"text-sm font-extrabold text-slate-800 uppercase tracking-tight italic",children:s})]})]}),e.jsx(U,{size:20,className:"text-slate-200"})]}),Jt=()=>e.jsxs("svg",{className:"animate-spin h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),Qt=({currentStep:t,totalSteps:a,label:s})=>e.jsx("div",{className:"w-full max-w-md mx-auto px-8 pt-10 pb-6 bg-transparent",children:e.jsxs("div",{className:"flex flex-col gap-5",children:[e.jsxs("div",{className:"flex justify-between items-end",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"text-[10px] font-[1000] text-indigo-600 uppercase tracking-[0.3em] mb-1",children:["Fase ",t," de ",a]}),e.jsx("h3",{className:"text-xl font-[1000] text-slate-900 tracking-tighter uppercase italic",children:s})]}),e.jsx("div",{className:"text-right",children:e.jsxs("span",{className:"text-2xl font-[1000] text-slate-900 tracking-tighter",children:[Math.round(t/a*100),"%"]})})]}),e.jsx("div",{className:"flex gap-1.5 h-2 w-full",children:[...Array(a)].map((r,i)=>e.jsx("div",{className:`h-full rounded-full transition-all duration-700 ease-out ${i+1<t?"bg-indigo-600 w-full opacity-30":i+1===t?"bg-indigo-600 w-[150%] shadow-[0_0_12px_rgba(79,70,229,0.4)]":"bg-slate-200 w-full"}`},i))})]})}),Yt=({onLoginSuccess:t})=>{const a=D(),[s,r]=d.useState(1),[i,l]=d.useState(!1),[o,c]=d.useState(null),[n,p]=d.useState({firstName:"",lastName:"",email:"",password:"",diabetesType:"Type 1",country:"Chile",ratio:12,isf:50,targetGlucose:100}),u=()=>{if(s===1&&(!n.firstName||!n.lastName||!n.email||!n.password)){c("Completa todos los campos de identidad.");return}if(s===1&&n.password.length<6){c("La contraseña debe ser más robusta (mín. 6 caracteres).");return}c(null),r(x=>x+1)},j=()=>r(x=>x-1),b=async x=>{x.preventDefault(),l(!0),c(null);try{const f=`${n.firstName} ${n.lastName}`.trim(),w={id:(await k.register(n.email,n.password)).user.uid,firstName:n.firstName,lastName:n.lastName,name:f,email:n.email.toLowerCase().trim(),role:"USER",subscription_tier:"BASE",ia_credits:3,daily_ia_usage:0,streak:0,createdAt:new Date().toISOString(),insulinRatioSchedule:[{startTime:"08:00",ratio:Number(n.ratio)}],clinicalConfig:{diabetesType:n.diabetesType,insulinSensitivityFactor:Number(n.isf),targetGlucose:Number(n.targetGlucose)},memory:{patterns:{highGlucoseTriggers:[],effectiveCorrections:[],notableEvents:[]},preferences:{dietaryRestrictions:[],favoriteSafeFoods:[]},aiNotes:`Protocolo Bio-Vitametra activado para ${n.firstName}.`}};await k.updateUser(w),t&&t(w),a("/dashboard")}catch(f){c(f.message||"Error al activar el perfil metabólico."),r(1)}finally{l(!1)}},v=["Identidad","Bio-Configuración","Metas de Control"];return e.jsxs("div",{className:"min-h-screen bg-[#F8FAFC] pb-20 font-sans antialiased text-slate-900",children:[e.jsx(Qt,{currentStep:s,totalSteps:3,label:v[s-1]}),e.jsxs("div",{className:"max-w-xl mx-auto px-6",children:[o&&e.jsxs("div",{className:"mb-6 p-4 bg-rose-50 border border-rose-100 text-rose-600 rounded-2xl text-[10px] font-black uppercase tracking-widest text-center flex items-center justify-center animate-in fade-in zoom-in",children:[e.jsx(W,{className:"mr-2",size:14})," ",o]}),s===1&&e.jsxs("div",{className:"animate-in fade-in slide-in-from-bottom-4 duration-500",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("div",{className:"w-20 h-20 bg-white rounded-[2.5rem] shadow-xl shadow-indigo-100/50 flex items-center justify-center mx-auto mb-6",children:e.jsx(Z,{className:"text-indigo-600",size:32})}),e.jsxs("h1",{className:"text-4xl font-[1000] tracking-tighter italic uppercase italic",children:["Crea tu ",e.jsx("span",{className:"text-indigo-600",children:"Perfil"})]})]}),e.jsxs("div",{className:"bg-white p-8 rounded-[3rem] shadow-2xl shadow-slate-200/50 space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx("input",{value:n.firstName,onChange:x=>p({...n,firstName:x.target.value}),className:"w-full p-5 bg-slate-50 rounded-2xl font-bold text-sm outline-none focus:ring-2 ring-indigo-100 transition-all",placeholder:"Nombre"}),e.jsx("input",{value:n.lastName,onChange:x=>p({...n,lastName:x.target.value}),className:"w-full p-5 bg-slate-50 rounded-2xl font-bold text-sm outline-none focus:ring-2 ring-indigo-100 transition-all",placeholder:"Apellido"})]}),e.jsx("input",{type:"email",value:n.email,onChange:x=>p({...n,email:x.target.value}),className:"w-full p-5 bg-slate-50 rounded-2xl font-bold text-sm outline-none focus:ring-2 ring-indigo-100 transition-all",placeholder:"Email"}),e.jsx("input",{type:"password",value:n.password,onChange:x=>p({...n,password:x.target.value}),className:"w-full p-5 bg-slate-50 rounded-2xl font-bold text-sm outline-none focus:ring-2 ring-indigo-100 transition-all",placeholder:"Contraseña"}),e.jsxs("button",{onClick:u,className:"w-full bg-slate-900 text-white p-6 rounded-[2rem] font-black uppercase text-[11px] tracking-widest flex items-center justify-center gap-3 hover:bg-indigo-600 transition-all shadow-lg shadow-slate-200 active:scale-95",children:["Siguiente ",e.jsx(P,{size:18})]})]})]}),s===2&&e.jsxs("div",{className:"animate-in fade-in slide-in-from-right-4 duration-500",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("div",{className:"w-20 h-20 bg-indigo-600 rounded-[2.5rem] shadow-xl flex items-center justify-center mx-auto mb-6 text-white",children:e.jsx(T,{size:32})}),e.jsx("h2",{className:"text-3xl font-[1000] tracking-tighter italic uppercase text-slate-900",children:"Bio-Configuración"})]}),e.jsxs("div",{className:"bg-white p-8 rounded-[3rem] shadow-2xl shadow-slate-200/50 space-y-8",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-[9px] font-black uppercase text-slate-400 block mb-3 tracking-widest",children:"Condición Clínica"}),e.jsxs("select",{value:n.diabetesType,onChange:x=>p({...n,diabetesType:x.target.value}),className:"w-full p-5 bg-slate-50 rounded-2xl font-bold text-sm outline-none border-none cursor-pointer",children:[e.jsx("option",{value:"Type 1",children:"Diabetes Tipo 1"}),e.jsx("option",{value:"Type 2",children:"Diabetes Tipo 2"}),e.jsx("option",{value:"LADA",children:"LADA / Otros"})]})]}),e.jsxs("div",{className:"p-6 bg-slate-50 rounded-[2rem]",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("label",{className:"text-[9px] font-black uppercase text-slate-400 tracking-widest",children:"Ratio Insulina (I:C)"}),e.jsxs("span",{className:"text-indigo-600 font-black text-sm",children:["1U : ",n.ratio,"g"]})]}),e.jsx("input",{type:"range",min:"1",max:"40",value:n.ratio,onChange:x=>p({...n,ratio:parseInt(x.target.value)}),className:"w-full h-2 bg-slate-200 rounded-lg appearance-none cursor-pointer accent-indigo-600"})]}),e.jsxs("div",{className:"flex gap-4",children:[e.jsx("button",{onClick:j,className:"p-6 bg-slate-100 rounded-[2rem] text-slate-400 font-black hover:bg-slate-200 transition-colors",children:e.jsx(ut,{size:20})}),e.jsx("button",{onClick:u,className:"flex-1 bg-slate-900 text-white p-6 rounded-[2rem] font-black uppercase text-[11px] tracking-widest shadow-xl active:scale-95 transition-transform",children:"Definir Metas"})]})]})]}),s===3&&e.jsxs("div",{className:"animate-in fade-in slide-in-from-right-4 duration-500",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("div",{className:"w-20 h-20 bg-emerald-500 rounded-[2.5rem] shadow-xl flex items-center justify-center mx-auto mb-6 text-white",children:e.jsx(Ne,{size:32})}),e.jsx("h2",{className:"text-3xl font-[1000] tracking-tighter italic uppercase text-slate-900",children:"Meta Control"})]}),e.jsxs("div",{className:"bg-white p-8 rounded-[3rem] shadow-2xl shadow-slate-200/50 space-y-8",children:[e.jsxs("div",{className:"p-8 bg-indigo-50/50 rounded-[2.5rem] text-center border border-indigo-100",children:[e.jsx("input",{type:"number",inputMode:"numeric",value:n.targetGlucose,onChange:x=>p({...n,targetGlucose:parseInt(x.target.value)}),className:"w-full bg-transparent text-center text-7xl font-[1000] text-indigo-600 outline-none italic tracking-tighter"}),e.jsx("p",{className:"text-[10px] font-black text-indigo-400 uppercase tracking-widest mt-2",children:"mg/dL Objetivo"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("p",{className:"text-center text-[10px] text-slate-400 font-bold italic leading-relaxed px-4",children:"Al activar VitaFlow, autorizas el procesamiento de biometría mediante algoritmos de salud preventiva."}),e.jsx("button",{onClick:b,disabled:i,className:"w-full bg-indigo-600 text-white p-7 rounded-[2.5rem] font-[1000] uppercase text-[12px] tracking-[0.2em] shadow-2xl shadow-indigo-200 hover:bg-slate-900 transition-all flex items-center justify-center active:scale-95",children:i?e.jsx(Jt,{}):"Activar Mi Ecosistema"})]})]})]})]})]})};Re("APP_USR-48e564b8-fd42-43a3-bb8e-9e0f30aaeafd");const Zt=({planId:t,amount:a,currentUser:s,onClose:r,onSuccess:i})=>{const[l,o]=d.useState(!1),n="https://api-pe6bb56yhq-uc.a.run.app/processPayment",p=async({formData:u})=>{o(!0);try{const b=await(await fetch(n,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({token:u.token,issuer_id:u.issuer_id,payment_method_id:u.payment_method_id,installments:u.installments,planId:t,amount:a,userId:s?.uid||s?.id,email:s?.email})})).json();b.success&&b.status==="approved"?i():ee.fire({title:"Pago no aprobado",text:b.error||"Verifica los datos de tu tarjeta e intenta nuevamente.",icon:"warning",confirmButtonColor:"#2563eb",customClass:{popup:"rounded-[2.5rem]"}})}catch(j){console.error("Error en el pago:",j),ee.fire({title:"Error de Conexión",text:"No pudimos contactar con el servidor de pagos.",icon:"error",confirmButtonColor:"#2563eb",customClass:{popup:"rounded-[2.5rem]"}})}finally{o(!1)}};return e.jsxs("div",{className:"fixed inset-0 z-[3000] flex items-end sm:items-center justify-center p-4",children:[e.jsx("div",{className:"absolute inset-0 bg-slate-900/60 backdrop-blur-md",onClick:r}),e.jsxs("div",{className:"relative w-full max-w-md bg-white rounded-[3.5rem] p-8 shadow-2xl animate-in slide-in-from-bottom-10 overflow-hidden",children:[l&&e.jsxs("div",{className:"absolute inset-0 z-50 bg-white/80 backdrop-blur-sm flex flex-col items-center justify-center",children:[e.jsx(L,{className:"animate-spin text-blue-600 mb-4",size:40}),e.jsx("p",{className:"text-[10px] font-black uppercase tracking-widest text-slate-900",children:"Validando Pago..."})]}),e.jsx("button",{onClick:r,className:"absolute top-6 right-6 text-slate-300 hover:text-slate-900 z-10",children:e.jsx(H,{size:24})}),e.jsxs("div",{className:"text-center mb-6",children:[e.jsx("div",{className:"w-14 h-14 bg-blue-50 text-blue-600 rounded-2xl flex items-center justify-center mx-auto mb-4",children:e.jsx(B,{size:28})}),e.jsx("h3",{className:"text-xl font-[1000] text-slate-900 uppercase italic leading-none",children:"Checkout Seguro"}),e.jsxs("p",{className:"text-[10px] font-black text-slate-400 uppercase tracking-widest mt-2",children:["Plan ",t," — $",a.toLocaleString("es-CL")," CLP"]})]}),e.jsx("div",{className:"min-h-[350px]",children:e.jsx(Pe,{initialization:{amount:a},customization:{visual:{theme:"flat"},paymentMethods:{bankTransfer:"all",ticket:"all",creditCard:"all",debitCard:"all",maxInstallments:1}},onSubmit:p})})]})]})},Xt=[{id:"monthly",title:"Starter",priceCLP:"7.990",rawPrice:7990,features:["30 Análisis de comidas con IA","Sincronización de glucosa","Soporte clínico estándar"],icon:e.jsx(F,{size:24}),color:"blue"},{id:"quarterly",title:"Pro",priceCLP:"19.990",rawPrice:19990,features:["IA Ilimitada 24/7","Reportes PDF para tu médico","Proyección de HbA1c","Ahorra 15%"],isPopular:!0,badge:"Más Popular",icon:e.jsx(bt,{size:24}),color:"blue"},{id:"annual",title:"Global",priceCLP:"69.900",rawPrice:69900,features:["Acceso Total Ilimitado","Dashboard Pro avanzado","Soporte prioritario 1:1","Ahorra 25%"],icon:e.jsx(ft,{size:24}),badge:"Mejor Valor",color:"emerald"}],Ut=({currentUser:t,onUpdateUser:a})=>{const s=D(),[r,i]=d.useState(null);return e.jsxs("div",{className:"min-h-screen bg-[#FBFBFE] pb-20",children:[e.jsxs("header",{className:"pt-20 pb-12 px-6 text-center",children:[e.jsxs(N.div,{initial:{opacity:0},animate:{opacity:1},className:"inline-flex items-center gap-2 px-4 py-1.5 bg-blue-50 rounded-full mb-6",children:[e.jsx(R,{size:14,className:"text-blue-600"}),e.jsx("span",{className:"text-[10px] font-black text-blue-700 uppercase tracking-widest",children:"Protocolos de Precisión 2026"})]}),e.jsxs("h1",{className:"text-5xl md:text-7xl font-[1000] text-slate-900 tracking-tighter uppercase italic leading-[0.85] mb-6",children:["Elige tu ",e.jsx("br",{}),e.jsx("span",{className:"text-blue-600",children:"Plan."})]}),e.jsx("p",{className:"text-slate-400 font-bold uppercase text-[10px] tracking-[0.3em]",children:"IA para el control de tu salud"})]}),e.jsx("div",{className:"max-w-6xl mx-auto px-6 grid grid-cols-1 md:grid-cols-3 gap-8",children:Xt.map(l=>e.jsxs(N.div,{whileHover:{y:-10},className:`relative p-10 rounded-[3.5rem] bg-white border transition-all duration-500 flex flex-col ${l.isPopular?"border-blue-600 shadow-2xl shadow-blue-100 ring-4 ring-blue-50":"border-slate-100 shadow-sm"}`,children:[(l.isPopular||l.badge)&&e.jsxs("div",{className:`absolute -top-5 left-1/2 -translate-x-1/2 text-white px-8 py-2 rounded-full flex items-center gap-2 font-black text-[10px] uppercase tracking-widest shadow-xl ${l.color==="emerald"?"bg-emerald-500":"bg-blue-600"}`,children:[l.isPopular?e.jsx(ht,{size:14}):e.jsx(R,{size:14}),l.badge||"Recomendado"]}),e.jsx("div",{className:`mb-8 w-16 h-16 rounded-2xl flex items-center justify-center ${l.color==="emerald"?"bg-emerald-50 text-emerald-600":"bg-blue-50 text-blue-600"}`,children:l.icon}),e.jsxs("div",{className:"mb-8",children:[e.jsxs("h3",{className:"text-[10px] font-black text-slate-400 uppercase tracking-widest mb-2",children:["Vitametra ",l.title]}),e.jsxs("div",{className:"flex items-baseline gap-1",children:[e.jsxs("span",{className:"text-5xl font-[1000] tracking-tighter text-slate-900 italic",children:["$",l.priceCLP]}),e.jsxs("span",{className:"text-xs font-bold text-slate-400 uppercase italic",children:["/ ",l.id==="annual"?"año":l.id==="quarterly"?"tri":"mes"]})]})]}),e.jsx("ul",{className:"space-y-4 mb-12 flex-grow",children:l.features.map((o,c)=>e.jsxs("li",{className:"flex items-start gap-3 text-xs font-bold text-slate-500 leading-tight",children:[e.jsx("div",{className:"mt-0.5 p-0.5 rounded-full bg-blue-50 text-blue-600",children:e.jsx(gt,{size:12,strokeWidth:4})}),o]},c))}),e.jsxs("button",{onClick:()=>i(l),className:`w-full py-6 rounded-[2rem] font-black uppercase tracking-[0.2em] text-[10px] transition-all active:scale-95 flex items-center justify-center gap-3 ${l.color==="emerald"?"bg-slate-900 text-white shadow-xl":"bg-blue-600 text-white shadow-xl shadow-blue-200"}`,children:["Ver planes ",e.jsx(P,{size:16})]})]},l.id))}),r&&e.jsx(Zt,{planId:r.id,amount:r.rawPrice,currentUser:t,onClose:()=>i(null),onSuccess:()=>{a&&t&&a({...t,subscription_tier:"PRO"}),s("/payment-success")}})]})},es=({foodInput:t,setFoodInput:a,onSubmit:s,isLoading:r})=>{const i=l=>{l.key==="Enter"&&!l.shiftKey&&t.trim()&&(l.preventDefault(),s())};return e.jsxs(N.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"w-full max-w-2xl mx-auto",children:[e.jsxs("div",{className:"relative group",children:[e.jsx("div",{className:"absolute -inset-1 bg-gradient-to-r from-blue-600 to-cyan-500 rounded-[2.5rem] blur opacity-25 group-focus-within:opacity-50 transition duration-1000"}),e.jsxs("div",{className:"relative bg-white rounded-[2.5rem] shadow-2xl overflow-hidden border border-slate-100",children:[e.jsxs("div",{className:"flex items-center px-8 py-6",children:[e.jsx("div",{className:"mr-4 text-blue-600",children:r?e.jsx(L,{size:24,className:"animate-spin"}):e.jsx(R,{size:24})}),e.jsx("textarea",{value:t,onChange:l=>a(l.target.value),onKeyDown:i,placeholder:"Describe tu comida (ej: '2 tacos de pastor y una coca zero')...",className:"flex-1 bg-transparent border-none outline-none text-lg font-medium text-slate-800 placeholder:text-slate-300 resize-none h-12 py-2",disabled:r}),e.jsx("button",{onClick:s,disabled:r||!t.trim(),className:`ml-4 p-4 rounded-2xl transition-all ${t.trim()&&!r?"bg-blue-600 text-white shadow-lg shadow-blue-200 hover:scale-105 active:scale-95":"bg-slate-100 text-slate-300"}`,children:r?e.jsx(L,{size:20,className:"animate-spin"}):e.jsx(P,{size:20})})]}),e.jsxs("div",{className:"bg-slate-50 px-8 py-3 flex items-center justify-between border-t border-slate-50",children:[e.jsx("span",{className:"text-[9px] font-black uppercase tracking-[0.2em] text-slate-400",children:"Metra Inferencia Bio-Nutricional"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("div",{className:"w-1.5 h-1.5 rounded-full bg-emerald-500 animate-pulse"}),e.jsx("span",{className:"text-[9px] font-bold text-slate-400",children:"Motor v4.7 Activo"})]})]})]})]}),e.jsx("div",{className:"mt-6 flex flex-wrap justify-center gap-3",children:["Desayuno ligero","Almuerzo completo","Cena Keto"].map(l=>e.jsxs("button",{onClick:()=>a(l),className:"px-4 py-2 bg-white border border-slate-200 rounded-full text-[10px] font-bold text-slate-500 hover:border-blue-400 hover:text-blue-600 transition-colors shadow-sm",children:["+ ",l]},l))})]})},ts=({currentUser:t})=>{const a=D(),[s,r]=d.useState(!1),[i,l]=d.useState(""),[o,c]=d.useState([{id:"1",role:"assistant",content:"Bio-Core activo. ¿Analizamos tu última ingesta?",type:"text"}]),n=d.useRef(null);d.useEffect(()=>{n.current&&(n.current.scrollTop=n.current.scrollHeight)},[o,s]);const p=u=>{if(u.preventDefault(),!i.trim())return;const j={id:Date.now().toString(),role:"user",content:i};c(b=>[...b,j]),l(""),setTimeout(()=>{const b={id:(Date.now()+1).toString(),role:"assistant",content:i.toLowerCase().includes("pro")?"Vitametra PRO desbloquea análisis molecular avanzado.":"Sugerencia: Ingiere fibra antes de esos carbohidratos.",type:i.toLowerCase().includes("pro")?"cta":"text"};c(v=>[...v,b])},800)};return e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:()=>r(!0),className:`fixed bottom-24 right-6 w-16 h-16 rounded-full flex items-center justify-center transition-all duration-500 z-[999] active:scale-90 ${s?"scale-0 opacity-0":"bg-metra-blue shadow-[0_0_30px_rgba(0,122,255,0.4)] hover:shadow-metra-blue/60"}`,children:[e.jsx("div",{className:"absolute inset-0 rounded-full border-2 border-white animate-ping opacity-20"}),e.jsx(F,{className:"text-white fill-white",size:24})]}),s&&e.jsxs("div",{className:"fixed bottom-0 right-0 md:bottom-28 md:right-6 w-full md:w-[400px] h-[100dvh] md:h-[600px] bg-white/90 backdrop-blur-2xl md:rounded-[3rem] shadow-2xl flex flex-col z-[1000] border border-white/20 animate-in slide-in-from-right-10 duration-500",children:[e.jsxs("header",{className:"bg-metra-dark p-8 text-white flex justify-between items-center relative overflow-hidden",children:[e.jsx("div",{className:"absolute top-0 left-0 w-full h-full bg-metra-blue/10 animate-pulse"}),e.jsxs("div",{className:"flex items-center gap-4 relative z-10",children:[e.jsx("div",{className:"w-10 h-10 bg-metra-blue rounded-2xl flex items-center justify-center shadow-lg shadow-metra-blue/20",children:e.jsx(R,{size:20,className:"text-white"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-[9px] font-black text-metra-blue uppercase tracking-widest",children:"Neural Link"}),e.jsx("h3",{className:"text-xl font-black italic tracking-tighter uppercase",children:"Bio-Assistant"})]})]}),e.jsx("button",{onClick:()=>r(!1),className:"bg-white/10 p-3 rounded-2xl relative z-10 hover:bg-white/20",children:e.jsx(H,{size:20})})]}),e.jsx("div",{ref:n,className:"flex-1 overflow-y-auto p-6 space-y-6",children:o.map(u=>e.jsx("div",{className:`flex ${u.role==="user"?"justify-end":"justify-start"}`,children:e.jsxs("div",{className:`max-w-[85%] p-5 rounded-3xl text-sm font-bold ${u.role==="user"?"bg-metra-blue text-white rounded-tr-none":"bg-slate-100 text-metra-dark rounded-tl-none"}`,children:[u.content,u.type==="cta"&&e.jsxs("button",{onClick:()=>a("/plans"),className:"mt-4 w-full bg-metra-dark text-white py-4 rounded-2xl flex items-center justify-center gap-2 font-black text-[10px] uppercase tracking-widest",children:[e.jsx(jt,{size:14})," Desbloquear PRO ",e.jsx(P,{size:14})]})]})},u.id))}),e.jsx("div",{className:"p-6 bg-white border-t border-slate-50",children:e.jsxs("form",{onSubmit:p,className:"relative",children:[e.jsx("input",{value:i,onChange:u=>l(u.target.value),placeholder:"Consulta al Bio-Core...",className:"w-full bg-slate-50 border-none rounded-2xl py-5 pl-6 pr-16 text-xs font-black uppercase tracking-widest outline-none focus:ring-2 ring-metra-blue/10"}),e.jsx("button",{type:"submit",className:"absolute right-2 top-1/2 -translate-y-1/2 bg-metra-dark text-white p-3 rounded-xl shadow-lg",children:e.jsx(Nt,{size:18})})]})})]})]})},ss=({currentUser:t,onUpdate:a})=>{const[s,r]=d.useState([]),[i,l]=d.useState(50),[o,c]=d.useState(!1),[n,p]=d.useState(!1);if(d.useEffect(()=>{t&&(r(t.insulinRatioSchedule||[{startTime:"08:00",ratio:12}]),l(t.clinicalConfig?.insulinSensitivityFactor||50))},[t]),!t)return e.jsxs("div",{className:"flex flex-col items-center justify-center min-h-[400px] text-slate-400",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mb-4"}),e.jsx("p",{className:"text-xs font-black uppercase tracking-widest italic",children:"Sincronizando expediente clínico..."})]});const u=async()=>{c(!0);try{const x={...t,insulinRatioSchedule:s,clinicalConfig:{...t.clinicalConfig||{},insulinSensitivityFactor:i}};await k.updateUser(x),a(x),p(!0),setTimeout(()=>p(!1),3e3)}catch(x){console.error("Error en calibración:",x)}finally{c(!1)}},j=()=>{const x=s.length>0?s[s.length-1].ratio:10;r([...s,{startTime:"12:00",ratio:x}])},b=x=>{s.length<=1||r(s.filter((f,m)=>m!==x))};return!t.insulinRatioSchedule&&!t.clinicalConfig&&!n&&s.length===0?e.jsxs(N.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"max-w-2xl mx-auto p-12 bg-white rounded-[3rem] border border-dashed border-slate-200 text-center",children:[e.jsx("div",{className:"w-20 h-20 bg-blue-50 rounded-3xl flex items-center justify-center mx-auto mb-6 text-blue-600",children:e.jsx(ue,{size:40})}),e.jsxs("h2",{className:"text-2xl font-[1000] text-slate-900 tracking-tighter uppercase italic mb-3",children:["Configuración ",e.jsx("span",{className:"text-blue-600",children:"Clínica Vacía"})]}),e.jsx("p",{className:"text-slate-500 text-sm leading-relaxed mb-8 max-w-sm mx-auto",children:"Para realizar cálculos de precisión, necesitamos tus ratios de insulina y factor de sensibilidad."}),e.jsxs("button",{onClick:j,className:"bg-slate-900 text-white px-8 py-4 rounded-2xl font-black uppercase tracking-widest text-[10px] flex items-center justify-center gap-2 mx-auto hover:bg-blue-600 transition-all",children:["Comenzar Calibración ",e.jsx(U,{size:16})]})]}):e.jsxs(N.div,{initial:{opacity:0},animate:{opacity:1},className:"max-w-2xl mx-auto p-6 bg-white rounded-[2.5rem] border border-slate-100 shadow-xl mb-10",children:[e.jsxs("header",{className:"mb-10 border-b border-slate-50 pb-6 text-left",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("div",{className:"w-10 h-10 bg-blue-50 rounded-xl flex items-center justify-center text-blue-600",children:e.jsx(T,{size:22})}),e.jsx("h2",{className:"text-2xl font-[1000] text-slate-900 tracking-tighter uppercase italic",children:"Calibración de Parámetros"})]}),e.jsx("p",{className:"text-slate-500 text-[11px] font-bold uppercase tracking-tight leading-relaxed opacity-60",children:"Algoritmos metabólicos de precisión para cálculo de bolos."})]}),e.jsxs("section",{className:"mb-10",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsxs("h3",{className:"text-[10px] font-black uppercase tracking-[0.2em] text-slate-400 flex items-center gap-2",children:[e.jsx(K,{size:14,className:"text-blue-500"})," Ratios Insulina:Carbohidratos"]}),e.jsxs("button",{onClick:j,className:"text-[10px] font-black uppercase tracking-widest text-blue-600 hover:bg-blue-50 px-4 py-2 rounded-xl transition-all flex items-center gap-1 border border-blue-100",children:[e.jsx(vt,{size:14})," Añadir"]})]}),e.jsx("div",{className:"space-y-3",children:s.map((x,f)=>e.jsxs(N.div,{layout:!0,className:"flex items-center gap-4 bg-slate-50 p-4 rounded-2xl border border-slate-100 transition-all hover:border-blue-100 hover:bg-white",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"text-[8px] font-black text-slate-400 uppercase block mb-1 tracking-tighter",children:"Inicio Bloque"}),e.jsx("input",{type:"time",value:x.startTime,onChange:m=>{const g=[...s];g[f].startTime=m.target.value,r(g)},className:"bg-transparent font-black text-slate-700 outline-none w-full text-lg"})]}),e.jsxs("div",{className:"flex-1 border-l border-slate-200 pl-4",children:[e.jsx("label",{className:"text-[8px] font-black text-slate-400 uppercase block mb-1 tracking-tighter",children:"Ratio (g/U)"}),e.jsx("input",{type:"number",value:x.ratio,onChange:m=>{const g=[...s];g[f].ratio=parseFloat(m.target.value),r(g)},className:"bg-transparent font-black text-slate-700 outline-none w-full text-lg"})]}),s.length>1&&e.jsx("button",{onClick:()=>b(f),className:"text-slate-300 hover:text-red-500 transition-colors p-2",children:e.jsx(wt,{size:18})})]},f))})]}),e.jsxs("section",{className:"mb-10 p-8 bg-slate-900 rounded-[2.5rem] text-white relative overflow-hidden shadow-2xl shadow-slate-200",children:[e.jsx("div",{className:"absolute -top-10 -right-10 opacity-5 text-white rotate-12",children:e.jsx(T,{size:200})}),e.jsxs("div",{className:"relative z-10",children:[e.jsx("h3",{className:"text-[10px] font-black uppercase tracking-[0.2em] text-blue-400 mb-2",children:"Sensibilidad (ISF)"}),e.jsx("p",{className:"text-xs text-slate-400 font-medium mb-6 leading-relaxed max-w-[280px]",children:"Reducción de glucemia (mg/dL) por cada 1 unidad de insulina."}),e.jsxs("div",{className:"flex items-center gap-6",children:[e.jsx("input",{type:"number",value:i,onChange:x=>l(parseFloat(x.target.value)),className:"bg-white/5 border border-white/10 rounded-2xl px-6 py-4 text-4xl font-black text-white w-36 outline-none focus:ring-2 ring-blue-500 transition-all text-center"}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("span",{className:"block text-xl font-black italic tracking-tighter",children:"mg/dL"}),e.jsx("span",{className:"text-[9px] font-black text-blue-500 uppercase tracking-[0.2em]",children:"x 1 unidad"})]})]})]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row items-center justify-between pt-6 border-t border-slate-50 gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2 text-slate-400 bg-slate-50 px-4 py-2 rounded-xl",children:[e.jsx(yt,{size:14,className:"text-amber-500"}),e.jsx("span",{className:"text-[9px] font-black uppercase tracking-tight italic",children:"Uso clínico bajo supervisión"})]}),e.jsx("button",{onClick:u,disabled:o,className:"w-full sm:w-auto bg-blue-600 text-white px-10 py-5 rounded-2xl font-black uppercase tracking-widest text-[10px] flex items-center justify-center gap-3 hover:bg-slate-900 transition-all active:scale-95 disabled:opacity-50 shadow-xl shadow-blue-100 italic",children:o?"Sincronizando...":e.jsxs(e.Fragment,{children:[e.jsx(q,{size:18})," Actualizar Parámetros"]})})]}),e.jsx(_,{children:n&&e.jsxs(N.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0},className:"mt-6 p-4 bg-emerald-50 rounded-2xl flex items-center justify-center gap-3 text-emerald-600 font-black text-[9px] uppercase tracking-widest",children:[e.jsx(J,{size:16})," Calibración exitosa en nube médica."]})})]})},as=()=>{const t=D(),[a,s]=d.useState("idle"),[r,i]=d.useState(null),[l,o]=d.useState(0),c=p=>new Promise((u,j)=>{const b=new FileReader;b.readAsDataURL(p),b.onload=()=>u(b.result.split(",")[1]),b.onerror=v=>j(v)}),n=async p=>{const u=p.target.files?.[0];if(u){if(u.size>10*1024*1024){i("El reporte es demasiado extenso (Máximo 10MB)"),s("error");return}s("processing"),i(null);try{const j=await c(u),b=Ke(),f=(await Je(b,"importMedicalReport")({fileBase64:j,fileName:u.name,fileType:u.type})).data;f.success&&(o(f.processedEntries),s("success"),setTimeout(()=>{t("/")},2500))}catch(j){console.error("Error importando:",j),i(j.message||"Error al procesar el documento médico."),s("error")}}};return e.jsx("div",{className:"max-w-xl mx-auto",children:e.jsxs("div",{className:`relative overflow-hidden bg-white p-10 rounded-[3rem] border-2 border-dashed transition-all duration-700 ${a==="success"?"border-emerald-500 bg-emerald-50/50":a==="error"?"border-red-200 bg-red-50/50":"border-slate-200 hover:border-blue-400 shadow-2xl shadow-slate-100"}`,children:[e.jsx("input",{type:"file",id:"fileImport",hidden:!0,onChange:n,accept:".pdf,.csv",disabled:a==="processing"||a==="success"}),e.jsxs("label",{htmlFor:"fileImport",className:`flex flex-col items-center gap-6 ${a==="processing"?"cursor-not-allowed":"cursor-pointer"}`,children:[e.jsx(N.div,{animate:a==="processing"?{rotate:360}:{rotate:0},transition:a==="processing"?{repeat:1/0,duration:2,ease:"linear"}:{},className:`w-24 h-24 rounded-[2.5rem] flex items-center justify-center shadow-xl transition-all duration-500 ${a==="success"?"bg-emerald-500 text-white":a==="processing"?"bg-blue-600 text-white":a==="error"?"bg-red-500 text-white":"bg-slate-900 text-white"}`,children:a==="processing"?e.jsx(L,{size:40}):a==="success"?e.jsx(kt,{size:40}):a==="error"?e.jsx(W,{size:40}):e.jsx(Ct,{size:40})}),e.jsxs("div",{className:"text-center space-y-2",children:[e.jsx("h3",{className:"text-2xl font-[1000] uppercase italic tracking-tighter text-slate-900",children:a==="processing"?"Metra está leyendo...":a==="success"?"Sincronización Completa":"Cargar Reporte Médico"}),e.jsx("p",{className:"text-[11px] font-black text-slate-400 uppercase tracking-[0.3em]",children:a==="success"?`Hemos procesado ${l} registros con éxito`:"Analiza tu Bomba o Glucómetro en segundos"})]}),a==="success"&&e.jsxs(N.div,{initial:{opacity:0},animate:{opacity:1},className:"flex items-center gap-2 text-emerald-600 font-bold text-xs italic",children:["Redirigiendo a tus nuevos Insights... ",e.jsx(P,{size:14,className:"animate-bounce-x"})]}),e.jsx(_,{children:a==="processing"&&e.jsxs("div",{className:"w-full space-y-3",children:[e.jsx("div",{className:"w-full bg-slate-100 h-3 rounded-full overflow-hidden",children:e.jsx(N.div,{className:"bg-blue-600 h-full",initial:{width:"0%"},animate:{width:"100%"},transition:{duration:15}})}),e.jsx("p",{className:"text-center text-[9px] font-bold text-blue-600 uppercase tracking-widest animate-pulse",children:"Extrayendo patrones metabólicos con IA"})]})})]}),a==="error"&&e.jsx(N.div,{initial:{scale:.9,opacity:0},animate:{scale:1,opacity:1},className:"mt-6 p-4 bg-red-100 text-red-600 rounded-2xl text-[10px] font-black uppercase tracking-widest text-center border border-red-200",children:r})]})})},is=()=>{const t=D();return d.useEffect(()=>{Ee({particleCount:150,spread:70,origin:{y:.6},colors:["#2563eb","#10b981","#fbbf24"]})},[]),e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-slate-50 p-6",children:e.jsxs(N.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},className:"max-w-md w-full bg-white rounded-[4rem] p-10 shadow-2xl text-center relative overflow-hidden",children:[e.jsx("div",{className:"absolute top-0 left-0 w-full h-2 bg-gradient-to-r from-blue-600 to-emerald-500"}),e.jsx("div",{className:"w-24 h-24 bg-emerald-50 text-emerald-500 rounded-[2rem] flex items-center justify-center mx-auto mb-8",children:e.jsx(J,{size:48})}),e.jsxs("h1",{className:"text-4xl font-[1000] text-slate-900 mb-4 tracking-tighter italic uppercase",children:["¡Acceso ",e.jsx("span",{className:"text-blue-600",children:"Pro"})," Activado!"]}),e.jsx("p",{className:"text-slate-500 font-medium mb-10",children:"Tu suscripción ha sido procesada con éxito. Ya puedes disfrutar de todas las herramientas de IA."}),e.jsxs("div",{className:"space-y-3 mb-10",children:[e.jsxs("div",{className:"flex items-center gap-4 p-4 bg-slate-50 rounded-3xl border border-slate-100 text-left",children:[e.jsx(F,{className:"text-blue-600",size:20}),e.jsx("span",{className:"text-[10px] font-black uppercase tracking-widest text-slate-700",children:"IA Ilimitada Desbloqueada"})]}),e.jsxs("div",{className:"flex items-center gap-4 p-4 bg-slate-50 rounded-3xl border border-slate-100 text-left",children:[e.jsx(B,{className:"text-emerald-500",size:20}),e.jsx("span",{className:"text-[10px] font-black uppercase tracking-widest text-slate-700",children:"Reportes Clínicos Activos"})]})]}),e.jsxs("button",{onClick:()=>t("/dashboard"),className:"w-full py-5 bg-slate-900 text-white font-black rounded-3xl flex items-center justify-center gap-3 uppercase tracking-widest text-xs hover:bg-black transition-all",children:["Ir al Panel ",e.jsx(P,{size:18})]}),e.jsxs("button",{onClick:()=>window.open("https://instagram.com","_blank"),className:"mt-8 flex items-center justify-center gap-2 text-slate-300 hover:text-pink-500 transition-colors",children:[e.jsx(St,{size:16}),e.jsx("span",{className:"text-[9px] font-black uppercase tracking-widest",children:"Compartir en redes"})]})]})})},ls=()=>{const t=D(),a=Le(),[s,r]=d.useState(!1),[i,l]=d.useState(null),[o,c]=d.useState(!0),[n,p]=d.useState({login:!1,chat:!1}),[u,j]=d.useState({message:"",key:0}),[b,v]=d.useState(null),[x,f]=d.useState({input:"",isLoading:!1,result:null,error:null}),[m,g]=d.useState({history:[],hba1c:[]}),w=h=>j({message:h,key:Date.now()}),S=d.useCallback(h=>{r(!0),l(h),(a.pathname==="/"||a.pathname==="/planes")&&t("/dashboard")},[a.pathname,t]);d.useEffect(()=>{const h=Qe(V,async C=>{try{if(C){const I=await k.getUserProfile(C.uid);I&&S(I)}else r(!1),l(null)}catch(I){console.error("Auth Error:",I)}finally{c(!1)}});return()=>h()},[S]),d.useEffect(()=>{if(s&&i?.id){const h=k.subscribeToHistory(i.id,I=>g(G=>({...G,history:I}))),C=k.subscribeToHba1cHistory(i.id,I=>g(G=>({...G,hba1c:I})));return()=>{h(),C()}}},[s,i?.id]);const $=async()=>{if(!(!x.input||!i||!i.id)){f(h=>({...h,isLoading:!0,error:null}));try{await k.checkAnalysisLimit(i.id);const h=await ve(x.input,i);f(C=>({...C,result:h}))}catch(h){f(C=>({...C,error:h.message})),w(h.message)}finally{f(h=>({...h,isLoading:!1}))}}},we=async(h,C,I,G)=>{try{await k.closeLearningLoop(h,C,I,G),v(null),w("Bucle metabólico cerrado. IA optimizada.")}catch{w("Error al sincronizar el aprendizaje.")}};return o?e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-white font-black text-[10px] uppercase tracking-widest text-slate-400",children:"Vitametra OS 2026..."}):e.jsxs("div",{className:"min-h-screen bg-[#F8FAFC]",children:[s&&i&&e.jsx(Lt,{}),e.jsx(It,{isLoggedIn:s,onLoginClick:()=>p(h=>({...h,login:!0})),onLogoutClick:()=>k.logout(),currentUser:i}),e.jsx("main",{className:"container mx-auto px-4 pt-20 pb-32",children:e.jsxs(Me,{children:[e.jsx(A,{path:"/",element:e.jsx(ne,{currentUser:i,onStartClick:()=>t(s?"/analyzer":"/register"),history:m.history})}),e.jsx(A,{path:"/planes",element:e.jsx(Ut,{onSelectPlan:()=>{s?t("/profile"):p(h=>({...h,login:!0}))}})}),e.jsx(A,{path:"/dashboard",element:s?e.jsx(ne,{currentUser:i,history:m.history,onStartClick:()=>t("/analyzer")}):e.jsx(M,{to:"/"})}),e.jsx(A,{path:"/import",element:s?e.jsx(as,{}):e.jsx(M,{to:"/"})}),e.jsx(A,{path:"/analyzer",element:s?e.jsx("div",{className:"max-w-4xl mx-auto pt-10",children:x.result?e.jsx(Pt,{result:x.result,currentUser:i,onLogEntry:()=>{w("Registro Guardado"),f(h=>({...h,result:null,input:""})),t("/history")},onAdjust:()=>f(h=>({...h,result:null})),onLoginRequest:()=>p(h=>({...h,login:!0})),verifiedFoods:[],onFoodItemVerified:()=>{},onDeleteItem:()=>{}}):e.jsx(es,{foodInput:x.input,setFoodInput:h=>f(C=>({...C,input:h})),onSubmit:$,isLoading:x.isLoading})}):e.jsx(M,{to:"/"})}),e.jsx(A,{path:"/history",element:s&&i?e.jsx(Ht,{currentUser:i,history:m.history,hba1cHistory:m.hba1c,onDelete:h=>{k.deleteHistoryEntry(h),w("Eliminado")},onUpdate:()=>{},onSaveHba1c:()=>{},onUpdateHba1c:()=>{},onDeleteHba1c:()=>{},onUpdateLayout:()=>{},onNavigateToAnalyzer:()=>t("/analyzer")}):e.jsx(M,{to:"/"})}),e.jsx(A,{path:"/profile",element:s&&i?e.jsx(Kt,{currentUser:i,onUpdateUser:h=>{l(h),w("Perfil actualizado")}}):e.jsx(M,{to:"/"})}),e.jsx(A,{path:"/clinical-settings",element:s&&i?e.jsx(ss,{currentUser:i,onUpdate:h=>{l(h),w("Ajustes guardados")}}):e.jsx(M,{to:"/"})}),e.jsx(A,{path:"/register",element:e.jsx(Yt,{onLoginSuccess:S})}),e.jsx(A,{path:"/payment-success",element:e.jsx(is,{})}),e.jsx(A,{path:"*",element:e.jsx(M,{to:"/"})})]})}),s&&e.jsx(Tt,{activeTab:a.pathname.substring(1)||"dashboard",onTabChange:h=>{t(`/${h==="settings"?"clinical-settings":h}`)}}),b&&e.jsx(Mt,{mealEntry:b,onClose:()=>v(null),onSaveClosure:we}),e.jsx(ts,{}),e.jsx(Rt,{message:u.message,snackbarKey:u.key}),n.login&&e.jsx(Et,{isOpen:n.login,onClose:()=>p(h=>({...h,login:!1})),onLoginSuccess:S})]})};console.log("🚀 VitaMetra Core: Iniciando sistemas biométricos...");const oe=document.getElementById("root");oe?De.createRoot(oe).render(e.jsx(ce.StrictMode,{children:e.jsx(Fe,{children:e.jsx(ls,{})})})):console.error("CRÍTICO: El contenedor #root no existe en el DOM.");
