import{j as e,r as d,a0 as L,a1 as je,a2 as we,a3 as ve,a4 as Ne,a5 as ye,a6 as ke,a7 as Ce,a8 as Se,a9 as le,aa as ze,ab as Ie,ac as Q,ad as Ae,ae as Te,af as Re,ag as z,ah as M,ai as Pe,aj as Ee}from"./vendor-wbDOIdi9.js";import{d as C,u as P,q as X,l as Z,o as U,w as ee,c as B,a as te,b as Le,e as re,g as se,f as N,s as Me,h as H,i as De,j as _e,k as Fe,m as ne,r as Be,n as He,p as Ge,t as Oe,v as $e,x as We,y as Ve}from"./vendor-firebase-ChCoiK1p.js";import{L as oe,m as w,a as qe,U as ce,H as de,S as xe,b as q,C as Ke,c as G,A as _,X as O,d as D,M as Je,e as Ye,f as T,g as I,W as Qe,h as R,i as Xe,T as Ze,B as me,j as E,P as ue,k as $,l as pe,n as Ue,o as et,p as tt,q as K,r as J,s as st,t as at,u as Y,v as it,w as lt,x as rt,Z as F,F as nt,y as ot,z as he,D as be,E as ct,G as dt,I as ge,J as xt,K as mt,N as ut,O as pt,Q as ht,R as bt,V as gt,Y as ft,_ as jt,$ as wt,a0 as vt,a1 as Nt}from"./vendor-ui-DNnzU7iQ.js";import{G as yt}from"./vendor-gemini-CZZ1HbHH.js";(function(){const i=document.createElement("link").relList;if(i&&i.supports&&i.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))r(s);new MutationObserver(s=>{for(const l of s)if(l.type==="childList")for(const o of l.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&r(o)}).observe(document,{childList:!0,subtree:!0});function a(s){const l={};return s.integrity&&(l.integrity=s.integrity),s.referrerPolicy&&(l.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?l.credentials="include":s.crossOrigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function r(s){if(s.ep)return;s.ep=!0;const l=a(s);fetch(s.href,l)}})();const kt=({className:t=""})=>e.jsxs("div",{className:`flex items-center gap-3 ${t} select-none shrink-0 group`,children:[e.jsx("div",{className:"relative",children:e.jsxs("div",{className:"w-11 h-11 flex items-center justify-center bg-gradient-to-tr from-[#007AFF] to-[#47a1ff] rounded-[1.15rem] shadow-lg shadow-blue-200/50 transition-all duration-500 group-hover:scale-105 group-hover:rotate-6",children:[e.jsxs("svg",{viewBox:"0 0 100 100",className:"w-6 h-6 text-white",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[e.jsx("circle",{cx:"50",cy:"50",r:"10",fill:"currentColor"}),e.jsx("ellipse",{cx:"50",cy:"50",rx:"44",ry:"16",stroke:"currentColor",strokeWidth:"6",transform:"rotate(0 50 50)",className:"opacity-30"}),e.jsx("ellipse",{cx:"50",cy:"50",rx:"44",ry:"16",stroke:"currentColor",strokeWidth:"6",transform:"rotate(60 50 50)",className:"opacity-60"}),e.jsx("ellipse",{cx:"50",cy:"50",rx:"44",ry:"16",stroke:"currentColor",strokeWidth:"6",transform:"rotate(120 50 50)"})]}),e.jsxs("div",{className:"absolute -top-1 -right-1 flex h-3.5 w-3.5",children:[e.jsx("span",{className:"animate-ping absolute inline-flex h-full w-full rounded-full bg-emerald-400 opacity-75"}),e.jsx("span",{className:"relative inline-flex rounded-full h-3.5 w-3.5 bg-emerald-500 border-2 border-white"})]})]})}),e.jsxs("div",{className:"flex flex-col -space-y-1",children:[e.jsx("div",{className:"flex items-baseline",children:e.jsxs("span",{className:"text-xl font-[1000] tracking-tighter text-slate-900 leading-none italic uppercase",children:["VITA",e.jsx("span",{className:"text-[#007AFF]",children:"METRA"})]})}),e.jsxs("div",{className:"flex items-center gap-1.5 mt-1",children:[e.jsx("div",{className:"h-[2px] w-3 bg-emerald-500 rounded-full"}),e.jsx("span",{className:"text-[8px] font-black text-slate-400 uppercase tracking-[0.25em] leading-none",children:"Bio-Intelligence"})]})]})]}),Ct=({isLoggedIn:t,onLoginClick:i,onLogoutClick:a,currentUser:r})=>e.jsx("header",{className:"fixed top-0 left-0 right-0 z-[1000] bg-white/80 backdrop-blur-md border-b border-slate-100 shadow-sm",children:e.jsxs("div",{className:"w-full max-w-[1400px] mx-auto px-6 h-20 flex items-center justify-between",children:[e.jsx("div",{className:"flex-shrink-0 flex items-center cursor-pointer hover:opacity-80 transition-all active:scale-95",children:e.jsx(kt,{})}),e.jsx("div",{className:"flex items-center gap-4",children:t?e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"hidden sm:flex flex-col items-end",children:[e.jsx("p",{className:"text-[9px] font-black text-blue-600 uppercase tracking-widest leading-none mb-1",children:"Bio-Perfil"}),e.jsx("p",{className:"text-sm font-black text-slate-900 leading-none italic uppercase",children:r?.firstName||r?.email?.split("@")[0]})]}),e.jsx("div",{className:"h-8 w-[1px] bg-slate-200 mx-1 hidden sm:block"}),e.jsx("button",{onClick:a,className:"p-2.5 rounded-xl bg-slate-50 text-slate-400 hover:bg-rose-50 hover:text-rose-600 transition-all",children:e.jsx(oe,{size:18,strokeWidth:2.5})})]}):e.jsx("button",{onClick:i,className:"bg-slate-900 text-white px-6 py-2.5 rounded-xl font-[1000] text-[10px] uppercase tracking-[0.2em] hover:bg-blue-600 transition-all active:scale-95 whitespace-nowrap shadow-xl shadow-slate-100",children:"Iniciar Sesión"})})]})}),St=({activeTab:t,onTabChange:i})=>{const a=[{id:"dashboard",label:"Inicio",icon:e.jsx(qe,{size:22}),path:"dashboard"},{id:"analyzer",label:"Nutrición IA",icon:e.jsx(ce,{size:22}),path:"analyzer",badge:!0},{id:"history",label:"Progreso",icon:e.jsx(de,{size:22}),path:"history"},{id:"settings",label:"Clínico",icon:e.jsx(xe,{size:22}),path:"settings"},{id:"profile",label:"Perfil",icon:e.jsx(q,{size:22}),path:"profile"}],r=t==="clinical-settings"?"settings":t||"dashboard";return e.jsx("div",{className:"fixed bottom-0 left-0 right-0 px-6 pb-8 pt-4 z-[900] pointer-events-none",children:e.jsx("nav",{className:"max-w-md mx-auto bg-white/80 backdrop-blur-2xl border border-white/40 shadow-[0_20px_50px_rgba(0,0,0,0.1)] rounded-[2.5rem] px-2 py-3 flex items-center justify-between pointer-events-auto relative overflow-hidden",children:a.map(s=>{const l=r===s.id;return e.jsxs("button",{onClick:()=>i(s.path),className:"relative flex flex-col items-center justify-center py-2 px-3 transition-all duration-500 group flex-1",children:[l&&e.jsx(w.div,{layoutId:"nav-indicator",className:"absolute -top-3 w-1.5 h-1.5 bg-blue-600 rounded-full shadow-[0_0_10px_#2563EB]",transition:{type:"spring",stiffness:380,damping:30}}),e.jsxs("div",{className:`relative transition-all duration-300 transform ${l?"scale-110 text-blue-600":"text-slate-400 group-hover:text-slate-600"}`,children:[s.icon,s.badge&&e.jsxs("span",{className:"absolute -top-1 -right-1 flex h-2 w-2",children:[e.jsx("span",{className:"animate-ping absolute inline-flex h-full w-full rounded-full bg-blue-400 opacity-75"}),e.jsx("span",{className:"relative inline-flex rounded-full h-2 w-2 bg-blue-600"})]})]}),e.jsx("span",{className:`text-[8px] font-[900] uppercase tracking-[0.05em] mt-1.5 transition-colors duration-300 italic ${l?"text-blue-600":"text-slate-400"}`,children:s.label}),l&&e.jsx(w.div,{layoutId:"nav-pill",className:"absolute inset-0 bg-blue-50/50 rounded-2xl -z-10",transition:{type:"spring",stiffness:300,damping:30}})]},s.id)})})})},zt=({message:t,type:i="info",actionText:a,onAction:r,duration:s=4e3,snackbarKey:l})=>{const[o,c]=d.useState(!1);if(d.useEffect(()=>{if(l>0){c(!0);const g=setTimeout(()=>c(!1),s);return()=>clearTimeout(g)}},[l,s]),!o)return null;const n={success:"bg-metra-green shadow-metra-green/20",error:"bg-red-500 shadow-red-500/20",info:"bg-metra-dark shadow-metra-dark/20"};return e.jsx("div",{className:"fixed top-10 left-1/2 -translate-x-1/2 z-[2000] w-[90%] max-w-sm p-1 rounded-[2rem] animate-in slide-in-from-top-10 duration-500",children:e.jsxs("div",{className:`flex items-center justify-between px-6 py-4 rounded-[1.8rem] text-white shadow-2xl ${n[i]} backdrop-blur-md border border-white/10`,children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-2 h-2 bg-white rounded-full animate-pulse"}),e.jsx("span",{className:"text-[10px] font-black uppercase tracking-[0.2em]",children:t})]}),a&&e.jsx("button",{onClick:()=>{r?.(),c(!1)},className:"bg-white/20 px-3 py-1.5 rounded-xl text-[9px] font-black uppercase tracking-widest hover:bg-white/30 transition-colors",children:a})]})})},It=({result:t,currentUser:i,onLogEntry:a,onAdjust:r})=>{const[s,l]=d.useState(0),[o,c]=d.useState(0),n=()=>{if(!i?.insulinRatioSchedule||i.insulinRatioSchedule.length===0)return 15;const u=new Date,f=`${u.getHours().toString().padStart(2,"0")}:${u.getMinutes().toString().padStart(2,"0")}`,m=[...i.insulinRatioSchedule].sort((h,v)=>h.startTime.localeCompare(v.startTime));return(m.reverse().find(h=>f>=h.startTime)||m[0]).ratio};d.useEffect(()=>{const u=n(),f=i?.clinicalConfig?.insulinSensitivityFactor||50,m=i?.clinicalConfig?.targetGlucose||100,x=t.totalCarbs/u,h=s>m?(s-m)/f:0;c(Math.round((x+h)*10)/10)},[s,t.totalCarbs,i]);const g=u=>{switch(u?.toLowerCase()){case"alto":return"text-red-500 bg-red-50 border-red-100";case"medio":return"text-amber-500 bg-amber-50 border-amber-100";default:return"text-emerald-500 bg-emerald-50 border-emerald-100"}};return e.jsxs("div",{className:"mt-8 space-y-6 animate-fade-in max-w-2xl mx-auto pb-20",children:[e.jsxs("div",{className:"bg-white rounded-[3rem] border border-slate-100 p-8 shadow-2xl relative overflow-hidden",children:[e.jsxs("div",{className:`absolute top-0 right-0 px-6 py-2 rounded-bl-3xl border-l border-b font-bold text-[10px] uppercase tracking-widest ${g(t.glycemicIndex)}`,children:["IG: ",t.glycemicIndex]}),e.jsxs("div",{className:"mt-4",children:[e.jsx("div",{className:"flex items-center gap-2 mb-2",children:e.jsx("span",{className:"text-[10px] font-bold text-slate-400 uppercase tracking-widest",children:"Carbohidratos totales"})}),e.jsxs("h3",{className:"text-7xl font-black text-slate-900 tracking-tighter",children:[t.totalCarbs,e.jsx("span",{className:"text-xl text-slate-300 font-bold ml-2",children:"g"})]})]})]}),e.jsxs("div",{className:"bg-blue-600 rounded-[2.5rem] p-8 text-white shadow-xl shadow-blue-200",children:[e.jsxs("div",{className:"flex items-center justify-between mb-8",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Ke,{size:20}),e.jsx("h4",{className:"text-sm font-bold uppercase tracking-widest",children:"Bolo sugerido"})]}),e.jsxs("div",{className:"text-[10px] font-medium bg-white/10 px-3 py-1 rounded-full",children:["Ratio: 1u / ",n(),"g"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-8 items-center",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] font-bold uppercase tracking-widest text-blue-200 block mb-2",children:"Glucosa actual"}),e.jsx("input",{type:"number",placeholder:"mg/dL",value:s||"",onChange:u=>l(Number(u.target.value)),className:"bg-white/10 border border-white/20 rounded-2xl px-4 py-3 text-2xl font-black text-white w-full outline-none focus:ring-2 ring-white/50 placeholder:text-blue-300"})]}),e.jsxs("div",{className:"bg-white/10 rounded-3xl p-6 text-center border border-white/10",children:[e.jsx("p",{className:"text-[10px] font-bold uppercase tracking-widest text-blue-200 mb-1",children:"Dosis total"}),e.jsxs("div",{className:"text-5xl font-black text-white",children:[o," ",e.jsx("span",{className:"text-lg font-bold",children:"u"})]})]})]}),e.jsxs("div",{className:"mt-6 flex items-start gap-2 text-[10px] text-blue-100 leading-relaxed font-medium",children:[e.jsx(G,{size:14,className:"shrink-0"}),"Sugerencia basada en tus ratios. Verifica siempre con tus síntomas."]})]}),e.jsxs("div",{className:"bg-slate-900 rounded-[2.5rem] p-8 text-white",children:[e.jsx("div",{className:"flex items-center gap-3 mb-4",children:e.jsx("h4",{className:"text-[10px] font-bold uppercase tracking-widest text-blue-400",children:"Recomendación"})}),e.jsxs("p",{className:"text-lg font-medium italic",children:['"',t.optimizationTip||"Carga glicémica moderada.",'"']})]}),e.jsxs("div",{className:"flex gap-4 pt-4",children:[e.jsx("button",{onClick:a,className:"flex-1 bg-slate-900 text-white py-5 rounded-3xl font-bold text-sm shadow-xl",children:"Guardar"}),e.jsx("button",{onClick:r,className:"bg-slate-100 text-slate-500 px-8 rounded-3xl font-bold text-sm",children:"Ajustar"})]})]})},y={async login(t,i){return await Fe(H,t.toLowerCase().trim(),i)},async register(t,i,a="Usuario"){const r=await De(H,t.toLowerCase().trim(),i),s=r.user.uid,l={id:s,firstName:a,lastName:"",email:t.toLowerCase().trim(),role:"USER",subscription_tier:"BASE",ia_credits:3,daily_ia_usage:0,streak:0,createdAt:new Date().toISOString(),insulinRatioSchedule:[{startTime:"08:00",ratio:15},{startTime:"14:00",ratio:15},{startTime:"21:00",ratio:15}],clinicalConfig:{diabetesType:"Type 1",insulinSensitivityFactor:50,targetGlucose:100},aiMemory:"Iniciando fase de observación metabólica.",memory:{patterns:{highGlucoseTriggers:[],effectiveCorrections:[],notableEvents:[]},preferences:{dietaryRestrictions:[],favoriteSafeFoods:[]},aiNotes:"Sincronizado con el Bio-Core."},glucoseUnitPreference:"mg/dL"};return await _e(C(N,"users",s),l,{merge:!0}),r},async logout(){try{await Me(H),window.location.href="/"}catch(t){console.error("Error al cerrar sesión:",t)}},async createStripeCheckoutSession(t){return console.log("Iniciando pasarela para:",t),{success:!0,url:"#"}},async getUserProfile(t){const i=C(N,"users",t);try{const a=await se(i);return a.exists()?{id:a.id,...a.data()}:null}catch{return null}},async updateUser(t){const i=C(N,"users",t.id),{id:a,...r}=t;await P(i,{...r,updatedAt:new Date().toISOString()})},async checkAnalysisLimit(t){const i=C(N,"users",t),r=(await se(i)).data();if(r?.subscription_tier!=="PRO"&&(r?.daily_ia_usage||0)>=3)throw new Error("Has agotado tus análisis diarios gratuitos.")},async saveHistoryEntry(t,i){const a=B(N,"ingestas");return await re(a,{...i,userId:t,createdAt:ne(),date:i.date||new Date().toISOString()})},async deleteHistoryEntry(t){await Le(C(N,"ingestas",t))},subscribeToHistory(t,i){const a=X(B(N,"ingestas"),ee("userId","==",t),U("createdAt","desc"),Z(50));return te(a,r=>{i(r.docs.map(s=>({id:s.id,...s.data()})))},r=>console.error(r))},subscribeToHba1cHistory(t,i){const a=X(B(N,"hba1c_logs"),ee("userId","==",t),U("date","desc"),Z(20));return te(a,r=>{i(r.docs.map(s=>({id:s.id,...s.data()})))},r=>console.error(r))},async trackIAUsage(t,i,a){const r=C(N,"users",t);await P(r,{daily_ia_usage:i+1,last_ia_usage_date:a})}},At=({isOpen:t,onClose:i,onLoginSuccess:a})=>{const[r,s]=d.useState(!0),[l,o]=d.useState(""),[c,n]=d.useState(""),[g,u]=d.useState(!1),[f,m]=d.useState(null),x=async h=>{h.preventDefault(),u(!0),m(null);try{if(r){const v=await y.login(l,c);a(v),i()}else{const v=await y.register(l,c);a(v),i()}}catch(v){m(v.message||"Error en la autenticación")}finally{u(!1)}};return e.jsx(_,{children:t&&e.jsx("div",{className:"fixed inset-0 z-[100] flex items-center justify-center p-4 bg-slate-900/60 backdrop-blur-sm",children:e.jsxs(w.div,{initial:{opacity:0,scale:.95,y:20},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.95,y:20},className:"relative w-full max-w-md bg-white rounded-[3rem] shadow-2xl overflow-hidden",children:[e.jsxs("div",{className:"bg-slate-900 p-8 text-white relative",children:[e.jsx("button",{onClick:i,className:"absolute top-6 right-6 p-2 hover:bg-white/10 rounded-full transition-colors",children:e.jsx(O,{size:20})}),e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(D,{className:"text-blue-400",size:24}),e.jsx("span",{className:"text-[10px] font-black uppercase tracking-[0.3em] text-slate-400",children:"Acceso Seguro Vitametra"})]}),e.jsxs("h2",{className:"text-3xl font-[1000] uppercase italic tracking-tighter",children:[r?"Bienvenido":"Crear Cuenta"," ",e.jsx("br",{}),e.jsx("span",{className:"text-blue-500",children:r?"De Vuelta":"Médica IA"})]})]}),e.jsxs("form",{onSubmit:x,className:"p-8 space-y-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx(Je,{className:"absolute left-4 top-1/2 -translate-y-1/2 text-slate-400",size:18}),e.jsx("input",{type:"email",placeholder:"Tu email",value:l,onChange:h=>o(h.target.value),className:"w-full pl-12 pr-6 py-4 bg-slate-50 border-2 border-transparent focus:border-blue-600 rounded-2xl outline-none transition-all font-bold",required:!0})]}),e.jsxs("div",{className:"relative",children:[e.jsx(Ye,{className:"absolute left-4 top-1/2 -translate-y-1/2 text-slate-400",size:18}),e.jsx("input",{type:"password",placeholder:"Tu contraseña",value:c,onChange:h=>n(h.target.value),className:"w-full pl-12 pr-6 py-4 bg-slate-50 border-2 border-transparent focus:border-blue-600 rounded-2xl outline-none transition-all font-bold",required:!0})]})]}),f&&e.jsx("p",{className:"text-red-500 text-[10px] font-black uppercase tracking-widest text-center",children:f}),e.jsxs("button",{type:"submit",disabled:g,className:"w-full py-5 bg-blue-600 hover:bg-slate-900 text-white rounded-2xl font-black uppercase text-xs tracking-[0.2em] transition-all flex items-center justify-center gap-3 shadow-xl shadow-blue-100",children:[g?e.jsx(T,{className:"animate-spin"}):r?"Entrar Ahora":"Empezar Registro",!g&&e.jsx(I,{size:16})]}),e.jsx("button",{type:"button",onClick:()=>s(!r),className:"w-full text-center text-[10px] font-black uppercase tracking-widest text-slate-400 hover:text-blue-600 transition-colors",children:r?"¿No tienes cuenta? Regístrate":"¿Ya eres usuario? Inicia sesión"})]})]})})})},Tt=({currentUser:t})=>{const[i,a]=d.useState(!1);d.useEffect(()=>{if(!localStorage.getItem("vitaflow_welcome_seen")&&t){const l=setTimeout(()=>a(!0),1e3);return()=>clearTimeout(l)}},[t]);const r=()=>{localStorage.setItem("vitaflow_welcome_seen","true"),a(!1)};return!i||!t?null:e.jsx("div",{className:"fixed inset-0 z-[100] flex items-center justify-center p-6 bg-slate-900/40 backdrop-blur-md",children:e.jsx("div",{className:"bg-white w-full max-w-lg rounded-[3.5rem] p-10 shadow-2xl border border-white relative overflow-hidden",children:e.jsxs("div",{className:"relative z-10 text-center",children:[e.jsx("div",{className:"w-20 h-20 bg-blue-600 rounded-[2rem] flex items-center justify-center mx-auto mb-8 shadow-xl shadow-blue-200",children:e.jsx(Qe,{className:"text-white",size:40})}),e.jsxs("h2",{className:"text-4xl font-black tracking-tighter text-slate-900 italic uppercase mb-4",children:["Hola, ",e.jsx("span",{className:"text-blue-600",children:t.firstName||"Usuario"})]}),e.jsxs("p",{className:"text-slate-500 font-medium leading-relaxed mb-10",children:["Has activado tu ecosistema ",e.jsx("span",{className:"font-bold text-slate-800",children:"VitaFlow"}),"."]}),e.jsx("button",{onClick:r,className:"w-full bg-black text-white p-6 rounded-[2rem] font-black uppercase text-[12px] tracking-[0.2em] shadow-xl",children:"Entrar a mi Ecosistema"})]})})})},Rt=new yt(""),fe=async t=>{try{return null}catch(i){return console.error("Gemini Error:",i),JSON.stringify({totalCarbs:20,calories:150,protein:5,fat:5,glycemicIndex:"Medio",optimizationTip:"No pudimos conectar con la IA, mostrando valores estimados."})}},Pt="v4.7-2026-INSIGHTS",Et={analyzeMetabolicTrends(t,i){const a=[];if(!t||t.length<5)return a;const r=t.filter(l=>{const o=new Date(l.timestamp).getHours();return o>=12&&o<=15});r.length>=3&&r.filter(o=>o.value>180).length/r.length>.6&&a.push({type:"WARNING",message:"Detectamos picos de glucosa recurrentes después de tus almuerzos.",suggestion:`Tu ratio actual es 1U:${i.clinicalConfig?.insulinRatioSchedule?.[0]?.ratio||"10"}g. ¿Has considerado ajustar el tiempo de espera pre-comida?`});const s=t.filter(l=>{const o=new Date(l.timestamp).getDay();return o===0||o===6});return s.length>0&&s.reduce((o,c)=>o+c.value,0)/s.length>160&&a.push({type:"TIP",message:"Tus niveles tienden a subir los fines de semana.",suggestion:"Pequeños ajustes en la actividad física durante el sábado podrían ayudarte a mantener tu meta."}),a},async findHistoricalImpact(t,i){const a=(t||"").toLowerCase().trim();if(!a||!Array.isArray(i)||i.length===0)return{trendMsg:"",adjustment:0};const r=a.split(/\s+/).filter(l=>l.length>3);return i.filter(l=>{if(!l||!l.userInput)return!1;const o=l.userInput.toLowerCase();return r.some(c=>o.includes(c))}).slice(0,5).length===0?{trendMsg:"Nuevo patrón detectado.",adjustment:0}:{trendMsg:"Patrón reconocido basado en tu historial previo.",adjustment:0}},async processMetabolicInference(t,i,a,r=100){const s=performance.now();try{const l=await fe(t);if(!l)throw new Error("La IA no pudo procesar el texto.");let o;try{o=typeof l=="string"?JSON.parse(l):l}catch{throw new Error("Formato de respuesta de IA inválido.")}const{trendMsg:c}=await this.findHistoricalImpact(t,i),n={totalCarbs:o.totalCarbs||0,calories:o.calories||0,protein:o.protein||0,fat:o.fat||0,glycemicIndex:o.glycemicIndex||"Bajo",aiContextualNote:c,optimizationTip:o.optimizationTip||"Procesa con normalidad."};return this.logInferencePerformance(t,n,s),n}catch(l){throw console.error("MetraCore Error:",l.message),new Error(l.message||"Fallo en la inferencia metabólica.")}},async logInferencePerformance(t,i,a){try{if(!i)return;await re(B(N,"anonymous_training_logs"),{algo:Pt,input_len:t?.length||0,carbs:i.totalCarbs||0,ms:Math.round(performance.now()-a),timestamp:ne()})}catch(r){console.warn("Log performance fallido:",r)}}},Lt=({insight:t,onAction:i})=>{const a={WARNING:{bg:"bg-red-50",border:"border-red-200",icon:e.jsx(Ze,{className:"text-red-500",size:20}),accent:"text-red-600",label:"Alerta de Patrón"},TIP:{bg:"bg-blue-50",border:"border-blue-200",icon:e.jsx(Xe,{className:"text-blue-500",size:20}),accent:"text-blue-600",label:"Sugerencia Bio"},SUCCESS:{bg:"bg-emerald-50",border:"border-emerald-200",icon:e.jsx(R,{className:"text-emerald-500",size:20}),accent:"text-emerald-600",label:"Logro Detectado"}}[t.type];return e.jsxs(w.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},whileHover:{scale:1.01},className:`${a.bg} ${a.border} border-2 p-6 rounded-[2.5rem] relative overflow-hidden shadow-sm`,children:[e.jsx("div",{className:"absolute -right-4 -top-4 opacity-5 text-slate-900",children:e.jsx(me,{size:120})}),e.jsxs("div",{className:"relative z-10",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"p-2 bg-white rounded-xl shadow-sm",children:a.icon}),e.jsx("span",{className:`text-[10px] font-black uppercase tracking-[0.2em] ${a.accent}`,children:a.label})]}),e.jsx("h4",{className:"text-lg font-[1000] text-slate-900 leading-tight tracking-tighter mb-2 italic uppercase",children:t.message}),e.jsx("p",{className:"text-sm text-slate-600 font-medium leading-relaxed mb-6",children:t.suggestion}),i&&e.jsxs("button",{onClick:i,className:"flex items-center gap-2 text-[10px] font-black uppercase tracking-widest text-slate-400 hover:text-slate-900 transition-colors",children:["Explorar en detalle ",e.jsx(I,{size:14})]})]})]})},ae=({currentUser:t,onStartClick:i,history:a=[]})=>{L();const[r,s]=d.useState(""),[l,o]=d.useState(!1),[c,n]=d.useState(null),g=d.useMemo(()=>!t||!a.length?[]:Et.analyzeMetabolicTrends(a,t),[a,t]),u=d.useMemo(()=>{const m=new Date;return m.setDate(m.getDate()-7),a.filter(x=>new Date(x.timestamp)>=m).map(x=>({time:new Date(x.timestamp).toLocaleDateString("es-CL",{weekday:"short"}),value:x.value,fullDate:new Date(x.timestamp).getTime()})).sort((x,h)=>x.fullDate-h.fullDate)},[a]),f=async()=>{const m=parseFloat(r);if(!m||m<=0){n({type:"error",msg:"Ingresa un valor válido mayor a 0"});return}if(m>600){n({type:"error",msg:"Valor fuera de rango clínico normal"});return}o(!0);try{if(!t?.id)throw new Error("Inicia sesión primero");await y.addHistoryEntry(t.id,{value:m,timestamp:new Date().toISOString(),type:"GLUCOSE",notes:"Registro rápido desde Inicio"}),n({type:"success",msg:"Glucemia guardada"}),s(""),setTimeout(()=>n(null),3e3)}catch(x){n({type:"error",msg:x.message})}finally{o(!1)}};return e.jsxs("div",{className:"max-w-6xl mx-auto space-y-10 pb-20 px-4 md:px-0",children:[e.jsxs("section",{className:"relative overflow-hidden bg-white rounded-[4rem] border border-slate-100 p-8 md:p-16 shadow-sm text-center",children:[e.jsx("div",{className:"absolute top-0 right-0 p-10 opacity-5 pointer-events-none",children:e.jsx(E,{size:240})}),e.jsxs(w.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"inline-flex items-center gap-2 px-5 py-2 rounded-full bg-blue-50 text-blue-600 text-[10px] font-black uppercase tracking-[0.25em] mb-10",children:[e.jsx(R,{size:14,className:"animate-pulse"})," Ecosistema Vitametra 2026"]}),e.jsxs("h1",{className:"text-5xl md:text-8xl font-[1000] text-slate-900 tracking-tighter leading-[0.85] uppercase italic mb-10",children:["Tu salud ",e.jsx("br",{}),e.jsx("span",{className:"text-blue-600",children:"Automatizada"})]}),e.jsxs("div",{className:"max-w-md mx-auto mb-12",children:[e.jsxs("div",{className:"relative group",children:[e.jsx("input",{type:"number",placeholder:"Ingresa tu glucosa actual...",value:r,onChange:m=>s(m.target.value),className:"w-full px-8 py-6 bg-slate-50 border-2 border-transparent focus:border-blue-600 focus:bg-white rounded-[2rem] text-xl font-black outline-none transition-all placeholder:text-slate-300 placeholder:italic"}),e.jsx("button",{onClick:f,disabled:l,className:"absolute right-3 top-3 bottom-3 px-6 bg-blue-600 text-white rounded-[1.5rem] font-black uppercase text-[10px] tracking-widest hover:bg-slate-900 transition-all flex items-center gap-2",children:l?"...":e.jsxs(e.Fragment,{children:[e.jsx(ue,{size:16})," Log"]})})]}),e.jsx(_,{children:c&&e.jsxs(w.p,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},className:`mt-4 text-[10px] font-black uppercase tracking-widest flex items-center justify-center gap-2 ${c.type==="error"?"text-red-500":"text-emerald-500"}`,children:[c.type==="error"?e.jsx(G,{size:14}):e.jsx($,{size:14}),c.msg]})})]}),e.jsx("div",{className:"flex flex-col sm:flex-row items-center justify-center gap-4",children:e.jsxs("button",{onClick:i,className:"w-full sm:w-auto px-10 py-6 bg-slate-900 text-white rounded-[2rem] font-black uppercase text-xs tracking-widest flex items-center justify-center gap-3 hover:bg-blue-600 transition-all active:scale-95 shadow-2xl shadow-slate-200",children:[t?"Iniciar Análisis IA":"Comenzar ahora"," ",e.jsx(I,{size:18})]})})]}),e.jsxs("section",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"p-3 bg-blue-600 text-white rounded-2xl",children:e.jsx(me,{size:24})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-[10px] font-black text-slate-400 uppercase tracking-[0.2em] mb-1",children:"Metra Cognitive Engine"}),e.jsxs("h4",{className:"text-3xl font-[1000] text-slate-900 tracking-tighter uppercase italic",children:["Insights ",e.jsx("span",{className:"text-blue-600",children:"Metabólicos"})]})]})]}),g.length>0?e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:g.map((m,x)=>e.jsx(Lt,{insight:m},x))}):e.jsxs("div",{className:"bg-slate-50 rounded-[3rem] p-10 border-2 border-dashed border-slate-200 text-center",children:[e.jsx("p",{className:"text-slate-400 text-xs font-black uppercase tracking-widest",children:"Analizando tu comportamiento..."}),e.jsx("p",{className:"text-slate-300 text-[10px] font-bold italic mt-2",children:"Registra más comidas y glucemias para activar las recomendaciones inteligentes."})]})]}),e.jsxs("section",{className:"bg-white rounded-[3rem] border border-slate-100 p-8 md:p-12 shadow-sm",children:[e.jsxs("div",{className:"flex justify-between items-start mb-10",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"text-[10px] font-black text-slate-400 uppercase tracking-[0.2em] mb-2 flex items-center gap-2",children:[e.jsx(pe,{size:14,className:"text-blue-600"})," Biometría Predictiva"]}),e.jsxs("h4",{className:"text-3xl font-[1000] text-slate-900 tracking-tighter uppercase italic",children:["Tendencia ",e.jsx("span",{className:"text-blue-600",children:"Semanal"})]})]}),e.jsx("div",{className:"p-3 bg-slate-50 rounded-2xl text-slate-400",children:e.jsx(Ue,{size:20})})]}),e.jsx("div",{className:"h-[300px] w-full flex items-center justify-center",children:u.length>0?e.jsx(je,{width:"100%",height:"100%",children:e.jsxs(we,{data:u,children:[e.jsx(ve,{strokeDasharray:"3 3",vertical:!1,stroke:"#f1f5f9"}),e.jsx(Ne,{dataKey:"time",axisLine:!1,tickLine:!1,tick:{fontSize:10,fontWeight:900,fill:"#cbd5e1"},dy:10}),e.jsx(ye,{hide:!0,domain:["dataMin - 20","dataMax + 20"]}),e.jsx(ke,{contentStyle:{borderRadius:"1rem",border:"none",boxShadow:"0 10px 15px -3px rgba(0,0,0,0.1)",fontSize:"12px",fontWeight:"900"},cursor:{stroke:"#2563eb",strokeWidth:1}}),e.jsx(Ce,{y:100,stroke:"#e2e8f0",strokeDasharray:"5 5"}),e.jsx(Se,{type:"monotone",dataKey:"value",stroke:"#2563eb",strokeWidth:5,dot:{r:6,fill:"#2563eb",strokeWidth:2,stroke:"#fff"},activeDot:{r:10,strokeWidth:0}})]})}):e.jsxs(w.div,{initial:{opacity:0},animate:{opacity:1},className:"text-center space-y-4",children:[e.jsx("div",{className:"w-16 h-16 bg-slate-50 rounded-2xl flex items-center justify-center mx-auto text-slate-200",children:e.jsx(et,{size:32})}),e.jsx("p",{className:"text-sm font-bold text-slate-400 max-w-[220px] mx-auto italic",children:"Aún no hay suficientes datos para mostrar la tendencia semanal."})]})})]}),e.jsxs("footer",{className:"flex justify-center items-center gap-10 opacity-30 pb-10",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(tt,{size:16}),e.jsx("span",{className:"text-[9px] font-black uppercase tracking-widest",children:"AES-256 Encrypted"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(E,{size:16}),e.jsx("span",{className:"text-[9px] font-black uppercase tracking-widest",children:"Health Level Seven v2"})]})]})]})},Mt=({history:t,onEntryClick:i})=>{const a=s=>({desayuno:{bg:"bg-orange-50",text:"text-orange-600",dot:"bg-orange-400"},almuerzo:{bg:"bg-blue-50",text:"text-blue-600",dot:"bg-blue-500"},cena:{bg:"bg-indigo-50",text:"text-indigo-600",dot:"bg-indigo-400"}})[s.toLowerCase()]||{bg:"bg-slate-50",text:"text-slate-500",dot:"bg-slate-400"},r=s=>s?s>180?{color:"text-rose-500",icon:e.jsx(pe,{size:14}),label:"Alto"}:s<70?{color:"text-amber-500",icon:e.jsx(st,{size:14}),label:"Bajo"}:{color:"text-emerald-500",icon:e.jsx($,{size:14}),label:"Rango"}:null;return t.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center py-32 text-center px-6",children:[e.jsx("div",{className:"w-20 h-20 bg-slate-50 rounded-full flex items-center justify-center mb-6",children:e.jsx(ce,{size:32,className:"text-slate-200"})}),e.jsx("h3",{className:"text-xl font-black text-slate-900 uppercase",children:"Sin registros"}),e.jsx("p",{className:"text-slate-400 text-xs mt-2",children:"Tus análisis aparecerán aquí."})]}):e.jsxs("div",{className:"max-w-md mx-auto space-y-8 pb-40 px-6 pt-10",children:[e.jsxs("header",{className:"flex items-end justify-between mb-12",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-[10px] font-bold text-blue-600 uppercase tracking-widest mb-1",children:"Historial"}),e.jsxs("h2",{className:"text-4xl font-black text-slate-900 tracking-tighter uppercase italic leading-none",children:["Mis ",e.jsx("br",{}),e.jsx("span",{className:"text-slate-300",children:"registros"})]})]}),e.jsxs("div",{className:"bg-slate-900 text-white px-4 py-2 rounded-2xl flex items-center gap-2",children:[e.jsx("span",{className:"text-xl font-black",children:t.length}),e.jsx("span",{className:"text-[9px] font-bold uppercase",children:"Total"})]})]}),e.jsx("div",{className:"space-y-4",children:t.map((s,l)=>{const o=a(s.mealType||"");return r(s.bloodGlucoseValue),e.jsxs(w.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},onClick:()=>i?.(s),className:"group bg-white rounded-[2rem] p-5 border border-slate-50 shadow-sm hover:shadow-md transition-all cursor-pointer active:scale-[0.98]",children:[e.jsx("div",{className:"flex items-center justify-between mb-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`px-3 py-1 rounded-full ${o.bg}`,children:e.jsx("span",{className:`text-[9px] font-bold uppercase ${o.text}`,children:s.mealType||"Comida"})}),e.jsxs("span",{className:"text-[10px] text-slate-400 font-bold flex items-center gap-1",children:[e.jsx(K,{size:12}),new Date(s.createdAt?.seconds*1e3||s.date).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})]})]})}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"h-16 w-16 rounded-2xl overflow-hidden bg-slate-100 shrink-0",children:e.jsx("img",{src:s.imageUrl||"https://images.unsplash.com/photo-1490645935967-10de6ba17061?q=80&w=200&auto=format&fit=crop",className:"h-full w-full object-cover",alt:""})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h4",{className:"text-slate-900 font-black text-lg truncate uppercase italic mb-2",children:s.foodName||"Análisis IA"}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-[7px] font-bold text-slate-400 uppercase",children:"Carbohidratos"}),e.jsxs("span",{className:"text-lg font-black text-blue-600",children:[s.totalCarbs,"g"]})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-[7px] font-bold text-slate-400 uppercase",children:"Insulina"}),e.jsxs("span",{className:"text-lg font-black text-slate-800",children:[s.finalInsulinUnits||s.recommendedInsulinUnits||"0","u"]})]})]})]}),e.jsx(J,{size:18,className:"text-slate-300 group-hover:text-blue-600"})]})]},s.id||l)})})]})},Dt=({currentUser:t})=>{const[i,a]=d.useState(t.aiMemory||""),[r,s]=d.useState(!1),[l,o]=d.useState(!1);d.useEffect(()=>{t.aiMemory&&a(t.aiMemory)},[t.aiMemory]);const c=async()=>{s(!0);try{await y.updateUser({id:t.id,aiMemory:i}),o(!1)}catch(n){console.error("Error al guardar la memoria IA:",n),alert("No se pudo sincronizar la memoria con el núcleo.")}finally{s(!1)}};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-indigo-600 to-blue-500 rounded-2xl flex items-center justify-center text-white shadow-lg shadow-indigo-100",children:e.jsx(at,{size:20})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-black tracking-tighter text-slate-900 uppercase leading-none",children:"Memoria Bio-Digital"}),e.jsx("p",{className:"text-[10px] font-black text-indigo-600 uppercase tracking-widest mt-1",children:"LTM (Long Term Memory)"})]})]}),!l&&e.jsx("button",{onClick:()=>o(!0),className:"p-2 bg-slate-50 hover:bg-slate-100 rounded-xl transition-colors",children:e.jsx(de,{size:18,className:"text-slate-400"})})]}),e.jsx("div",{className:"relative",children:l?e.jsxs("div",{className:"space-y-4 animate-in fade-in zoom-in-95 duration-200",children:[e.jsx("textarea",{value:i,onChange:n=>a(n.target.value),placeholder:"Ej: 'Suelo tener picos después de la pasta', 'Hago ejercicio a las 19:00', 'Mi cuerpo reacciona lento a la insulina rápida'...",className:"w-full h-40 bg-slate-50 border-2 border-indigo-50 rounded-[2rem] p-6 text-sm font-medium text-slate-700 outline-none focus:border-indigo-200 focus:bg-white transition-all resize-none"}),e.jsx("button",{onClick:c,disabled:r,className:"w-full bg-indigo-600 text-white p-5 rounded-2xl font-black uppercase text-[10px] tracking-[0.2em] flex items-center justify-center gap-3 shadow-lg shadow-indigo-100 active:scale-95 disabled:opacity-50 transition-all",children:r?e.jsx(T,{className:"animate-spin",size:16}):e.jsxs(e.Fragment,{children:[e.jsx(Y,{size:16})," Consolidar Aprendizaje"]})})]}):e.jsxs("div",{onClick:()=>o(!0),className:"group cursor-pointer bg-gradient-to-br from-slate-50 to-white border border-slate-100 rounded-[2.5rem] p-7 relative overflow-hidden transition-all hover:shadow-md",children:[e.jsx("div",{className:"absolute -top-4 -right-4 text-slate-50 group-hover:text-indigo-50 transition-colors",children:e.jsx(R,{size:80})}),i?e.jsxs("div",{className:"relative z-10",children:[e.jsxs("p",{className:"text-sm font-bold text-slate-600 leading-relaxed italic",children:['"',i,'"']}),e.jsxs("div",{className:"mt-4 flex items-center gap-2 text-[9px] font-black text-indigo-400 uppercase tracking-widest",children:[e.jsx(it,{size:12})," Datos cargados en el Agente AI"]})]}):e.jsx("div",{className:"relative z-10 py-4 text-center",children:e.jsx("p",{className:"text-xs font-bold text-slate-400 uppercase tracking-wider",children:"Sin memoria activa. Haz clic para entrenar a tu IA."})})]})}),e.jsxs("div",{className:"flex items-center gap-2 px-2",children:[e.jsx("div",{className:"w-1.5 h-1.5 bg-emerald-500 rounded-full animate-pulse"}),e.jsx("p",{className:"text-[9px] font-black text-slate-400 uppercase tracking-[0.15em]",children:"Optimización metabólica en tiempo real activa"})]})]})},_t=({currentUser:t,onUpdate:i})=>{const[a,r]=d.useState(!1),[s,l]=d.useState({diabetesType:t.clinicalConfig?.diabetesType||"Type 1",isf:t.clinicalConfig?.insulinSensitivityFactor||50,target:t.clinicalConfig?.targetGlucose||100,ratio:t.insulinRatioSchedule?.[0]?.ratio||15}),o=async()=>{r(!0);try{const c={id:t.id,clinicalConfig:{...t.clinicalConfig,diabetesType:s.diabetesType,insulinSensitivityFactor:s.isf,targetGlucose:s.target},insulinRatioSchedule:[{startTime:"08:00",ratio:s.ratio}]};await y.updateUser(c),i(c);const n=document.createElement("div");n.className="fixed bottom-10 left-1/2 -translate-x-1/2 bg-slate-900 text-white px-8 py-4 rounded-2xl font-black uppercase text-[10px] tracking-widest shadow-2xl z-[3000] animate-in slide-in-from-bottom-4",n.innerText="✅ PARÁMETROS RECALIBRADOS",document.body.appendChild(n),setTimeout(()=>n.remove(),3e3)}catch(c){console.error(c),alert("❌ Error al sincronizar con el Bio-Core")}finally{r(!1)}};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"w-10 h-10 bg-emerald-600 rounded-2xl flex items-center justify-center text-white shadow-lg shadow-emerald-100",children:e.jsx(E,{size:20})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-black tracking-tighter text-slate-900 uppercase leading-none",children:"Calibración"}),e.jsx("p",{className:"text-[10px] font-black text-emerald-600 uppercase tracking-widest mt-1",children:"Motor Clínico"})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-slate-50 p-4 rounded-2xl border border-slate-100",children:[e.jsx("label",{className:"text-[9px] font-black uppercase text-slate-400 block mb-2 tracking-widest",children:"Condición"}),e.jsxs("select",{value:s.diabetesType,onChange:c=>l({...s,diabetesType:c.target.value}),className:"w-full bg-white p-3 rounded-xl font-bold text-slate-700 outline-none border border-slate-200",children:[e.jsx("option",{value:"Type 1",children:"Tipo 1"}),e.jsx("option",{value:"Type 2",children:"Tipo 2"}),e.jsx("option",{value:"LADA",children:"LADA"})]})]}),e.jsxs("div",{className:"bg-slate-50 p-4 rounded-2xl border border-slate-100",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsxs("label",{className:"text-[9px] font-black uppercase text-slate-400 tracking-widest",children:["Ratio (1U:",s.ratio,"g)"]}),e.jsx("span",{className:"text-lg font-black text-blue-600",children:s.ratio})]}),e.jsx("input",{type:"range",min:"1",max:"40",value:s.ratio,onChange:c=>l({...s,ratio:parseInt(c.target.value)}),className:"w-full h-1.5 bg-slate-200 rounded-lg appearance-none cursor-pointer accent-blue-600"})]}),e.jsxs("div",{className:"bg-slate-50 p-4 rounded-2xl border border-slate-100",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsxs("label",{className:"text-[9px] font-black uppercase text-slate-400 tracking-widest",children:["Sensibilidad (",s.isf,")"]}),e.jsx("span",{className:"text-lg font-black text-emerald-600",children:s.isf})]}),e.jsx("input",{type:"range",min:"10",max:"200",step:"5",value:s.isf,onChange:c=>l({...s,isf:parseInt(c.target.value)}),className:"w-full h-1.5 bg-slate-200 rounded-lg appearance-none cursor-pointer accent-emerald-500"})]}),e.jsx("button",{onClick:o,disabled:a,className:"w-full bg-slate-900 text-white p-5 rounded-2xl font-black uppercase text-[10px] tracking-[0.2em] flex items-center justify-center gap-3 transition-all active:scale-95 disabled:opacity-50 shadow-xl shadow-slate-200 hover:bg-blue-600",children:a?e.jsx("div",{className:"w-5 h-5 border-2 border-white border-t-transparent rounded-full animate-spin"}):e.jsxs(e.Fragment,{children:[e.jsx(Y,{size:16})," Aplicar Cambios"]})})]})]})},Ft=[{id:"sedentary",label:"Sedentario",description:"Poco o nada de ejercicio.",multiplier:"1.2x",icon:e.jsx(lt,{size:20})},{id:"light",label:"Ligero",description:"Ejercicio 1-3 días/semana.",multiplier:"1.375x",icon:e.jsx(rt,{size:20})},{id:"moderate",label:"Moderado",description:"Intenso 3-5 días/semana.",multiplier:"1.55x",icon:e.jsx(F,{size:20})},{id:"active",label:"Muy Activo",description:"Entrenamiento diario.",multiplier:"1.725x",icon:e.jsx(nt,{size:20})},{id:"athlete",label:"Atleta Pro",description:"Esfuerzo físico extremo.",multiplier:"1.9x",icon:e.jsx(ot,{size:20})}],Bt=({selectedId:t,onSelect:i})=>e.jsx("div",{className:"grid gap-3 w-full max-w-md mx-auto",children:Ft.map(a=>e.jsxs("button",{onClick:()=>i(a.id),className:`flex items-center gap-4 p-5 rounded-[2rem] border-2 transition-all active:scale-[0.98] ${t===a.id?"bg-metra-blue border-metra-blue text-white shadow-lg":"bg-slate-50 border-transparent text-metra-dark"}`,children:[e.jsx("div",{className:`p-3 rounded-2xl ${t===a.id?"bg-white/20":"bg-white text-metra-blue"}`,children:a.icon}),e.jsxs("div",{className:"flex-1 text-left",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"font-black uppercase text-[10px] tracking-widest",children:a.label}),e.jsx("span",{className:"text-[9px] font-black opacity-60",children:a.multiplier})]}),e.jsx("p",{className:"text-[10px] font-bold opacity-70",children:a.description})]})]},a.id))}),Ht=({targetWeight:t,targetHba1c:i,onUpdate:a,unit:r})=>e.jsxs("div",{className:"w-full space-y-8 animate-in fade-in slide-in-from-bottom-4",children:[e.jsxs("div",{className:"bg-slate-50 p-6 rounded-[2.5rem] border border-slate-100",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[e.jsx("div",{className:"p-3 bg-white rounded-2xl shadow-sm text-metra-blue",children:e.jsx(he,{size:20})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-[10px] font-black text-slate-400 uppercase tracking-widest",children:"Peso Objetivo"}),e.jsxs("p",{className:"text-xl font-[1000] text-metra-dark italic uppercase tracking-tighter",children:[t," kg"]})]})]}),e.jsx("input",{type:"range",min:"40",max:"150",value:t,onChange:s=>a({targetWeight:Number(s.target.value)}),className:"w-full h-2 bg-slate-200 rounded-lg appearance-none cursor-pointer accent-metra-blue"}),e.jsxs("div",{className:"flex justify-between mt-2 px-1",children:[e.jsx("span",{className:"text-[9px] font-black text-slate-300 uppercase",children:"40kg"}),e.jsx("span",{className:"text-[9px] font-black text-slate-300 uppercase",children:"150kg"})]})]}),e.jsxs("div",{className:"bg-metra-dark p-6 rounded-[2.5rem] shadow-xl relative overflow-hidden",children:[e.jsx("div",{className:"absolute -top-10 -right-10 w-32 h-32 bg-metra-blue/10 blur-3xl rounded-full"}),e.jsxs("div",{className:"flex items-center gap-3 mb-6 relative z-10",children:[e.jsx("div",{className:"p-3 bg-white/10 rounded-2xl text-metra-blue backdrop-blur-md",children:e.jsx(be,{size:20})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-[10px] font-black text-white/40 uppercase tracking-widest",children:"HbA1c Objetivo"}),e.jsxs("p",{className:"text-xl font-[1000] text-white italic uppercase tracking-tighter",children:[i,"%"]})]})]}),e.jsx("input",{type:"range",min:"4.0",max:"9.0",step:"0.1",value:i,onChange:s=>a({targetHba1c:Number(s.target.value)}),className:"w-full h-2 bg-white/10 rounded-lg appearance-none cursor-pointer accent-metra-blue relative z-10"}),e.jsxs("div",{className:"flex justify-between mt-2 px-1 relative z-10",children:[e.jsx("span",{className:"text-[9px] font-black text-white/20 uppercase",children:"4.0%"}),e.jsx("span",{className:"text-[9px] font-black text-white/20 uppercase",children:"9.0%"})]})]})]}),Gt=({currentUser:t,onUpdateUser:i})=>{const[a,r]=d.useState(!1),[s,l]=d.useState(!1),[o,c]=d.useState(null),[n,g]=d.useState(t.insulinRatioSchedule||[{startTime:"06:00",ratio:15},{startTime:"13:00",ratio:15},{startTime:"20:00",ratio:15}]),u=async b=>{const j=b.target.files?.[0];if(!(!j||!t?.id)){r(!0);try{const k=Be(He,`avatars/${t.id}`);await Ge(k,j);const p=await Oe(k);await P(C(N,"users",t.id),{photoURL:p}),i({photoURL:p})}catch(k){console.error("Error subiendo Bio-Avatar:",k)}finally{r(!1)}}},f=async()=>{l(!0);try{const b=C(N,"users",t.id);await P(b,{insulinRatioSchedule:n,updatedAt:new Date().toISOString()}),i({insulinRatioSchedule:n})}catch(b){console.error("Error guardando parámetros:",b)}finally{l(!1)}},m=(b,j)=>{const k=[...n];k[b].ratio=Number(j),g(k)},x=async b=>{i({activityLevel:b});const j=C(N,"users",t.id);await P(j,{activityLevel:b}),setTimeout(()=>c(null),300)},h=async b=>{i({glucoseUnitPreference:b});const j=C(N,"users",t.id);await P(j,{glucoseUnitPreference:b}),c(null)},v=async b=>{i(b);const j=C(N,"users",t.id);await P(j,b)};return e.jsxs("div",{className:"min-h-screen bg-[#FBFBFE] pb-40",children:[e.jsxs("header",{className:"relative pt-20 pb-12 px-6 bg-white rounded-b-[4rem] shadow-[0_20px_50px_rgba(0,0,0,0.02)] overflow-hidden",children:[e.jsx("div",{className:"absolute top-0 right-0 w-64 h-64 bg-blue-50 blur-[100px] rounded-full -mr-32 -mt-32 opacity-60"}),e.jsxs("div",{className:"relative flex flex-col items-center",children:[e.jsxs(w.div,{initial:{scale:.9,opacity:0},animate:{scale:1,opacity:1},className:"relative",children:[e.jsx("div",{className:"w-32 h-32 rounded-[3rem] p-1 bg-gradient-to-tr from-blue-500 to-emerald-400 shadow-2xl",children:e.jsx("div",{className:"w-full h-full rounded-[2.8rem] bg-white overflow-hidden flex items-center justify-center border-4 border-white",children:a?e.jsx(T,{className:"animate-spin text-blue-500",size:32}):t?.photoURL?e.jsx("img",{src:t.photoURL,alt:"Bio-Profile",className:"w-full h-full object-cover"}):e.jsx(q,{size:48,className:"text-slate-200"})})}),e.jsxs("label",{className:"absolute -bottom-2 -right-2 bg-slate-900 text-white p-3 rounded-2xl shadow-xl border-4 border-white cursor-pointer hover:scale-110 active:scale-90 transition-all",children:[e.jsx(ct,{size:18,strokeWidth:2.5}),e.jsx("input",{type:"file",className:"hidden",onChange:u})]})]}),e.jsxs("h2",{className:"mt-8 text-4xl font-[1000] tracking-tighter text-slate-900 italic uppercase leading-none",children:[t?.firstName||"Usuario"," ",e.jsx("span",{className:"text-blue-600 italic",children:"PRO"})]}),e.jsxs("div",{className:"mt-4 inline-flex items-center gap-2 px-4 py-1.5 bg-slate-900 rounded-full shadow-lg shadow-blue-100",children:[e.jsx(dt,{size:12,className:"text-blue-400"}),e.jsx("span",{className:"text-[9px] font-black text-white uppercase tracking-[0.2em]",children:"Bio-Core Identity Active"})]})]})]}),e.jsxs("main",{className:"px-6 mt-10 space-y-10",children:[e.jsxs("section",{className:"bg-white p-8 rounded-[3rem] border border-slate-50 shadow-[0_8px_30px_rgba(0,0,0,0.02)]",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[e.jsx("div",{className:"p-2 bg-blue-50 text-blue-600 rounded-xl",children:e.jsx(R,{size:20})}),e.jsx("h3",{className:"text-[10px] font-black text-slate-400 uppercase tracking-[0.3em]",children:"Memoria Cognitiva IA"})]}),e.jsx(Dt,{currentUser:t})]}),e.jsxs("section",{className:"space-y-6",children:[e.jsx("h3",{className:"text-[10px] font-black text-slate-400 uppercase tracking-[0.3em] ml-4",children:"Parámetros de Calibración"}),e.jsxs("div",{className:"bg-white rounded-[3rem] border border-slate-50 shadow-[0_8px_30px_rgba(0,0,0,0.02)] overflow-hidden",children:[e.jsx(V,{icon:e.jsx(E,{className:"text-blue-600"}),label:"Esfuerzo Diario",value:t.activityLevel||"Sin definir",onClick:()=>c("activity")}),e.jsx(V,{icon:e.jsx(ge,{className:"text-emerald-500"}),label:"Objetivos Clínicos",value:`${t.targetWeight||70}kg • ${t.targetHba1c||5.5}%`,onClick:()=>c("goals")}),e.jsx(V,{icon:e.jsx(be,{className:"text-rose-500"}),label:"Unidades Médicas",value:t.glucoseUnitPreference,onClick:()=>c("units"),isLast:!0})]})]}),e.jsx("section",{className:"bg-white p-8 rounded-[3rem] border border-slate-50 shadow-[0_8px_30px_rgba(0,0,0,0.02)]",children:e.jsx(_t,{currentUser:t,onUpdate:b=>i(b)})}),e.jsxs("section",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between px-4",children:[e.jsx("h3",{className:"text-[10px] font-black text-slate-400 uppercase tracking-[0.3em]",children:"Cronología de Ratios"}),e.jsx(he,{size:16,className:"text-slate-300"})]}),e.jsx("div",{className:"bg-white rounded-[3.5rem] p-4 border border-slate-50 shadow-[0_8px_30px_rgba(0,0,0,0.02)]",children:n.map((b,j)=>e.jsxs("div",{className:`flex items-center justify-between p-6 ${j!==n.length-1?"border-b border-slate-50":""}`,children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-12 h-12 bg-slate-50 rounded-2xl flex items-center justify-center text-blue-600 border border-slate-100",children:e.jsx(K,{size:20})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-[9px] font-black text-slate-400 uppercase tracking-widest mb-1",children:"Inicio Segmento"}),e.jsx("span",{className:"text-lg font-black text-slate-900 italic tracking-tighter",children:b.startTime})]})]}),e.jsxs("div",{className:"flex items-center gap-3 bg-slate-50 p-2 rounded-2xl border border-slate-100",children:[e.jsx("input",{type:"number",value:b.ratio,onChange:k=>m(j,k.target.value),className:"w-16 bg-white border-none rounded-xl py-3 text-center font-black text-blue-600 shadow-sm outline-none text-xl"}),e.jsx("span",{className:"text-[10px] font-black text-slate-400 uppercase mr-3 italic",children:"g/ui"})]})]},j))})]}),e.jsxs("div",{className:"space-y-4 pt-6",children:[e.jsxs("button",{onClick:f,disabled:s,className:"group relative w-full bg-slate-900 text-white p-6 rounded-[2.5rem] font-black uppercase text-[11px] tracking-[0.3em] overflow-hidden transition-all hover:scale-[1.02] active:scale-95 shadow-2xl shadow-blue-200",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-blue-600 to-emerald-500 opacity-0 group-hover:opacity-100 transition-opacity"}),e.jsx("span",{className:"relative flex items-center justify-center gap-3",children:s?e.jsx(T,{className:"animate-spin"}):e.jsxs(e.Fragment,{children:[e.jsx(D,{size:20,className:"text-blue-400"})," Sincronizar Bio-Core"]})})]}),e.jsxs("button",{onClick:()=>y.logout(),className:"w-full flex items-center justify-center gap-3 p-6 text-rose-500 font-black text-[11px] uppercase tracking-[0.3em] rounded-[2.5rem] border border-transparent hover:bg-rose-50 transition-all",children:[e.jsx(oe,{size:18})," Finalizar Sesión Segura"]})]})]}),e.jsxs("footer",{className:"py-20 text-center opacity-30",children:[e.jsx(F,{size:20,fill:"currentColor",className:"mx-auto mb-4 text-slate-400"}),e.jsx("p",{className:"text-[9px] font-black text-slate-500 uppercase tracking-[0.6em]",children:"Vitametra Engine v4.2.0 • 2026"})]}),e.jsx(_,{children:o&&e.jsxs("div",{className:"fixed inset-0 z-[2000] flex items-end justify-center",children:[e.jsx(w.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"absolute inset-0 bg-slate-900/40 backdrop-blur-xl",onClick:()=>c(null)}),e.jsxs(w.div,{initial:{y:"100%"},animate:{y:0},exit:{y:"100%"},transition:{type:"spring",damping:25,stiffness:200},className:"relative w-full max-w-lg bg-white rounded-t-[4rem] p-10 shadow-2xl pb-16",children:[e.jsx("div",{className:"w-16 h-1.5 bg-slate-100 rounded-full mx-auto mb-10"}),e.jsxs("div",{className:"flex justify-between items-center mb-10",children:[e.jsxs("h3",{className:"text-2xl font-[1000] text-slate-900 uppercase italic tracking-tighter",children:[o==="activity"&&"Bio-Actividad",o==="units"&&"Sistema Médico",o==="goals"&&"Metas Clínicas"]}),e.jsx("button",{onClick:()=>c(null),className:"p-3 bg-slate-50 rounded-full text-slate-400 hover:text-slate-900 transition-colors",children:e.jsx(O,{size:24,strokeWidth:3})})]}),e.jsxs("div",{className:"max-h-[60vh] overflow-y-auto",children:[o==="activity"&&e.jsx(Bt,{selectedId:t.activityLevel,onSelect:x}),o==="units"&&e.jsx("div",{className:"grid gap-4",children:["mg/dL","mmol/L"].map(b=>e.jsxs("button",{onClick:()=>h(b),className:`p-8 rounded-[2.5rem] border-2 flex justify-between items-center transition-all ${t.glucoseUnitPreference===b?"bg-blue-600 border-blue-600 text-white shadow-xl":"bg-slate-50 border-transparent text-slate-800 hover:bg-slate-100"}`,children:[e.jsx("span",{className:"font-black text-lg uppercase tracking-widest",children:b}),t.glucoseUnitPreference===b&&e.jsx(D,{size:24})]},b))}),o==="goals"&&e.jsx(Ht,{targetWeight:t.targetWeight||70,targetHba1c:t.targetHba1c||5.5,onUpdate:v,unit:t.glucoseUnitPreference})]})]})]})})]})},V=({icon:t,label:i,value:a,onClick:r,isLast:s})=>e.jsxs("button",{onClick:r,className:`w-full flex items-center justify-between p-7 hover:bg-slate-50 transition-all ${s?"":"border-b border-slate-50"}`,children:[e.jsxs("div",{className:"flex items-center gap-5",children:[e.jsx("div",{className:"w-12 h-12 bg-white rounded-2xl flex items-center justify-center shadow-sm border border-slate-50",children:le.cloneElement(t,{size:20})}),e.jsxs("div",{className:"text-left",children:[e.jsx("p",{className:"text-[10px] font-black text-slate-400 uppercase tracking-widest mb-1",children:i}),e.jsx("p",{className:"text-sm font-extrabold text-slate-800 uppercase tracking-tight",children:a})]})]}),e.jsx(J,{size:20,className:"text-slate-200"})]}),Ot=()=>e.jsxs("svg",{className:"animate-spin h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),$t=({onLoginSuccess:t})=>{const i=L(),[a,r]=d.useState(1),[s,l]=d.useState(!1),[o,c]=d.useState(null),[n,g]=d.useState({firstName:"",lastName:"",email:"",password:"",diabetesType:"Type 1",country:"Chile",ratio:12,isf:50,targetGlucose:100}),u=()=>{if(a===1&&(!n.firstName||!n.lastName||!n.email||!n.password)){c("Por favor, completa todos los campos de identidad.");return}if(a===1&&n.password.length<6){c("La contraseña debe tener al menos 6 caracteres.");return}c(null),r(x=>x+1)},f=()=>r(x=>x-1),m=async x=>{x.preventDefault(),l(!0),c(null);try{const h=`${n.firstName} ${n.lastName}`.trim(),j={id:(await y.register(n.email,n.password)).user.uid,firstName:n.firstName,lastName:n.lastName,name:h,email:n.email.toLowerCase().trim(),role:"USER",subscription_tier:"BASE",ia_credits:3,daily_ia_usage:0,streak:0,createdAt:new Date().toISOString(),insulinRatioSchedule:[{startTime:"08:00",ratio:Number(n.ratio)}],clinicalConfig:{diabetesType:n.diabetesType,insulinSensitivityFactor:Number(n.isf),targetGlucose:Number(n.targetGlucose)},memory:{patterns:{highGlucoseTriggers:[],effectiveCorrections:[],notableEvents:[]},preferences:{dietaryRestrictions:[],favoriteSafeFoods:[]},aiNotes:`Protocolo VitaFlow activado para ${n.firstName}.`}};await y.updateUser(j),t&&t(j),i("/dashboard")}catch(h){console.error("Error en registro:",h),c(h.message||"Error al activar el perfil clínico."),r(1)}finally{l(!1)}};return e.jsxs("div",{className:"min-h-screen bg-[#F8FAFC] px-6 py-12 font-sans antialiased text-slate-900",children:[e.jsx("div",{className:"max-w-md mx-auto mb-10 flex gap-2 justify-center",children:[1,2,3].map(x=>e.jsx("div",{className:`h-1.5 w-16 rounded-full transition-all duration-700 ${a>=x?"bg-blue-600":"bg-slate-200"}`},x))}),e.jsxs("div",{className:"max-w-xl mx-auto",children:[o&&e.jsxs("div",{className:"mb-6 p-4 bg-red-50 border border-red-100 text-red-600 rounded-2xl text-[10px] font-black uppercase tracking-widest text-center animate-pulse flex items-center justify-center",children:[e.jsx(G,{className:"mr-2",size:14})," ",o]}),a===1&&e.jsxs("div",{className:"animate-in fade-in slide-in-from-bottom-4 duration-500",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("div",{className:"w-20 h-20 bg-white rounded-[2.5rem] shadow-xl shadow-blue-100/50 flex items-center justify-center mx-auto mb-6",children:e.jsx(q,{className:"text-blue-600",size:32})}),e.jsxs("h1",{className:"text-4xl font-[1000] tracking-tighter italic uppercase",children:["Crea tu ",e.jsx("span",{className:"text-blue-600",children:"Perfil"})]}),e.jsx("p",{className:"text-slate-400 text-[10px] font-bold uppercase tracking-[0.2em] mt-2 text-center",children:"Identidad Metabólica 2026"})]}),e.jsxs("div",{className:"bg-white p-8 rounded-[3rem] shadow-2xl shadow-slate-200/50 space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx("input",{value:n.firstName,onChange:x=>g({...n,firstName:x.target.value}),className:"w-full p-5 bg-slate-50 rounded-2xl font-bold text-sm outline-none focus:ring-2 ring-blue-100 transition-all",placeholder:"Nombre"}),e.jsx("input",{value:n.lastName,onChange:x=>g({...n,lastName:x.target.value}),className:"w-full p-5 bg-slate-50 rounded-2xl font-bold text-sm outline-none focus:ring-2 ring-blue-100 transition-all",placeholder:"Apellido"})]}),e.jsx("input",{value:n.email,onChange:x=>g({...n,email:x.target.value}),className:"w-full p-5 bg-slate-50 rounded-2xl font-bold text-sm outline-none focus:ring-2 ring-blue-100 transition-all",placeholder:"Email"}),e.jsx("input",{type:"password",value:n.password,onChange:x=>g({...n,password:x.target.value}),className:"w-full p-5 bg-slate-50 rounded-2xl font-bold text-sm outline-none focus:ring-2 ring-blue-100 transition-all",placeholder:"Contraseña"}),e.jsxs("button",{onClick:u,className:"w-full bg-slate-900 text-white p-6 rounded-[2rem] font-black uppercase text-[11px] tracking-widest flex items-center justify-center gap-3 hover:bg-blue-600 transition-colors shadow-lg shadow-slate-200",children:["Siguiente Paso ",e.jsx(I,{size:18})]})]})]}),a===2&&e.jsxs("div",{className:"animate-in fade-in slide-in-from-right-4 duration-500",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("div",{className:"w-20 h-20 bg-blue-600 rounded-[2.5rem] shadow-xl flex items-center justify-center mx-auto mb-6 text-white",children:e.jsx(E,{size:32})}),e.jsx("h2",{className:"text-3xl font-[1000] tracking-tighter italic uppercase text-slate-900",children:"Configuración"})]}),e.jsxs("div",{className:"bg-white p-8 rounded-[3rem] shadow-2xl shadow-slate-200/50 space-y-8",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-[9px] font-black uppercase text-slate-400 block mb-3 tracking-widest",children:"Condición Clínica"}),e.jsxs("select",{value:n.diabetesType,onChange:x=>g({...n,diabetesType:x.target.value}),className:"w-full p-5 bg-slate-50 rounded-2xl font-bold text-sm outline-none border-none",children:[e.jsx("option",{value:"Type 1",children:"Diabetes Tipo 1"}),e.jsx("option",{value:"Type 2",children:"Diabetes Tipo 2"}),e.jsx("option",{value:"LADA",children:"LADA / Otros"})]})]}),e.jsxs("div",{className:"p-6 bg-slate-50 rounded-[2rem]",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("label",{className:"text-[9px] font-black uppercase text-slate-400 tracking-widest",children:"Ratio (I:C)"}),e.jsxs("span",{className:"text-blue-600 font-black text-sm",children:["1U : ",n.ratio,"g"]})]}),e.jsx("input",{type:"range",min:"1",max:"40",value:n.ratio,onChange:x=>g({...n,ratio:parseInt(x.target.value)}),className:"w-full h-2 bg-slate-200 rounded-lg appearance-none cursor-pointer accent-blue-600"})]}),e.jsxs("div",{className:"flex gap-4",children:[e.jsx("button",{onClick:f,className:"p-6 bg-slate-100 rounded-[2rem] text-slate-400 font-black hover:bg-slate-200 transition-colors",children:e.jsx(xt,{size:20})}),e.jsx("button",{onClick:u,className:"flex-1 bg-slate-900 text-white p-6 rounded-[2rem] font-black uppercase text-[11px] tracking-widest shadow-xl",children:"Definir Metas"})]})]})]}),a===3&&e.jsxs("div",{className:"animate-in fade-in slide-in-from-right-4 duration-500",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("div",{className:"w-20 h-20 bg-emerald-500 rounded-[2.5rem] shadow-xl flex items-center justify-center mx-auto mb-6 text-white",children:e.jsx(ge,{size:32})}),e.jsx("h2",{className:"text-3xl font-[1000] tracking-tighter italic uppercase text-slate-900",children:"Meta Control"})]}),e.jsxs("div",{className:"bg-white p-8 rounded-[3rem] shadow-2xl shadow-slate-200/50 space-y-8",children:[e.jsxs("div",{className:"p-8 bg-blue-50/50 rounded-[2.5rem] text-center border border-blue-100",children:[e.jsx("input",{type:"number",value:n.targetGlucose,onChange:x=>g({...n,targetGlucose:parseInt(x.target.value)}),className:"w-full bg-transparent text-center text-6xl font-[1000] text-blue-600 outline-none"}),e.jsx("p",{className:"text-[10px] font-black text-blue-400 uppercase tracking-widest mt-2",children:"mg/dL Objetivo"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("p",{className:"text-center text-[10px] text-slate-400 font-bold italic leading-relaxed px-4",children:"Al activar VitaFlow, aceptas el procesamiento de datos médicos mediante algoritmos de inteligencia artificial."}),e.jsx("button",{onClick:m,disabled:s,className:"w-full bg-blue-600 text-white p-7 rounded-[2rem] font-[1000] uppercase text-[13px] tracking-[0.1em] shadow-2xl shadow-blue-200 hover:bg-slate-900 transition-all flex items-center justify-center",children:s?e.jsx(Ot,{}):"Finalizar y Activar Perfil"})]})]})]})]})]})};ze("APP_USR-48e564b8-fd42-43a3-bb8e-9e0f30aaeafd");const Wt=({planId:t,amount:i,currentUser:a,onClose:r,onSuccess:s})=>{const[l,o]=d.useState(!1),n="https://api-pe6bb56yhq-uc.a.run.app/processPayment",g=async({formData:u})=>{o(!0);try{const m=await(await fetch(n,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({token:u.token,issuer_id:u.issuer_id,payment_method_id:u.payment_method_id,installments:u.installments,planId:t,amount:i,userId:a?.uid||a?.id,email:a?.email})})).json();m.success&&m.status==="approved"?s():Q.fire({title:"Pago no aprobado",text:m.error||"Verifica los datos de tu tarjeta e intenta nuevamente.",icon:"warning",confirmButtonColor:"#2563eb",customClass:{popup:"rounded-[2.5rem]"}})}catch(f){console.error("Error en el pago:",f),Q.fire({title:"Error de Conexión",text:"No pudimos contactar con el servidor de pagos.",icon:"error",confirmButtonColor:"#2563eb",customClass:{popup:"rounded-[2.5rem]"}})}finally{o(!1)}};return e.jsxs("div",{className:"fixed inset-0 z-[3000] flex items-end sm:items-center justify-center p-4",children:[e.jsx("div",{className:"absolute inset-0 bg-slate-900/60 backdrop-blur-md",onClick:r}),e.jsxs("div",{className:"relative w-full max-w-md bg-white rounded-[3.5rem] p-8 shadow-2xl animate-in slide-in-from-bottom-10 overflow-hidden",children:[l&&e.jsxs("div",{className:"absolute inset-0 z-50 bg-white/80 backdrop-blur-sm flex flex-col items-center justify-center",children:[e.jsx(T,{className:"animate-spin text-blue-600 mb-4",size:40}),e.jsx("p",{className:"text-[10px] font-black uppercase tracking-widest text-slate-900",children:"Validando Pago..."})]}),e.jsx("button",{onClick:r,className:"absolute top-6 right-6 text-slate-300 hover:text-slate-900 z-10",children:e.jsx(O,{size:24})}),e.jsxs("div",{className:"text-center mb-6",children:[e.jsx("div",{className:"w-14 h-14 bg-blue-50 text-blue-600 rounded-2xl flex items-center justify-center mx-auto mb-4",children:e.jsx(D,{size:28})}),e.jsx("h3",{className:"text-xl font-[1000] text-slate-900 uppercase italic leading-none",children:"Checkout Seguro"}),e.jsxs("p",{className:"text-[10px] font-black text-slate-400 uppercase tracking-widest mt-2",children:["Plan ",t," — $",i.toLocaleString("es-CL")," CLP"]})]}),e.jsx("div",{className:"min-h-[350px]",children:e.jsx(Ie,{initialization:{amount:i},customization:{visual:{theme:"flat"},paymentMethods:{bankTransfer:"all",ticket:"all",creditCard:"all",debitCard:"all",maxInstallments:1}},onSubmit:g})})]})]})},Vt=[{id:"monthly",title:"Starter",priceCLP:"7.990",rawPrice:7990,features:["30 Análisis de comidas con IA","Sincronización de glucosa","Soporte clínico estándar"],icon:e.jsx(F,{size:24}),color:"blue"},{id:"quarterly",title:"Pro",priceCLP:"19.990",rawPrice:19990,features:["IA Ilimitada 24/7","Reportes PDF para tu médico","Proyección de HbA1c","Ahorra 15%"],isPopular:!0,badge:"Más Popular",icon:e.jsx(pt,{size:24}),color:"blue"},{id:"annual",title:"Global",priceCLP:"69.900",rawPrice:69900,features:["Acceso Total Ilimitado","Dashboard Pro avanzado","Soporte prioritario 1:1","Ahorra 25%"],icon:e.jsx(ht,{size:24}),badge:"Mejor Valor",color:"emerald"}],qt=({currentUser:t,onUpdateUser:i})=>{const a=L(),[r,s]=d.useState(null);return e.jsxs("div",{className:"min-h-screen bg-[#FBFBFE] pb-20",children:[e.jsxs("header",{className:"pt-20 pb-12 px-6 text-center",children:[e.jsxs(w.div,{initial:{opacity:0},animate:{opacity:1},className:"inline-flex items-center gap-2 px-4 py-1.5 bg-blue-50 rounded-full mb-6",children:[e.jsx(R,{size:14,className:"text-blue-600"}),e.jsx("span",{className:"text-[10px] font-black text-blue-700 uppercase tracking-widest",children:"Protocolos de Precisión 2026"})]}),e.jsxs("h1",{className:"text-5xl md:text-7xl font-[1000] text-slate-900 tracking-tighter uppercase italic leading-[0.85] mb-6",children:["Elige tu ",e.jsx("br",{}),e.jsx("span",{className:"text-blue-600",children:"Plan."})]}),e.jsx("p",{className:"text-slate-400 font-bold uppercase text-[10px] tracking-[0.3em]",children:"IA para el control de tu salud"})]}),e.jsx("div",{className:"max-w-6xl mx-auto px-6 grid grid-cols-1 md:grid-cols-3 gap-8",children:Vt.map(l=>e.jsxs(w.div,{whileHover:{y:-10},className:`relative p-10 rounded-[3.5rem] bg-white border transition-all duration-500 flex flex-col ${l.isPopular?"border-blue-600 shadow-2xl shadow-blue-100 ring-4 ring-blue-50":"border-slate-100 shadow-sm"}`,children:[(l.isPopular||l.badge)&&e.jsxs("div",{className:`absolute -top-5 left-1/2 -translate-x-1/2 text-white px-8 py-2 rounded-full flex items-center gap-2 font-black text-[10px] uppercase tracking-widest shadow-xl ${l.color==="emerald"?"bg-emerald-500":"bg-blue-600"}`,children:[l.isPopular?e.jsx(mt,{size:14}):e.jsx(R,{size:14}),l.badge||"Recomendado"]}),e.jsx("div",{className:`mb-8 w-16 h-16 rounded-2xl flex items-center justify-center ${l.color==="emerald"?"bg-emerald-50 text-emerald-600":"bg-blue-50 text-blue-600"}`,children:l.icon}),e.jsxs("div",{className:"mb-8",children:[e.jsxs("h3",{className:"text-[10px] font-black text-slate-400 uppercase tracking-widest mb-2",children:["Vitametra ",l.title]}),e.jsxs("div",{className:"flex items-baseline gap-1",children:[e.jsxs("span",{className:"text-5xl font-[1000] tracking-tighter text-slate-900 italic",children:["$",l.priceCLP]}),e.jsxs("span",{className:"text-xs font-bold text-slate-400 uppercase italic",children:["/ ",l.id==="annual"?"año":l.id==="quarterly"?"tri":"mes"]})]})]}),e.jsx("ul",{className:"space-y-4 mb-12 flex-grow",children:l.features.map((o,c)=>e.jsxs("li",{className:"flex items-start gap-3 text-xs font-bold text-slate-500 leading-tight",children:[e.jsx("div",{className:"mt-0.5 p-0.5 rounded-full bg-blue-50 text-blue-600",children:e.jsx(ut,{size:12,strokeWidth:4})}),o]},c))}),e.jsxs("button",{onClick:()=>s(l),className:`w-full py-6 rounded-[2rem] font-black uppercase tracking-[0.2em] text-[10px] transition-all active:scale-95 flex items-center justify-center gap-3 ${l.color==="emerald"?"bg-slate-900 text-white shadow-xl":"bg-blue-600 text-white shadow-xl shadow-blue-200"}`,children:["Ver planes ",e.jsx(I,{size:16})]})]},l.id))}),r&&e.jsx(Wt,{planId:r.id,amount:r.rawPrice,currentUser:t,onClose:()=>s(null),onSuccess:()=>{i&&t&&i({...t,subscription_tier:"PRO"}),a("/payment-success")}})]})},Kt=({foodInput:t,setFoodInput:i,onSubmit:a,isLoading:r})=>{const s=l=>{l.key==="Enter"&&!l.shiftKey&&t.trim()&&(l.preventDefault(),a())};return e.jsxs(w.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"w-full max-w-2xl mx-auto",children:[e.jsxs("div",{className:"relative group",children:[e.jsx("div",{className:"absolute -inset-1 bg-gradient-to-r from-blue-600 to-cyan-500 rounded-[2.5rem] blur opacity-25 group-focus-within:opacity-50 transition duration-1000"}),e.jsxs("div",{className:"relative bg-white rounded-[2.5rem] shadow-2xl overflow-hidden border border-slate-100",children:[e.jsxs("div",{className:"flex items-center px-8 py-6",children:[e.jsx("div",{className:"mr-4 text-blue-600",children:r?e.jsx(T,{size:24,className:"animate-spin"}):e.jsx(R,{size:24})}),e.jsx("textarea",{value:t,onChange:l=>i(l.target.value),onKeyDown:s,placeholder:"Describe tu comida (ej: '2 tacos de pastor y una coca zero')...",className:"flex-1 bg-transparent border-none outline-none text-lg font-medium text-slate-800 placeholder:text-slate-300 resize-none h-12 py-2",disabled:r}),e.jsx("button",{onClick:a,disabled:r||!t.trim(),className:`ml-4 p-4 rounded-2xl transition-all ${t.trim()&&!r?"bg-blue-600 text-white shadow-lg shadow-blue-200 hover:scale-105 active:scale-95":"bg-slate-100 text-slate-300"}`,children:r?e.jsx(T,{size:20,className:"animate-spin"}):e.jsx(I,{size:20})})]}),e.jsxs("div",{className:"bg-slate-50 px-8 py-3 flex items-center justify-between border-t border-slate-50",children:[e.jsx("span",{className:"text-[9px] font-black uppercase tracking-[0.2em] text-slate-400",children:"Metra Inferencia Bio-Nutricional"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("div",{className:"w-1.5 h-1.5 rounded-full bg-emerald-500 animate-pulse"}),e.jsx("span",{className:"text-[9px] font-bold text-slate-400",children:"Motor v4.7 Activo"})]})]})]})]}),e.jsx("div",{className:"mt-6 flex flex-wrap justify-center gap-3",children:["Desayuno ligero","Almuerzo completo","Cena Keto"].map(l=>e.jsxs("button",{onClick:()=>i(l),className:"px-4 py-2 bg-white border border-slate-200 rounded-full text-[10px] font-bold text-slate-500 hover:border-blue-400 hover:text-blue-600 transition-colors shadow-sm",children:["+ ",l]},l))})]})},Jt=({currentUser:t})=>{const i=L(),[a,r]=d.useState(!1),[s,l]=d.useState(""),[o,c]=d.useState([{id:"1",role:"assistant",content:"Bio-Core activo. ¿Analizamos tu última ingesta?",type:"text"}]),n=d.useRef(null);d.useEffect(()=>{n.current&&(n.current.scrollTop=n.current.scrollHeight)},[o,a]);const g=u=>{if(u.preventDefault(),!s.trim())return;const f={id:Date.now().toString(),role:"user",content:s};c(m=>[...m,f]),l(""),setTimeout(()=>{const m={id:(Date.now()+1).toString(),role:"assistant",content:s.toLowerCase().includes("pro")?"Vitametra PRO desbloquea análisis molecular avanzado.":"Sugerencia: Ingiere fibra antes de esos carbohidratos.",type:s.toLowerCase().includes("pro")?"cta":"text"};c(x=>[...x,m])},800)};return e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:()=>r(!0),className:`fixed bottom-24 right-6 w-16 h-16 rounded-full flex items-center justify-center transition-all duration-500 z-[999] active:scale-90 ${a?"scale-0 opacity-0":"bg-metra-blue shadow-[0_0_30px_rgba(0,122,255,0.4)] hover:shadow-metra-blue/60"}`,children:[e.jsx("div",{className:"absolute inset-0 rounded-full border-2 border-white animate-ping opacity-20"}),e.jsx(F,{className:"text-white fill-white",size:24})]}),a&&e.jsxs("div",{className:"fixed bottom-0 right-0 md:bottom-28 md:right-6 w-full md:w-[400px] h-[100dvh] md:h-[600px] bg-white/90 backdrop-blur-2xl md:rounded-[3rem] shadow-2xl flex flex-col z-[1000] border border-white/20 animate-in slide-in-from-right-10 duration-500",children:[e.jsxs("header",{className:"bg-metra-dark p-8 text-white flex justify-between items-center relative overflow-hidden",children:[e.jsx("div",{className:"absolute top-0 left-0 w-full h-full bg-metra-blue/10 animate-pulse"}),e.jsxs("div",{className:"flex items-center gap-4 relative z-10",children:[e.jsx("div",{className:"w-10 h-10 bg-metra-blue rounded-2xl flex items-center justify-center shadow-lg shadow-metra-blue/20",children:e.jsx(R,{size:20,className:"text-white"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-[9px] font-black text-metra-blue uppercase tracking-widest",children:"Neural Link"}),e.jsx("h3",{className:"text-xl font-black italic tracking-tighter uppercase",children:"Bio-Assistant"})]})]}),e.jsx("button",{onClick:()=>r(!1),className:"bg-white/10 p-3 rounded-2xl relative z-10 hover:bg-white/20",children:e.jsx(O,{size:20})})]}),e.jsx("div",{ref:n,className:"flex-1 overflow-y-auto p-6 space-y-6",children:o.map(u=>e.jsx("div",{className:`flex ${u.role==="user"?"justify-end":"justify-start"}`,children:e.jsxs("div",{className:`max-w-[85%] p-5 rounded-3xl text-sm font-bold ${u.role==="user"?"bg-metra-blue text-white rounded-tr-none":"bg-slate-100 text-metra-dark rounded-tl-none"}`,children:[u.content,u.type==="cta"&&e.jsxs("button",{onClick:()=>i("/plans"),className:"mt-4 w-full bg-metra-dark text-white py-4 rounded-2xl flex items-center justify-center gap-2 font-black text-[10px] uppercase tracking-widest",children:[e.jsx(bt,{size:14})," Desbloquear PRO ",e.jsx(I,{size:14})]})]})},u.id))}),e.jsx("div",{className:"p-6 bg-white border-t border-slate-50",children:e.jsxs("form",{onSubmit:g,className:"relative",children:[e.jsx("input",{value:s,onChange:u=>l(u.target.value),placeholder:"Consulta al Bio-Core...",className:"w-full bg-slate-50 border-none rounded-2xl py-5 pl-6 pr-16 text-xs font-black uppercase tracking-widest outline-none focus:ring-2 ring-metra-blue/10"}),e.jsx("button",{type:"submit",className:"absolute right-2 top-1/2 -translate-y-1/2 bg-metra-dark text-white p-3 rounded-xl shadow-lg",children:e.jsx(gt,{size:18})})]})})]})]})},Yt=({currentUser:t,onUpdate:i})=>{const[a,r]=d.useState([]),[s,l]=d.useState(50),[o,c]=d.useState(!1),[n,g]=d.useState(!1);if(d.useEffect(()=>{t&&(r(t.insulinRatioSchedule||[{startTime:"08:00",ratio:12}]),l(t.clinicalConfig?.insulinSensitivityFactor||50))},[t]),!t)return e.jsxs("div",{className:"flex flex-col items-center justify-center min-h-[400px] text-slate-400",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mb-4"}),e.jsx("p",{className:"text-xs font-black uppercase tracking-widest italic",children:"Sincronizando expediente clínico..."})]});const u=async()=>{c(!0);try{const h={...t,insulinRatioSchedule:a,clinicalConfig:{...t.clinicalConfig||{},insulinSensitivityFactor:s}};await y.updateUser(h),i(h),g(!0),setTimeout(()=>g(!1),3e3)}catch(h){console.error("Error en calibración:",h)}finally{c(!1)}},f=()=>{const h=a.length>0?a[a.length-1].ratio:10;r([...a,{startTime:"12:00",ratio:h}])},m=h=>{a.length<=1||r(a.filter((v,b)=>b!==h))};return!t.insulinRatioSchedule&&!t.clinicalConfig&&!n&&a.length===0?e.jsxs(w.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"max-w-2xl mx-auto p-12 bg-white rounded-[3rem] border border-dashed border-slate-200 text-center",children:[e.jsx("div",{className:"w-20 h-20 bg-blue-50 rounded-3xl flex items-center justify-center mx-auto mb-6 text-blue-600",children:e.jsx(xe,{size:40})}),e.jsxs("h2",{className:"text-2xl font-[1000] text-slate-900 tracking-tighter uppercase italic mb-3",children:["Configuración ",e.jsx("span",{className:"text-blue-600",children:"Clínica Vacía"})]}),e.jsx("p",{className:"text-slate-500 text-sm leading-relaxed mb-8 max-w-sm mx-auto",children:"Para realizar cálculos de precisión, necesitamos tus ratios de insulina y factor de sensibilidad."}),e.jsxs("button",{onClick:f,className:"bg-slate-900 text-white px-8 py-4 rounded-2xl font-black uppercase tracking-widest text-[10px] flex items-center justify-center gap-2 mx-auto hover:bg-blue-600 transition-all",children:["Comenzar Calibración ",e.jsx(J,{size:16})]})]}):e.jsxs(w.div,{initial:{opacity:0},animate:{opacity:1},className:"max-w-2xl mx-auto p-6 bg-white rounded-[2.5rem] border border-slate-100 shadow-xl mb-10",children:[e.jsxs("header",{className:"mb-10 border-b border-slate-50 pb-6 text-left",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("div",{className:"w-10 h-10 bg-blue-50 rounded-xl flex items-center justify-center text-blue-600",children:e.jsx(E,{size:22})}),e.jsx("h2",{className:"text-2xl font-[1000] text-slate-900 tracking-tighter uppercase italic",children:"Calibración de Parámetros"})]}),e.jsx("p",{className:"text-slate-500 text-[11px] font-bold uppercase tracking-tight leading-relaxed opacity-60",children:"Algoritmos metabólicos de precisión para cálculo de bolos."})]}),e.jsxs("section",{className:"mb-10",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsxs("h3",{className:"text-[10px] font-black uppercase tracking-[0.2em] text-slate-400 flex items-center gap-2",children:[e.jsx(K,{size:14,className:"text-blue-500"})," Ratios Insulina:Carbohidratos"]}),e.jsxs("button",{onClick:f,className:"text-[10px] font-black uppercase tracking-widest text-blue-600 hover:bg-blue-50 px-4 py-2 rounded-xl transition-all flex items-center gap-1 border border-blue-100",children:[e.jsx(ue,{size:14})," Añadir"]})]}),e.jsx("div",{className:"space-y-3",children:a.map((h,v)=>e.jsxs(w.div,{layout:!0,className:"flex items-center gap-4 bg-slate-50 p-4 rounded-2xl border border-slate-100 transition-all hover:border-blue-100 hover:bg-white",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"text-[8px] font-black text-slate-400 uppercase block mb-1 tracking-tighter",children:"Inicio Bloque"}),e.jsx("input",{type:"time",value:h.startTime,onChange:b=>{const j=[...a];j[v].startTime=b.target.value,r(j)},className:"bg-transparent font-black text-slate-700 outline-none w-full text-lg"})]}),e.jsxs("div",{className:"flex-1 border-l border-slate-200 pl-4",children:[e.jsx("label",{className:"text-[8px] font-black text-slate-400 uppercase block mb-1 tracking-tighter",children:"Ratio (g/U)"}),e.jsx("input",{type:"number",value:h.ratio,onChange:b=>{const j=[...a];j[v].ratio=parseFloat(b.target.value),r(j)},className:"bg-transparent font-black text-slate-700 outline-none w-full text-lg"})]}),a.length>1&&e.jsx("button",{onClick:()=>m(v),className:"text-slate-300 hover:text-red-500 transition-colors p-2",children:e.jsx(ft,{size:18})})]},v))})]}),e.jsxs("section",{className:"mb-10 p-8 bg-slate-900 rounded-[2.5rem] text-white relative overflow-hidden shadow-2xl shadow-slate-200",children:[e.jsx("div",{className:"absolute -top-10 -right-10 opacity-5 text-white rotate-12",children:e.jsx(E,{size:200})}),e.jsxs("div",{className:"relative z-10",children:[e.jsx("h3",{className:"text-[10px] font-black uppercase tracking-[0.2em] text-blue-400 mb-2",children:"Sensibilidad (ISF)"}),e.jsx("p",{className:"text-xs text-slate-400 font-medium mb-6 leading-relaxed max-w-[280px]",children:"Reducción de glucemia (mg/dL) por cada 1 unidad de insulina."}),e.jsxs("div",{className:"flex items-center gap-6",children:[e.jsx("input",{type:"number",value:s,onChange:h=>l(parseFloat(h.target.value)),className:"bg-white/5 border border-white/10 rounded-2xl px-6 py-4 text-4xl font-black text-white w-36 outline-none focus:ring-2 ring-blue-500 transition-all text-center"}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("span",{className:"block text-xl font-black italic tracking-tighter",children:"mg/dL"}),e.jsx("span",{className:"text-[9px] font-black text-blue-500 uppercase tracking-[0.2em]",children:"x 1 unidad"})]})]})]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row items-center justify-between pt-6 border-t border-slate-50 gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2 text-slate-400 bg-slate-50 px-4 py-2 rounded-xl",children:[e.jsx(jt,{size:14,className:"text-amber-500"}),e.jsx("span",{className:"text-[9px] font-black uppercase tracking-tight italic",children:"Uso clínico bajo supervisión"})]}),e.jsx("button",{onClick:u,disabled:o,className:"w-full sm:w-auto bg-blue-600 text-white px-10 py-5 rounded-2xl font-black uppercase tracking-widest text-[10px] flex items-center justify-center gap-3 hover:bg-slate-900 transition-all active:scale-95 disabled:opacity-50 shadow-xl shadow-blue-100 italic",children:o?"Sincronizando...":e.jsxs(e.Fragment,{children:[e.jsx(Y,{size:18})," Actualizar Parámetros"]})})]}),e.jsx(_,{children:n&&e.jsxs(w.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0},className:"mt-6 p-4 bg-emerald-50 rounded-2xl flex items-center justify-center gap-3 text-emerald-600 font-black text-[9px] uppercase tracking-widest",children:[e.jsx($,{size:16})," Calibración exitosa en nube médica."]})})]})},Qt=()=>{const t=L(),[i,a]=d.useState("idle"),[r,s]=d.useState(null),[l,o]=d.useState(0),c=g=>new Promise((u,f)=>{const m=new FileReader;m.readAsDataURL(g),m.onload=()=>u(m.result.split(",")[1]),m.onerror=x=>f(x)}),n=async g=>{const u=g.target.files?.[0];if(u){if(u.size>10*1024*1024){s("El reporte es demasiado extenso (Máximo 10MB)"),a("error");return}a("processing"),s(null);try{const f=await c(u),m=$e(),v=(await We(m,"importMedicalReport")({fileBase64:f,fileName:u.name,fileType:u.type})).data;v.success&&(o(v.processedEntries),a("success"),setTimeout(()=>{t("/")},2500))}catch(f){console.error("Error importando:",f),s(f.message||"Error al procesar el documento médico."),a("error")}}};return e.jsx("div",{className:"max-w-xl mx-auto",children:e.jsxs("div",{className:`relative overflow-hidden bg-white p-10 rounded-[3rem] border-2 border-dashed transition-all duration-700 ${i==="success"?"border-emerald-500 bg-emerald-50/50":i==="error"?"border-red-200 bg-red-50/50":"border-slate-200 hover:border-blue-400 shadow-2xl shadow-slate-100"}`,children:[e.jsx("input",{type:"file",id:"fileImport",hidden:!0,onChange:n,accept:".pdf,.csv",disabled:i==="processing"||i==="success"}),e.jsxs("label",{htmlFor:"fileImport",className:`flex flex-col items-center gap-6 ${i==="processing"?"cursor-not-allowed":"cursor-pointer"}`,children:[e.jsx(w.div,{animate:i==="processing"?{rotate:360}:{rotate:0},transition:i==="processing"?{repeat:1/0,duration:2,ease:"linear"}:{},className:`w-24 h-24 rounded-[2.5rem] flex items-center justify-center shadow-xl transition-all duration-500 ${i==="success"?"bg-emerald-500 text-white":i==="processing"?"bg-blue-600 text-white":i==="error"?"bg-red-500 text-white":"bg-slate-900 text-white"}`,children:i==="processing"?e.jsx(T,{size:40}):i==="success"?e.jsx(wt,{size:40}):i==="error"?e.jsx(G,{size:40}):e.jsx(vt,{size:40})}),e.jsxs("div",{className:"text-center space-y-2",children:[e.jsx("h3",{className:"text-2xl font-[1000] uppercase italic tracking-tighter text-slate-900",children:i==="processing"?"Metra está leyendo...":i==="success"?"Sincronización Completa":"Cargar Reporte Médico"}),e.jsx("p",{className:"text-[11px] font-black text-slate-400 uppercase tracking-[0.3em]",children:i==="success"?`Hemos procesado ${l} registros con éxito`:"Analiza tu Bomba o Glucómetro en segundos"})]}),i==="success"&&e.jsxs(w.div,{initial:{opacity:0},animate:{opacity:1},className:"flex items-center gap-2 text-emerald-600 font-bold text-xs italic",children:["Redirigiendo a tus nuevos Insights... ",e.jsx(I,{size:14,className:"animate-bounce-x"})]}),e.jsx(_,{children:i==="processing"&&e.jsxs("div",{className:"w-full space-y-3",children:[e.jsx("div",{className:"w-full bg-slate-100 h-3 rounded-full overflow-hidden",children:e.jsx(w.div,{className:"bg-blue-600 h-full",initial:{width:"0%"},animate:{width:"100%"},transition:{duration:15}})}),e.jsx("p",{className:"text-center text-[9px] font-bold text-blue-600 uppercase tracking-widest animate-pulse",children:"Extrayendo patrones metabólicos con IA"})]})})]}),i==="error"&&e.jsx(w.div,{initial:{scale:.9,opacity:0},animate:{scale:1,opacity:1},className:"mt-6 p-4 bg-red-100 text-red-600 rounded-2xl text-[10px] font-black uppercase tracking-widest text-center border border-red-200",children:r})]})})},Xt=()=>{const t=L();return d.useEffect(()=>{Ae({particleCount:150,spread:70,origin:{y:.6},colors:["#2563eb","#10b981","#fbbf24"]})},[]),e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-slate-50 p-6",children:e.jsxs(w.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},className:"max-w-md w-full bg-white rounded-[4rem] p-10 shadow-2xl text-center relative overflow-hidden",children:[e.jsx("div",{className:"absolute top-0 left-0 w-full h-2 bg-gradient-to-r from-blue-600 to-emerald-500"}),e.jsx("div",{className:"w-24 h-24 bg-emerald-50 text-emerald-500 rounded-[2rem] flex items-center justify-center mx-auto mb-8",children:e.jsx($,{size:48})}),e.jsxs("h1",{className:"text-4xl font-[1000] text-slate-900 mb-4 tracking-tighter italic uppercase",children:["¡Acceso ",e.jsx("span",{className:"text-blue-600",children:"Pro"})," Activado!"]}),e.jsx("p",{className:"text-slate-500 font-medium mb-10",children:"Tu suscripción ha sido procesada con éxito. Ya puedes disfrutar de todas las herramientas de IA."}),e.jsxs("div",{className:"space-y-3 mb-10",children:[e.jsxs("div",{className:"flex items-center gap-4 p-4 bg-slate-50 rounded-3xl border border-slate-100 text-left",children:[e.jsx(F,{className:"text-blue-600",size:20}),e.jsx("span",{className:"text-[10px] font-black uppercase tracking-widest text-slate-700",children:"IA Ilimitada Desbloqueada"})]}),e.jsxs("div",{className:"flex items-center gap-4 p-4 bg-slate-50 rounded-3xl border border-slate-100 text-left",children:[e.jsx(D,{className:"text-emerald-500",size:20}),e.jsx("span",{className:"text-[10px] font-black uppercase tracking-widest text-slate-700",children:"Reportes Clínicos Activos"})]})]}),e.jsxs("button",{onClick:()=>t("/dashboard"),className:"w-full py-5 bg-slate-900 text-white font-black rounded-3xl flex items-center justify-center gap-3 uppercase tracking-widest text-xs hover:bg-black transition-all",children:["Ir al Panel ",e.jsx(I,{size:18})]}),e.jsxs("button",{onClick:()=>window.open("https://instagram.com","_blank"),className:"mt-8 flex items-center justify-center gap-2 text-slate-300 hover:text-pink-500 transition-colors",children:[e.jsx(Nt,{size:16}),e.jsx("span",{className:"text-[9px] font-black uppercase tracking-widest",children:"Compartir en redes"})]})]})})},Zt=()=>{const t=L(),i=Te(),[a,r]=d.useState(!1),[s,l]=d.useState(null),[o,c]=d.useState(!0),[n,g]=d.useState({login:!1,chat:!1}),[u,f]=d.useState({message:"",key:0}),[m,x]=d.useState({input:"",isLoading:!1,result:null,error:null}),[h,v]=d.useState({history:[],hba1c:[]}),b=p=>f({message:p,key:Date.now()}),j=d.useCallback(p=>{r(!0),l(p),(i.pathname==="/"||i.pathname==="/plans")&&t("/dashboard")},[i.pathname,t]);d.useEffect(()=>{const p=Ve(H,async S=>{try{if(S){const A=await y.getUserProfile(S.uid);A&&j(A)}else r(!1),l(null)}catch(A){console.error("Auth Error:",A)}finally{c(!1)}});return()=>p()},[j]),d.useEffect(()=>{if(a&&s?.id){const p=y.subscribeToHistory(s.id,A=>v(W=>({...W,history:A}))),S=y.subscribeToHba1cHistory(s.id,A=>v(W=>({...W,hba1c:A})));return()=>{p(),S()}}},[a,s?.id]);const k=async()=>{if(!(!m.input||!s||!s.id)){x(p=>({...p,isLoading:!0,error:null}));try{await y.checkAnalysisLimit(s.id);const p=await fe(m.input,s);x(S=>({...S,result:p}))}catch(p){x(S=>({...S,error:p.message})),b(p.message)}finally{x(p=>({...p,isLoading:!1}))}}};return o?e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-white font-black text-[10px] uppercase tracking-widest text-slate-400",children:"Vitametra OS 2026..."}):e.jsxs("div",{className:"min-h-screen bg-[#F8FAFC]",children:[a&&s&&e.jsx(Tt,{}),e.jsx(Ct,{isLoggedIn:a,onLoginClick:()=>g(p=>({...p,login:!0})),onLogoutClick:()=>y.logout(),currentUser:s}),e.jsx("main",{className:"container mx-auto px-4 pt-20 pb-32",children:e.jsxs(Re,{children:[e.jsx(z,{path:"/",element:e.jsx(ae,{currentUser:s,onStartClick:()=>t("/analyzer"),history:h.history})}),e.jsx(z,{path:"/dashboard",element:a&&s?e.jsx(ae,{currentUser:s,history:h.history,onStartClick:()=>t("/analyzer")}):e.jsx(M,{to:"/"})}),e.jsx(z,{path:"/import",element:a&&s?e.jsx(Qt,{}):e.jsx(M,{to:"/"})}),e.jsx(z,{path:"/analyzer",element:e.jsx("div",{className:"max-w-4xl mx-auto pt-10",children:m.result?e.jsx(It,{result:m.result,currentUser:s,onLogEntry:()=>{b("Registro Guardado"),x(p=>({...p,result:null,input:""})),t("/history")},onAdjust:()=>x(p=>({...p,result:null})),onLoginRequest:()=>g(p=>({...p,login:!0})),verifiedFoods:[],onFoodItemVerified:()=>{},onDeleteItem:()=>{}}):e.jsx(Kt,{foodInput:m.input,setFoodInput:p=>x(S=>({...S,input:p})),onSubmit:k,isLoading:m.isLoading})})}),e.jsx(z,{path:"/history",element:a&&s?e.jsx(Mt,{currentUser:s,history:h.history,hba1cHistory:h.hba1c,onDelete:p=>{y.deleteHistoryEntry(p),b("Eliminado")},onUpdate:()=>{},onSaveHba1c:()=>{},onUpdateHba1c:()=>{},onDeleteHba1c:()=>{},onUpdateLayout:()=>{},onNavigateToAnalyzer:()=>t("/analyzer")}):e.jsx(M,{to:"/"})}),e.jsx(z,{path:"/profile",element:a&&s?e.jsx(Gt,{currentUser:s,onUpdateUser:p=>{l(p),b("Perfil actualizado")}}):e.jsx(M,{to:"/"})}),e.jsx(z,{path:"/clinical-settings",element:a&&s?e.jsx(Yt,{currentUser:s,onUpdate:p=>{l(p),b("Ajustes guardados")}}):e.jsx(M,{to:"/"})}),e.jsx(z,{path:"/plans",element:e.jsx(qt,{onSelectPlan:()=>g(p=>({...p,login:!0}))})}),e.jsx(z,{path:"/register",element:e.jsx($t,{onLoginSuccess:j})}),e.jsx(z,{path:"/payment-success",element:e.jsx(Xt,{})})]})}),a&&e.jsx(St,{activeTab:i.pathname.substring(1)||"dashboard",onTabChange:p=>t(`/${p==="settings"?"clinical-settings":p}`)}),e.jsx(Jt,{}),e.jsx(zt,{message:u.message,snackbarKey:u.key}),n.login&&e.jsx(At,{isOpen:n.login,onClose:()=>g(p=>({...p,login:!1})),onLoginSuccess:j})]})};console.log("🚀 VitaMetra Core: Iniciando sistemas biométricos...");const ie=document.getElementById("root");ie?Pe.createRoot(ie).render(e.jsx(le.StrictMode,{children:e.jsx(Ee,{children:e.jsx(Zt,{})})})):console.error("CRÍTICO: El contenedor #root no existe en el DOM.");
